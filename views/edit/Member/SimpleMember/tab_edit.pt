<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en"
    xml:lang="en"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:notal="http://www.infrae.com/silva/notal"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    metal:use-macro="here/macro_no_tabs/macros/master"
    i18n:domain="silva">

<metal:slot fill-slot="main"
  tal:define="
    view here;
    dummy view/security_trigger;
    fields view/memberform/get_fields;
    message_type request/SESSION/message_type | nothing;
    message request/SESSION/message | nothing;
    dummy view/clear_message;
">

<div class="feedback"
  tal:attributes="class python:message_type == 'feedback' and 'fixed-feedback' or (message_type == 'error' and 'fixed-alert' or 'fixed-clear');
      style python:(message_type != 'feedback' and message_type != 'error') and 'background-image: url(%s/globals/skyrise.gif)'%container.get_root_url() or None">
  <span tal:replace="structure python: (message == '' or message == None) and '&nbsp;' or message">message</span>
</div>

<script type="text/javascript">
// Called from body onload() method which is defined in the
// macro_index. It focusses the appropiate form field.
function focus_editor() {
  if (document.getElementsByName) {
    elements = document.getElementsByName('field_fullname');
    if (elements.length > 0) {
        //alert(elements);
        elements[0].focus();
     }
  }
}
</script>

<form action="."
  method="post"
  accepted-charset="UTF-8"
  tal:attributes="action python:model.absolute_url()+'/edit'"
  tal:condition="may_change_content">
  <table class="listing"
    style="margin-bottom:0;">
    <thead>
      <tal:block replace="nothing">
        ______________ vein + title row ______________
      </tal:block>
      <tr>
        <td class="top"
          colspan="2">
          <h2 tal:attributes="title string:id: ${model/id}">
            <img tal:replace="structure python:view.render_icon(model)"
              tal:attributes="title model/meta_type" />
            <span i18n:translate="">member data of</span> &#xab;<span tal:replace="model/fullname">title</span>&#xbb;
          </h2>
        </td>
      </tr>
    </thead>

    <tbody>
      <tr>
        <th class="align-right" i18n:translate="">
          characteristic
        </th>
        <th i18n:translate="">
          content
        </th>
      </tr>
      <tal:repeat repeat="field fields">
      <tal:define define="iterate repeat/field/odd">
      <tr tal:attributes="class python:iterate and 'even' or 'odd'" tal:condition="python:field.id != 'editor' or len(field['items']) > 1">
      <td class="field-title">
        <span tal:content="python:field['title']">
          Title</span><span class="warning"
          tal:condition="python:field.is_required()">*</span>
      </td>
      <td>
        <input tal:replace="structure python: field.render(getattr(model, field.id)())" />
      </td>
      </tr>
      </tal:define>
      </tal:repeat>
      <tr tal:define="
        provider here/getLanguageProvider;
        languages provider/getAvailableLanguages"
        tal:condition="python: len(languages) > 1"
        class="even">
        <td class="field-title"
          i18n:translate="">
          preferred language
        </td>
        <td>
          <select class="store" size="1" name="langsetting">
            <tal:block tal:repeat="lang languages">
            <option
              tal:attributes="
                value lang;
                selected python: lang == provider.getPreferredLanguage() and 'selected' or None"
              tal:content="python:provider.getLanguageName(lang)">language</option>
            </tal:block>
          </select>
        </td>
      </tr>
    </tbody>

    <tfoot>
      <tr class="inter-controls" tal:replace="nothing">
        <td>
          &nbsp;
        </td>
        <td class="align-right"
          i18n:translate="">
          Approved member?&nbsp;
          <span tal:replace="python: test(model.is_approved(), 'Yes', 'No')" i18n:name="yes_no">&nbsp;</span>
          <input class="button"
            type="submit"
            name="approve_visitor:method"
            value="approve now"
            title="approve member: alt-a"
            accesskey="a"
            i18n:attributes="title;value"
            tal:condition="python: ((silva_permissions['ChangeSilvaAccess'] and model.id != user.getId()) or silva_permissions['ChangeSilvaViewRegistry']) and not model.is_approved()"
          />
        </td>
      </tr>
      <tr class="controls">
        <td class="align-right"
          colspan="2">
          <input class="cancel"
            style="float:left;"
            type="button"
            name="edit_cancel"
            value="close"
            title="close window: alt-c"
            accesskey="c"
            i18n:attributes="title;value"
            onclick="window.close(); window.opener.location.reload(); return false;"
          />
          <input class="button"
            type="submit"
            name="save_memberdata:method"
            value="save"
            title="save member data: alt-s"
            accesskey="s"
            i18n:attributes="title;value"
          />
        </td>
      </tr>
    </tfoot>
  </table>
</form>

<div class="info"
  tal:condition="not:silva_permissions/ChangeSilvaAccess">
  <h3 i18n:translate="">Dear <span tal:content="python:user.getId()" i18n:name="user_id"/><br />
    You are not allowed to edit membership data of member <span tal:content="model/id" i18n:name="member_id"/>
  </h3>
  <tal:comment condition="nothing" i18n:translate="">Add read only view here?</tal:comment>
</div>

</metal:slot>
</html>
