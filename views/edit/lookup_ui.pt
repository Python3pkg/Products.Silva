<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  tal:define="
    global active_tab string:tab_access;
    global breadcrumb_vein string:Lookup;
    global parent_screen_name string:access;
  ">
<metal:block use-macro="here/macro_index/macros/master">
<metal:block fill-slot="meta">
<meta http-equiv="refresh"
  tal:attributes="content string:900;; url=${model/absolute_url}/edit/tab_access" />
</metal:block>
<metal:block fill-slot="main"
  tal:define="
    no_entry string:-;
    has_access here/has_change_access_permission;"
  tal:condition="has_access">

<script type="text/javascript" 
  tal:content="structure python:here.focus_editor('name')">
  focus cursor
</script>

<table class="columns">
  <tbody>
    <tr>
      <td class="left">

        <span tal:replace="nothing">
          ______________ parent screen navigation ______________
        </span>
        <table class="listing">
          <thead>
            <tr>
              <td class="parent">
                <a href="parent screen"
                  title="return to previous screen: alt-k"
                  accesskey="k"
                  tal:attributes="href here/lookup_back_link">
                  <div class="navigation-border">
                    bac<u>k</u>...
                  </div>
                </a>
              </td>
            </tr>
          </thead>
        </table>
      </td>

      <tal:block replace="nothing">
        _____________________ main subtable _____________________
      </tal:block>
      <td class="main">
        <form action="lookup_search"
          method="POST">
          <table class="listing">
            <thead>
              <tr tal:replace="nothing">
                ______________ vein + title row ______________
              </tr>
              <tr>
                <td class="top" colspan="2">
                  <h2 tal:attributes="title string:id: ${model/id}">
                    <img tal:replace="structure python:view.render_icon(model)" />
                    user lookup at:                
                    &#xab;<span tal:replace="string:${model/get_title_editable}">title</span>&#xbb;
                  </h2>
                </td>
              </tr>
              <tr class="top-controls">
                <td colspan="2">
                  <h3>
                    User search
                  </h3>
                </td>
              </tr>
            </thead>

            <tbody>
              <tr class="odd">
                <td>
                  name (or part of name)
                </td>
                <td class="align-right"
                  style="width:60%;">
                  <input class="textarea"
                    name="name"
                    style="width:100%;"
                    type="text"
                    value="" />
                </td>
              </tr>
              <tr class="controls">
                <td class="align-right"
                   colspan="2">
                  <input class="button"
                    type="submit"
                    value="Search"
                    accesskey="s"                      
                    title="access key: alt-s"
                  />
                </td>
              </tr>
            </tbody>
          </table>
        </form>

      <!-- __________________________ search results ______________________________ -->
      <tal:define define="global lookup_result options/results | nothing" />
        <form action="lookup_add_to_selection" method="POST">
          <table class="listing">
            <thead>
              <tr class="top-controls">
                <td colspan="2">
                  <input class="button"
                    style="float:right;"
                    type="submit"
                    value="Add to clipboard"
                    title="add checked users to clipboard: alt-a"
                    accesskey="a"                      
                    tal:condition="python:lookup_result and len(lookup_result) > 3" />
                  <h3>
                    Search results
                  </h3>
                </td>
              </tr>
            </thead>

            <tbody>
              <tr tal:condition="python: lookup_result">
                <th>
                  user
                </th>
                <th
                  style="width:60%;">
                  email
                </th>
              </tr>

              <!-- Listing loop -->
              <tal:block repeat="member lookup_result">
                <tr tal:define="iterate repeat/member/odd"
                  tal:attributes="class python:iterate and 'odd' or 'even';">
                  <td>
                    <input name="userids:list"
                      type="checkbox"
                      value=""
                      tal:attributes="value member/userid" />
                    <span tal:content="member/fullname" />
                  </td>
                  <td>
                    <span tal:replace="member/email | no_entry" />
                  </td>
                </tr>
              </tal:block>
              <tr class="odd"
                tal:condition="python:not lookup_result">
                <td align="left"
                  colspan="2">
                  <i>
                    No search results
                  </i>
                </td>
              </tr>
            </tbody>

            <tfoot>
              <tr class="controls">
                <td class="align-right"
                  colspan="2">
                  <input class="button"
                    type="submit"
                    value="Add to clipboard"
                    title="add checked users to clipbaord: alt-a"
                    accesskey="a"                      
                    tal:condition="lookup_result"
                  />
                </td>
              </tr>
            </tfoot>
          </table>
        </form>
      </td>

      <td class="right">
        <!-- Clipboard -->
        <metal:block use-macro="view/macro_user_lookup_clipboard/macros/clipboard">
          <metal:block fill-slot="clipboard_lookup_action">
            <a class="navigation" 
              style="float: right;"
              accesskey="u"
              title="return to the access screen with this clipboard: alt-u"
              href="lookup_back_link"
              tal:attributes="href here/lookup_back_link">
              <u>U</u>se clipboard...
            </a>
          </metal:block>
          <metal:block fill-slot="clipboard_actions">
            <input class="warning"
              style="float: right;"
              name="lookup_remove_from_selection:method"
              type="submit"
              value="Remove user"
              title="remove users from the clipboard: alt-r"
              accesskey="r"
            />
          </metal:block>
        </metal:block>
      </td>
    </tr>
  </tbody>
</table>
</metal:block>
</metal:block>
</html>
