<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  tal:define="
    global active_tab string:tab_access;
    global vein string:lookup;
    global parent_screen_name string:access;
  "
  i18n:domain="silva">

<metal:block use-macro="here/macro_index/macros/master">
  <metal:block fill-slot="meta">
    <meta http-equiv="refresh"
      tal:attributes="content string:900;; url=${model/absolute_url}/edit/tab_access" />
</metal:block>
<metal:block fill-slot="main"
  tal:define="
    no_entry string:-;
    has_access here/has_change_access_permission;"
  tal:condition="has_access">

<script type="text/javascript" 
  tal:content="structure python:here.focus_editor('name')">
  focus cursor
</script>

<table class="columns">
  <tbody>
    <tr>
      <td class="left">

        <span tal:replace="nothing">
          ______________ parent screen transport ______________
        </span>
        <table class="listing">
          <thead>
            <tr>
              <td class="parent">
                <a href="parent screen"
                  title="return to previous screen: alt-k"
                  accesskey="k"
                  i18n:attributes="title"
                  tal:attributes="href here/lookup_back_link">
                  <div class="transport-border" i18n:translate="">
                    bac<u>k</u>...
                  </div>
                </a>
              </td>
            </tr>
          </thead>
        </table>
      </td>

      <tal:block replace="nothing">
        _____________________ main subtable _____________________
      </tal:block>
      <td class="main">
        <form action="lookup_search"
          method="POST">
          <table class="listing">
            <thead>
              <tr tal:replace="nothing">
                ______________ vein + title row ______________
              </tr>
              <tr>
                <td class="top" colspan="2">
                  <h2 tal:attributes="title string:id: ${model/id}" i18n:translate="">
                    <img tal:replace="structure python:view.render_icon(model)" />
                    user lookup at
                    &#xab;<span tal:replace="string:${model/get_title_or_id_editable}" i18n:name="title_or_id">title</span>&#xbb;
                  </h2>
                </td>
              </tr>
              <tr class="top-controls">
                <td colspan="2">
                  <h3 i18n:translate="">
                    user search
                  </h3>
                </td>
              </tr>
            </thead>

            <tbody>
              <tr class="odd">
                <td class="align-right"
                  i18n:translate="">
                  name (or part of name)
                </td>
                <td class="align-right"
                  style="width:70%;">
                  <input class="store"
                    name="name"
                    type="text"
                    value=""
                  />
                </td>
              </tr>
              <tr class="controls">
                <td class="align-right"
                   colspan="2">
                  <input class="button"
                    type="submit"
                    value="search"
                    accesskey="s"                      
                    title="access key: alt-s"
                    i18n:attributes="value title"
                  />
                </td>
              </tr>
            </tbody>
          </table>
        </form>

      <!-- __________________________ search results ______________________________ -->
      <tal:define define="global lookup_result options/results | nothing" />
        <form action="lookup_add_to_selection" method="POST">
          <table class="listing" tal:define="extra_names model/service_members/get_extra_names; lookup_colspan python:2 + len(extra_names)">
            <thead>
              <tr class="top-controls">
                <td tal:attributes="colspan lookup_colspan">
                  <input class="button"
                    style="float:right;"
                    type="submit"
                    value="add to clipboard"
                    title="add checked users to clipboard: alt-a"
                    accesskey="a"                      
                    i18n:attributes="value title"
                    tal:condition="python:lookup_result and len(lookup_result) > 3" />
                  <h3 i18n:translate="">
                    search results
                  </h3>
                </td>
              </tr>
            </thead>

            <tbody>
              <tr tal:condition="python: lookup_result">
                <th i18n:translate="">
                  user
                </th>
                <th
                  style="width:60%;" i18n:translate="">
                  email
                </th>
                <th tal:repeat="extra_name extra_names">
                  <span tal:replace="extra_name" />
                </th>
              </tr>

              <!-- Listing loop -->
              <tal:block repeat="member lookup_result">
                <tr tal:define="iterate repeat/member/odd"
                  tal:attributes="class python:iterate and 'odd' or 'even';">
                  <td>
                    <input name="userids:list"
                      type="checkbox"
                      value=""
                      tal:attributes="
                        value member/userid;
                        id member/userid" />
                    <label style="text-transform:none"
                      tal:content="member/fullname" 
                      tal:attributes="for member/userid">
                      username
                    </label>
                  </td>
                  <td>
                    <span tal:replace="member/email | no_entry" />
                  </td>
                  <td tal:repeat="extra_name extra_names">
                    <span tal:replace="structure python:member.extra(extra_name)" />
                  </td>
                </tr>
              </tal:block>
              <tr class="odd"
                tal:condition="python:not lookup_result">
                <td align="left"
                  tal:attributes="colspan lookup_colspan">
                  <i i18n:translate="">
                    No search results.
                  </i>
                </td>
              </tr>
            </tbody>

            <tfoot>
              <tr class="controls">
                <td class="align-right"
                  tal:attributes="colspan lookup_colspan">
                  <input class="button"
                    type="submit"
                    value="add to clipboard"
                    title="add checked users to clipboard: alt-a"
                    accesskey="a"
                    i18n:attributes="value title"
                    tal:condition="lookup_result"
                  />
                </td>
              </tr>
            </tfoot>
          </table>
        </form>
      </td>

      <td class="right">
        <!-- Clipboard -->
        <metal:block use-macro="view/macro_user_lookup_clipboard/macros/clipboard">
          <metal:block fill-slot="clipboard_lookup_action">
            <a class="transport" 
              style="float: right;"
              accesskey="u"
              title="return to the access screen with this clipboard: alt-u"
              href="lookup_back_link"
              tal:attributes="href here/lookup_back_link"
              i18n:attributes="title"
              i18n:translate="">
              <u>u</u>se clipboard...
            </a>
          </metal:block>
          <metal:block fill-slot="clipboard_actions">
            <input class="warning"
              name="lookup_remove_from_selection:method"
              type="submit"
              value="remove user"
              title="remove users from the clipboard: alt-r"
              accesskey="r"
              i18n:attributes="value title"
           />
          </metal:block>
        </metal:block>
      </td>
    </tr>
  </tbody>
</table>
</metal:block>
</metal:block>
</html>
