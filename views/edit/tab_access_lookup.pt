<tal:block define="
  global active_tab string:tab_access;
  global breadcrumb_vein string:Lookup;
  " />
<metal:block use-macro="here/macro_index/macros/master">
  <div class="margins"
    metal:fill-slot="main">
    <h3>
      <a href="tab_access"
        title="Up to top of Access tab">
        Access
        <img alt="Up to top of Access tab"
          border="0"
          height="11"
          width="16"
          tal:attributes="src string:${silva_root}/globals/up_gray.gif" />
      </a>
    </h3>
    <h2 class="worksheet">
      Users lookup
    </h2>
    <div class="worksheet borders top bottom left right"
      tal:define="global no_entry string:-"
      tal:condition="python:view.has_access()">
      <table border="0"
        cellpadding="5"
        cellspacing="0"
        width="100%">
        <tr>
          <td>
            <h3>
              Search
            </h3>
          </td>
          <td>
            <h3>
              Selection
            </h3>
          </td>
        </tr>
        <tr align="left"
          valign="top">
          <td width="50%">
            <form action="."
              method="POST">
              <table border="0"
                cellpadding="3"
                cellspacing="0"
                width="100%">
                <tr class="topcontrols">
                  <th align="left"
                    colspan="2">
                    <span class="tablehead4">
                      User search
                    </span>
                  </th>
                </tr>
                <tr class="focus">
                  <td class="rowhead"
                    colspan="2">
                    Name (or part of name):
                    <br />
                    <input class="textarea"
                      name="name"
                      style="width:100%;"
                      type="text"
                      value="" />
                  </td>
                </tr>
                <tr class="controls">
                  <td>
                    <input class="cancelbutton"
                      accesskey="c"
                      name="tab_access:method"
                      title="Cancel - ctrl-c"
                      type="submit"
                      value="Cancel" />
                  </td>
                  <td align="right">
                    <input class="button"
                      accesskey="s"
                      name="lookup_search:method"
                      title="Search - ctrl-s"
                      type="submit"
                      value="Search" />
                  </td>
                </tr>
                <tr>
                  <td align="left"
                    colspan="2">
                    &nbsp;
                  </td>
                </tr>
              </table>
            </form>
              <!-- __________________________ search results ______________________________ -->
            <form action="." method="POST">
              <table border="0"
                cellpadding="3"
                cellspacing="0"
                width="100%">
                <tr class="topcontrols">
                  <th align="left"
                    colspan="2">
                    <span class="tablehead4">
                      Search results
                    </span>
                  </th>
                </tr>
                <tal:block define="global lookup_result python:view.lookup_get_search_result()" />
              <!-- If many items in result; put a second button on top as well. 
                Is this UI-wise "done" or "not done"? -->
                <tr class="topcontrols"
                  tal:condition="python:len(lookup_result) > 3">
                  <td align="right"
                    colspan="2">
                    <img height="18px"
                      src="pixel.gif"
                      width="1px"
                      tal:attributes="src string:${silva_root}/globals/pixel.gif" />
                    <input class="button"
                      accesskey="a"
                      name="lookup_add_to_selection:method"
                      title="Add checked users to your selection list on the right - ctrl-a"
                      type="submit"
                      value="Add to selection" />
                  </td>
                </tr>
              <!-- Listing loop -->
                <tal:block repeat="member lookup_result">
                  <tr class="focus"
                    tal:define="oddrow repeat/member/odd"
                    tal:attributes="class python:test(oddrow, 'focus-cycle', 'focus')">
                    <td align="left"
                      valign="top"
                      width="1%">
                      <input name="userids:list"
                        type="checkbox"
                        value=""
                        tal:attributes="value member/userid" />
                    </td>
                    <td>
                      <span class="subhead"
                        tal:content="member/fullname" />
                      &nbsp;
                      <br />
                      <span class="subhead">
                        email:
                      </span>
                      <span tal:replace="member/email | no_entry" />
                      <br />
                      <span class="subhead">
                        Department(s):
                      </span>
                      <span tal:replace="python:view.lookup_render_departments(member)" />
                      <br />
                    </td>
                  </tr>
                </tal:block>
                <tr class="focus"
                  tal:condition="python:not lookup_result">
                  <td align="left"
                    colspan="2"
                    valign="top">
                    <i>
                      (no search results)
                    </i>
                  </td>
                </tr>
                <tr class="controls">
                  <td align="right"
                    colspan="2">
                    <input class="button"
                      accesskey="a"
                      name="lookup_add_to_selection:method"
                      title="Add checked users to your selection list on the right - ctrl-a"
                      type="submit"
                      value="Add to selection" />
                  </td>
                </tr>
              </table>
            </form>
          </td>
        <!-- __________________________ selection ______________________________ -->
          <td>
            <div class="hilight borders top right bottom left"
              style="margin: 0em 1em;">
              <!-- Clipboard -->
              <metal:block use-macro="view/macro_user_lookup_clipboard/macros/clipboard_no_style">
                <metal:block fill-slot="clipboard_lookup_action">
                  <!-- fill slot to suppress lookup button -->
                </metal:block>
                <metal:block fill-slot="clipboard_actions">
                  &nbsp;
                  <input class="button"
                    accesskey="u"
                    name="lookup_use_selection:method"
                    style="float: right;"
                    title="Return to the top of the access tab with this selection - ctrl-u"
                    type="submit"
                    value="Use selection..." />
                  <input class="warningbutton"
                    accesskey="d"
                    name="lookup_remove_from_selection:method"
                    style="float: left;"
                    title="Remove users from your selection - ctrl-d"
                    type="submit"
                    value="Deselect" />
                </metal:block>
              </metal:block>
            </div>
          </td>
        <!-- ________________________ end selection ____________________________ -->
        </tr>
      </table>
    </div>
  </div>
</metal:block>