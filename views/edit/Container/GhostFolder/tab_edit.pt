<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  tal:define="
    global vein string:contents;
    global iterate string:odd;
    "
  i18n:domain="silva">

<tal:def define="
    model request/model;
    mangle  modules/Products/Silva/mangle;
    version     python:model.get_editable();
    link_status python:here.get_ghost_link_status_text(version);
    content_url python:version.get_haunted_url();
    ct python: mangle.String.centeredTruncate;
    maintitlecolspan string:2;
">
<metal:use-macro use-macro="here/macro_edit/macros/editor">

<metal:fill-editor-slot fill-slot="main">
 <metal:use-macro use-macro="here/macro_edit/macros/two-col-layout">

<metal:fill fill-slot="sidebar">
 <td class="left">
  <metal:use-macro use-macro="here/macro_vein_navigation/macros/vein">
   <metal:fill-slot fill-slot="sidebar">
    <tal:block replace="structure python: here.service_sidebar.render(model, 'tab_edit', vein)" />
   </metal:fill-slot>
  </metal:use-macro>
 </td>
</metal:fill>

     <metal:fillbody fill-slot="main-body">
        <tr>
           <th width="33%"
             i18n:translate="">
             attributes
           </th>
           <th i18n:translate="">
              content
           </th>
        </tr>
        <tr class="even">
          <td class="designator">
            <label for="content_url"
              i18n:translate="">path</label><span class="warning">*</span>
            <p i18n:translate="">
              Path to original (begins with &#8216;/&#8217;).
            </p>
          </td>
          <td>
            <input class="button transporter"
              style="margin-top:0.2em"
              type="button"
              value="reference..."
              title="Locate item to refer to: alt-r"
              accesskey="r"
              tal:define="asset_context python:here.get_start_container();"
              tal:attributes="onclick string: reference.getReference(
                                        function(path, id, title) {
                                          document.getElementsByName(
                                            'content_url'
                                          )[0].value = path;;
                                        },
                                        '${asset_context/absolute_url}',
                                        'Container', true, '${content_url}')"
              i18n:attributes="value;title"
            />
            <input class="store"
               type="text"
               id="content_url"
               name="content_url"
               size="60"
               value=""
               tal:attributes="value content_url"
            />
          </td>
        </tr>

        <tr class="odd"
           tal:condition="not:link_status">
           <td class="designator">
             <span class="matchlabel" i18n:translate="">link</span>
             <p i18n:translate="">
                Link to contents screen of original.
             </p>
           </td>
           <td class="field">
             <a href="original"
               tal:attributes="href python:content_url + '/edit/tab_edit'"
               tal:content="python: model.get_editable().get_title_or_id()">
               link
             </a>
           </td>
        </tr>

        <tr class="odd"
           tal:condition="link_status">
           <td class="field-title" i18n:translate="">
              problem
           </td>
           <td class="alert">
              <span class="error" tal:content="structure link_status" />
           </td>
           <td>
              &nbsp;
           </td>
        </tr>
     </metal:fillbody>

     <metal:fillfoot fill-slot="main-foot">
        <tr class="controls">
           <td class="align-right"
              colspan="3">
              <input class="button"
                 type="submit"
                 name="submit:method"
                 value="save reference"
                 title="access key: alt-s"
                 accesskey="s"
                 i18n:attributes="value;title"
              />
           </td>
        </tr>
     </metal:fillfoot>

<tal:block replace="nothing">
  ____________________________ contents listing ____________________________
</tal:block>
<tal:block replace="nothing">
  ______________ This listing duplicates code of the Contents screen,
  but it's so adjusted it may not make sense to macro it.  ______________
</tal:block>
<metal:fillextra fill-slot="main-extra">
<table class="listing"
  tal:define="
    default_document model/get_default;
    default_doc_list python: test(default_document, [default_document], []);
    publishables python: default_doc_list + model.get_ordered_publishables();
    assets model/get_non_publishables;
   " >
  <thead>
    <tal:block replace="nothing">
      ______________ vein + title row ______________
    </tal:block>
    <tr>
      <td class="top"
        colspan="5">
        <h2 tal:attributes="title string:id: ${model/id}">
        <img tal:replace="structure icon" />
          <span i18n:translate="">ghost folder contents</span>
        </h2>
      </td>
    </tr>

    <tal:block replace="nothing">
      ______________ top controls row ______________
    </tal:block>
    <tr class="top-controls">
      <td colspan="5">
         <div style="float: left;">
            <form method="post"
              name="resync_form"
              action=".">
              <input class="button"
                type="submit"
                name="sync:method"
                value="resync ghost folder"
                title="re-synchronize with content from the source folder: alt-e"
                accesskey="e"
                tal:condition="not:link_status"
                i18n:attributes="value;title"
               />
            </form>
         </div>
      </td>
    </tr>
  </thead>

  <tbody>
    <tal:block replace="nothing">
      ______________ listing header ______________
    </tal:block>
    <tr tal:condition="python:(default_document or publishables or assets)">
      <th class="listing-left">
        #&nbsp;
      </th>
      <th i18n:translate="">
        edit
      </th>
      <th i18n:translate="">
        preview
      </th>
      <th i18n:translate="">
        modified
      </th>
      <th i18n:translate="">
        author
      </th>
    </tr>

    <tal:block replace="nothing">
      ______________ if folder is empty (XXX: check for Zope level objects?) ______________
    </tal:block>
    <tr class="odd"
      tal:condition="python: not(default_document or publishables or assets)">
      <td colspan="5"
        i18n:translate="">
        There is no content here.
      </td>
    </tr>

    <tal:block replace="nothing">
      ______________ default + publishables ______________
    </tal:block>
    <tal:repeat
      repeat="item publishables">
      <tal:define define="
        is_default python: item is default_document;
        item_url item/absolute_url;
        status_style python:item.get_object_status()[1];
        iterate repeat/item/odd">
        <tr tal:attributes="class python: iterate and 'odd' or 'even'">
          <tal:block replace="nothing">
            _______ checkbox + position cell _______
          </tal:block>
          <td class="listing-left">
            <span
              tal:condition="default_document"
              tal:content="repeat/item/index"
              tal:attributes="for item/id">
              # with default doc, starts at 0
            </span>
            <span
              tal:condition="not: default_document"
              tal:content="repeat/item/number"
              tal:attributes="for item/id">
              # without default doc, starts at 1
            </span>
          </td>
          <tal:block replace="nothing">
            _______ id cell _______
          </tal:block>
          <td>
            <a class="icon"
              tal:attributes="
                href python:here.get_editor_link(item);
                title item/meta_type;">
              <img tal:replace="structure python:here.render_icon(item)" />
            </a>
            <a class="blacklink"
              title="edit"
              tal:define="id item/id"
              tal:content="python: ct(id, 30)"
              tal:attributes="
                href python:here.get_editor_link(item);
                class status_style;"
                i18n:attributes="title"
              >
              id
            </a>
          </td>
          <tal:block replace="nothing">
            _______ title cell _______
          </tal:block>
          <td>
            <a class="blacklink"
              title="preview"
              tal:attributes="
                href string:${item_url}/edit/tab_preview;
                class status_style;"
              tal:define="title python:(item.get_title_editable() or default)"
              tal:content="title"
              i18n:attributes="title"
              >
              <em i18n:translate="">no title</em>
            </a>
          </td>
          <tal:block replace="nothing">
            _______ modified date/metadata downlink cell _______
          </tal:block>
          <td tal:define="modification_time item/get_modification_datetime | nothing">
            <a class="blacklink" title="metadata"
              tal:condition="modification_time"
              tal:attributes="href string:${item_url}/edit/tab_metadata"
              tal:content="structure python:mangle.DateTime(modification_time).toShortStr()"
              i18n:attributes="metadata">
              date
            </a>
            <a class="closed" title="settings"
              tal:condition="not:modification_time"
              tal:attributes="href string:${item_url}/edit/tab_metadata"
              i18n:attributes="title">
              <em i18n:translate="">n/a</em>
            </a>
          </td>
          <tal:block replace="nothing">
            _______ author/tab_status downlink cell _______
          </tal:block>
          <td tal:define="last_author python:(item.sec_get_last_author_info().fullname() or default)">
            <a style="float:right"
              title="content approved, or published..."
              tal:define="
                is_published item/is_version_published | nothing;
                is_approved item/is_version_approved | nothing"
              tal:condition="
                python: is_published or is_approved"
              tal:attributes="
                href item_url;"
              i18n:attributes="title">
              <img alt="content approved or published"
                border="0"
                width="10"
                height="10"
                tal:attributes="src string:${root_url}/globals/checkmark.gif"
                i18n:attributes="alt"
              />
            </a>
            <a class="blacklink" title="status"
              tal:condition="python:not item.implements_container() and item.implements_versioned_content()"
              tal:attributes="href string:${item_url}/edit/tab_status"
              tal:content="structure last_author"
              i18n:attributes="title">
              authorname
            </a>
            <a class="closed" title="publish"
              tal:condition="python:item.implements_container()"
              tal:attributes="href string:${item_url}/edit/tab_status"
              i18n:attributes="title">
              <em i18n:translate="">n/a</em>
            </a>
            <span
              tal:condition="python:item.implements_content() and not item.implements_versioned_content()"
              tal:replace="last_author">
              authorname
            </span>
          </td>
        </tr>
        <tal:block replace="nothing">
          ______________ sync cycling of row colors ______________
        </tal:block>
        <tal:condition condition="repeat/item/end">
          <tal:define define="global iterate python: iterate == 1 and 'odd' or 'even'" />
        </tal:condition>
      </tal:define>
    </tal:repeat>

    <tal:block replace="nothing">
      ______________ assets ______________
    </tal:block>
    <tal:block
      condition="python:len(assets)"
      repeat="asset assets">

      <tal:block define="
        asset_url asset/absolute_url;
        odd_even python: iterate == 'odd' and 'odd' or 'even';
        iterate repeat/asset/?odd_even;
        ">
        <tr
          tal:define="
            title python:(asset.get_title());
            show_top_border repeat/asset/start;"
          tal:attributes="
            class python: iterate and 'odd' or 'even';
            style python: show_top_border and 'border-top: 1px solid #77858c' or nothing">
          <tal:block replace="nothing">
            _______ checkbox + position cell _______
          </tal:block>
          <td class="listing-left">
            &#8211;
          </td>
          <tal:block replace="nothing">
            _______ icon + id cell _______
          </tal:block>
          <td>
            <tal:block condition="python: hasattr(here, 'externalEditLink_')">
              <span style="float: right;"
                tal:content="structure python: here.externalEditLink_(asset)" />
            </tal:block>
            <a class="icon"
              tal:attributes="
                href string:${asset_url}/edit/tab_edit;
                title asset/meta_type;">
              <img tal:replace="structure python:here.render_icon(asset)" />
            </a>
            <a class="blacklink"
              href="asset"
              title="edit"
              tal:define="id asset/id"
              tal:attributes="href string:${asset_url}/edit/tab_edit"
              tal:content="python: ct(id, 30)"
              i18n:attributes="title"
              >
              id
            </a>
          </td>
          <tal:block replace="nothing">
            _______ title cell _______
          </tal:block>
          <td>
            <a class="blacklink"
              title="preview"
              tal:content="python: asset.get_title() == '' and default or asset.get_title()"
              tal:attributes="
                href string:${asset_url}/edit/tab_preview;
                class python: asset.get_title() == '' and 'closed' or 'blacklink'"
              i18n:attributes="title"
              >
              <em i18n:translate="">view</em>
            </a>
          </td>
          <tal:block replace="nothing">
            _______ modified date cell _______
          </tal:block>
          <td tal:define="modification_time asset/get_modification_datetime | nothing">
            <a class="blacklink" title="metadata"
              tal:condition="modification_time"
              tal:attributes="href string:${asset_url}/edit/tab_metadata"
              tal:content="structure python:mangle.DateTime(modification_time).toShortStr()"
              i18n:attributes="title"
              >
              date
            </a>
            <tal:block condition="not:modification_time">
              <i i18n:translate="">
                unknown
              </i>
            </tal:block>
          </td>
          <tal:block replace="nothing">
            _______ author cell _______
          </tal:block>
          <td tal:content="structure last_author"
            tal:define="last_author python:(asset.sec_get_last_author_info().fullname() or default)">
            unknown
          </td>
        </tr>
      </tal:block>
    </tal:block>
  </tbody>

  <tfoot>
    <tr class="controls">
      <td colspan="5">
      </td>
    </tr>
  </tfoot>
</table>
</metal:fillextra>

</metal:use-macro>
</metal:fill-editor-slot>
</metal:use-macro>
</tal:def>
</html>
