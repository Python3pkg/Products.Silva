<html tal:omit-tag=""
  tal:define="
    global view here;
    global lastclass string:whatever;
    global docma_running python: hasattr(view, 'service_docma') and view.service_docma.try_connection_and_pw();
    global root_url here/get_root;
    global format options/format | python: None;
    global userid view/REQUEST/AUTHENTICATED_USER;
    global queue view/service_docma/get_queue;
    global finished_jobs python: view.service_docma.get_finished_jobs_for_userid(str(userid), format=format);
    global processingident view/service_docma/get_processing_ident;
">

<span tal:replace="nothing">
  _____________________ running job feedback _____________________
</span>
<tal:condition condition="python: processingident != 0">
  <div class="feedback">
        <span i18n:translate="current_job">Current job</span>:
        <span tal:replace="processingident">#</span><br />
        <span i18n:translate="owner">Owner</span>:
        <span tal:replace="python: view.service_docma.get_ident_owner(processingident)">owner</span><br />
        <span i18n:translate="description">Description</span>:
        <span tal:replace="python: view.service_docma.get_ident_description(processingident)">desc</span>
  </div>
</tal:condition>


<span tal:replace="nothing">
  _____________________ processing table  _____________________
</span>
<form action="." enctype="multipart/form-data" method="POST"
  tal:condition="docma_running">
  <table class="listing">
    <thead>
      <tr class="top-controls">
        <td colspan="5">
          <a class="button"
            style="float: right;"
            href="#"
            title="reload to update the queue lists: alt-r"
            accesskey="r"
            onClick="document.location = 'tab_edit_import?focus=queue'; return false;"
            i18n:attributes="title"
            i18n:translate="refresh_queue_lists"
          >
            <u>R</u>efresh queue lists
          </a>
          <h3 i18n:translate="queue_of_items">
            queue of items to process
          </h3>
        </td>
      </tr>
    </thead>

    <tbody>
      <tal:block condition="nothing">
        ______________ docma queue ______________
      </tal:block>
      <tr tal:condition="python: len(queue) != 0">
        <th class="align-right"
          width="4%"
          i18n:translate="job_id">
          Job id
        </th>
        <th width="15%"
          i18n:translate="job_owner">
          job owner
        </th>
        <th
          i18n:translate="description">
          description
        </th>
        <th width="15%"
          i18n:translate="estimated_time">
          estimated time
        </th>
        <th class="align-right"
          width="10%"
          i18n:translate="status">
          status
        </th>
      </tr>

      <tal:repeat repeat="job queue">
        <tr tal:define="iterate repeat/job/odd;"
          tal:attributes="class python: iterate and 'odd' or 'even'">
          <td class="align-right"
            tal:content="job">
            JobId
          </td>
          <td tal:content="python: view.service_docma.get_ident_owner(job)">
            Owner
          </td>
          <td  tal:content="python: view.service_docma.get_ident_description(job)">
            Description
          </td>
          <td>
            <span tal:content="python: view.service_docma.get_estimated_time_for_ident(job)">
            Estimated time</span>
            &nbsp;<span i18n:translate="seconds">seconds</span>
          </td>
          <td class="align-right"
            tal:content="python: view.service_docma.get_status(job)">
            Status
          </td>
        </tr>
      </tal:repeat>

      <tr class="even"
        tal:condition="python: len(queue) == 0">
        <td colspan="5"
          i18n:translate="no_jobs_in_queue">
          There are no jobs in the queue
        </td>
      </tr>
    </tbody>

    <tfoot>
      <tr class="controls">
        <td colspan="5">
       </td>
      </tr>
    </tfoot>
  </table>
</form>


<span tal:condition="nothing">
  _____________________ finished jobs _____________________
</span>

<form action="."
  method="POST"
  name="finishedJobQueue">

  <table class="listing"
    tal:define="ls python: len(finished_jobs) != 0">
    <thead>
      <tr class="top-controls">
        <td colspan="4">
          <h3>
            <span i18n:translate="list_processed_items">
              List of processed items
            </span>
            <tal:condition condition="python: format is not None">
              (<tal:replace replace="python:here.getDocmaFormatName(format)" />)
            </tal:condition>
          </h3>
        </td>
      </tr>
    </thead>

    <tbody>
      <tr tal:condition="ls">
        <th class="align-right"
          width="4%" 
          i18n:translate="job_id">
          Job id
        </th>
        <th width="15%"
          i18n:translate="type">
          Type
        </th>
        <th i18n:translate="description">
          Description
        </th>
        <th class="align-right" 
          width="10%" 
          i18n:translate="download">
          Download
        </th>
      </tr>

      <tal:repeat repeat="job finished_jobs">
        <tr tal:define="iterate repeat/job/odd;"
          tal:attributes="class python: iterate and 'odd' or 'even'">
          <td style="white-space:nowrap;">
            <input name="storageids:list"
              type="checkbox"
              tal:attributes="value python: '%s|%s' % (job.id, job.format)" />
            <span tal:content="job/id">job id</span>
          </td>
          <td tal:content="python:here.getDocmaFormatName(format)">
            format
          </td>
          <td tal:content="job/description">
            description
          </td>
          <td class="align-right">
            <a href="#"
              tal:attributes="href python:'tab_edit_import_download?storageid=%s|%s' % (job.id, job.format)"
              i18n:translate="download">
              download
            </a>
          </td>
        </tr>
      </tal:repeat>

      <tr class="even"
        tal:condition="not:ls">
        <td align="left"
          colspan="4"
          i18n:translate="no_processed_jobs">
          There are no processed jobs
        </td>
      </tr>
    </tbody>

    <tfoot>
      <tr class="controls">
        <td class="align-right"
          colspan="4">
          <tal:condition condition="ls">
            <script type="text/javascript">
            <!-- if (document.forms[0])
            {
              document.write('<input class="button" style="float:left" type="submit" value="select all" name="selectButton" title="select all items: alt-a" accesskey="a" onClick="toggleSelect(); return false" i18n:attributes="value title">');
            }
          // -->

            </script>
            <div notal:condition="may_change_content">
              <input class="warning"
                accesskey="x"
                name="tab_edit_import_delete:method"
                onClick="return confirm('Really remove?')"
                title="there's no undo: alt-x"
                type="submit"
                value="remove" 
                i18n:attributes="onClick value title"/>
              <input class="button"
                accesskey="m"
                name="tab_edit_import_import_and_delete:method"
                title="import to the current location and remove from the list: alt-m"
                type="submit"
                value="import and remove" 
                i18n:attributes="value title" />
              <input class="button"
                accesskey="p"
                name="tab_edit_import_w2s:method"
                title="import to the current location: alt-p"
                type="submit"
                value="import"
                i18n:attributes="value title" />
            </div>
          </tal:condition>
        </td>
      </tr>
    </tfoot>
  </table>
</form>

<script type="text/javascript">
<!-- isSelected = false;

  function toggleSelect() {
    if (isSelected == false) {
      for (i = 0; i < document.finishedJobQueue.length; i++)
        document.finishedJobQueue.elements[i].checked = true ;
      isSelected = true;
      document.finishedJobQueue.selectButton.value = "Deselect all";
      return isSelected;
    }
    else {
      for (i = 0; i < document.finishedJobQueue.length; i++)
        document.finishedJobQueue.elements[i].checked = false ;
      isSelected = false;
      document.finishedJobQueue.selectButton.value = "Select all";
      return isSelected;
    }
  }
  // -->

</script>

</html>
