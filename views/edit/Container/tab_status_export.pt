<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  tal:define="
    view here;
    breadcrumb_vein string:Export;
    active_tab string:tab_status_export;
    parent_screen_name string:Publish;
    docma_running python: hasattr(view, 'service_docma') and view.service_docma.try_connection_and_pw();
    refs request/refs | python:[request['model'].create_ref(request['model'])];
">

<metal:block use-macro="here/macro_index/macros/master">
<metal:block fill-slot="main">

<table class="columns columns2">
  <tbody>
    <tr>
      <td class="left">
        <span tal:replace="nothing">
          ______________ parent screen navigation ______________
        </span>
        <metal:block use-macro="view/macro_parent_screen_navigation/macros/parent" />

        <span tal:replace="nothing">
          _____________________ sidebar subtable _____________________
        </span>
        <span tal:replace="structure python: view.service_sidebar.render(model, 'tab_status_export', breadcrumb_vein)" />
      </td>

      <td class="main">
        <span tal:replace="nothing">
          ______________ export feedback ______________
        </span>
        
        <div class="feedback">
          <b><span i18n:translate="items_selected_for_export">Items selected for export</span>:</b><br />
          <table width="100%" border="0">
            <tr tal:repeat="ref refs">
              <tal:block define="obj python: request['model'].resolve_ref(ref); path python: '/'.join(obj.getPhysicalPath())">
                <td valign="top">
                  <a class="blacklink" tal:attributes="href string:${path}/edit/tab_preview">
                    <b tal:content="structure obj/get_title_html" />
                  </a>
                </td>
                <td valign="top">
                  <a class="blacklink" tal:attributes="href string:${path}/edit">
                    <span tal:replace="python: test(len(obj.id) > 30, '%s...' % obj.id[:30], obj.id)" />
                  </a>&nbsp;
                </td>
              </tal:block>
            </tr>
          </table>
        </div>

        <span tal:replace="nothing">
          _____________________ main subtable _____________________
        </span>
        <form action="." enctype="multipart/form-data" method="POST">
          <input type="hidden" 
            name="refs"
            tal:attributes="value python: '||'.join(refs)" />
          <table class="listing">
            <thead>
              <tr tal:replace="nothing">
                ______________ vein + title row ______________
              </tr>
              <tr>
                <td class="top"
                  colspan="3">
                  <h2 tal:attributes="title string:id: ${model/id}">
                    <img tal:replace="structure python:view.render_icon(model)" />
                    <span i18n:translate="export_from">export from</span> <span tal:replace="structure string:&amp;#xab;${model/get_title_html}&amp;#xbb;">id</span>
                  </h2>
                </td>
              </tr>
              <tr class="top-controls">
                <td colspan="3">
                    <a class="navigation"
                      style="float: right;"
                      href="tab_edit_import"
                      title="over to the import screen: alt-i"
                      accesskey="i"
                      i18n:attributes="title"
                      i18n:translate="import">
                      Import...
                    </a>
                  <h3 i18n:translate="export_to_silva_xml">
                    Export to Silva XML (.slv)
	                </h3>
                </td>
              </tr>
            </thead>

            <tbody>
              <tr>
                <th class="align-right"
                   i18n:translate="options">
                  Options
                </th>
                <th>
                </th>
                <th i18n:translate="note">
                  Note
                </th>
              </tr>

              <tr class="even">
                <td class="align-right"
                  i18n:translate="include_sub_publications?">
                  include sub publications?
                </td>
                <td class="align-center">
                  <input type="checkbox" name="with_sub_publications" />
                </td>
                <td>
                </td>
              </tr>

              <tr class="odd">
                <td class="align-right"
                  i18n:translate="export_newest_versions?">
                  export newest versions?
                </td>
                <td class="align-center">
                  <input type="checkbox" name="export_last_version" />
                </td>
                <td i18n:translate="if_not_checked_the_published_version_is_exported">
                  If not checked the published version is exported
                </td>
              </tr>

              <tr class="even">
                <td class="align-right"
                  i18n:translate="export_closed_content?">
                  Export closed content?
                </td>
                <td class="align-center">
                  <input type="checkbox" name="export_last_version" />
                </td>
                <td i18n:translate="check_to_include_closed_content">
                  Check to include closed content in the export
                </td>
              </tr>
            </tbody>

            <tfoot>
              <tr class="controls">
                <td>
                  <input
                    class="cancel"
                    type="button"
                    name="edit_cancel"
                    value=" Cancel "
                    onClick="history.back()"
                    title="access key: alt-c"
                    accesskey="c"
                    i18n:attributes="value title"
                  />
                </td>
                <td class="align-right"
                  colspan="2">
                  <input class="button"
                    type="submit"
                    name="download_xml_selected:method"
                    value=" Export "
                    title="access key: alt-e"
                    accesskey="e"
                    i18n:attributes="value title"
                  />
                </td>
              </tr>
            </tfoot>
          </table>
        </form>


<span tal:replace="nothing">
  ____________________________ docma facilities ____________________________
</span>

<tal:condition condition="docma_running">

<tal:define define="
  global userid view/REQUEST/AUTHENTICATED_USER;
  global queue view/service_docma/get_queue;
  global qls python:len(queue) != 0;
  global processingident view/service_docma/get_processing_ident;" />

<form action="." enctype="multipart/form-data" method="POST">
  <input type="hidden" 
    name="refs"
    tal:attributes="value python: '||'.join(refs)" />
  <table class="listing sublisting">
    <thead>
      <tr tal:replace="nothing">
        ______________ vein + title row ______________
      </tr>
      <tr>
        <td class="top"
          colspan="5">
          <h2>
            <img class="icon"
              border="0"
              width="16"
              height="16"
              alt="docma icon" 
              tal:attributes="src string:${root_url}/globals/docma.gif"
              i18n:attributes="alt"
            />
            <span i18n:translate="docma_facilities">docma facilities</span>
          </h2>
        </td>
      </tr>

      <tr class="top-controls">
        <td colspan="3">
          <h3 i18n:translate="export_to_docma">
            Export to Docma (.doc)
          </h3>
        </td>
      </tr>
    </thead>

    <tbody>
      <tr>
        <th class="align-right"
           i18n:translate="options">
          Options
        </th>
        <th i18n:translate="content">
          Content
        </th>
        <th width="40%"
          i18n:translate="note">
          Note
        </th>
      </tr>

      <tr class="even">
        <td class="align-right"
          i18n:translate="include_sub_publications?">
          include sub publications?
        </td>
        <td>
          <input type="checkbox" name="with_sub_publications" />
        </td>
        <td>
        </td>
      </tr>

      <tr class="odd">
        <td class="align-right"
          i18n:translate="export_newest_versions?">
          export newest versions?
        </td>
        <td>
          <input type="checkbox" name="export_last_version" />
        </td>
        <td i18n:translate="if_not_checked_the_published_version_is_exported">
          If not checked the published version is exported
        </td>
      </tr>

      <tr class="even">
        <td class="align-right"
          i18n:translate="export_closed_content?">
          export closed content?
        </td>
        <td>
          <input type="checkbox" name="export_last_version" />
        </td>
        <td i18n:translate="check_to_include_closed_content">
          Check to include closed content in the export
        </td>
      </tr>

      <tr class="odd">
        <td class="align-right">
          <span i18n:translate="email_address">email address</span><span class="warning">*</span>
        </td>
        <td align="left">
          <input style="width: 100%;"
            type="text"
            name="email"
            tal:attributes="
              value python:here.service_members.get_member(user.getUserName()).email() or ''"
          />
        </td>
        <td i18n:translate="email_will_be_sent">
          An email will be sent when the item is processed.
        </td>
      </tr>

      <tr class="even">
        <td class="align-right"
          i18n:translate="choose_a_template">
          choose a template
        </td>
        <td align="left">
          <select name="template">
            <option value="">
              none
            </option>
            <tal:repeat repeat="template view/service_docma/get_templates">
              <option tal:content="template"
                tal:attributes="value template">
              </option>
            </tal:repeat>
          </select>
        </td>
        <td>
          &nbsp;
        </td>
      </tr>

      <tr class="odd">
        <td class="align-right"
          i18n:translate="description">
          description
        </td>
        <td>
          <textarea name="description"
            style="width: 100%;"
            tal:content="model/get_title_html"></textarea>
        </td>
        <td i18n:translate="description_shown_in_queue">
          This description will be shown in the queue and the list of processed items.
        </td>
      </tr>
    </tbody>

    <tfoot>
      <tr class="inter-controls">
        <td class="align-right"
          colspan="3">
        <tal:block condition="may_change_content">
          <input class="button"
          type="submit"
          name="tab_status_silva2word:method"
          value="Export to Docma"
          title="export the selection to Word: alt-d"
          accesskey="d"
          i18n:attributes="value title"
        />
        </tal:block>
        </td>
      </tr>
    </tfoot>
  </table>
</form>

<span tal:replace="nothing">
  _____________________ docma queue: processing list + finished jobs _____________________
</span>
<tal:define define="
    format string:word;
    refresh_page string:tab_status_export;
">
<metal:use-macro use-macro="here/docma_queue/macros/listings">
<metal:fill-slot fill-slot="manipulators">
  <input class="warning"
    accesskey="x"
    name="export_delete:method"
    onClick="return confirm('Really remove?')"
    title="there's no undo: alt-x"
    type="submit"
    value="remove" 
    i18n:attributes="onClick value title"
  />
</metal:fill-slot>
</metal:use-macro>
</tal:define>

</tal:condition>

      </td>
    </tr>
  </tbody>
</table>

</metal:block>
</metal:block>
</html>
