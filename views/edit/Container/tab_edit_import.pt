<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/tal/i18n"
  tal:define="
    global view here;
    global breadcrumb_vein string:Import;
    global active_tab string:tab_edit;
    global parent_screen_name string:Contents;
    global docma_running python: hasattr(view, 'service_docma') and view.service_docma.try_connection_and_pw();
    global lastclass string:even;
    global silva_permissions here/get_silva_permissions;
    global userid view/REQUEST/AUTHENTICATED_USER;
">
<metal:block use-macro="here/macro_index/macros/master">
<metal:block fill-slot="main">

<tal:block condition="view/REQUEST/focus | nothing">
<script language="JavaScript"
  tal:content="string:document.location = 'tab_edit_import#${view/REQUEST/focus}';">
</script>
</tal:block>

<table class="columns columns2">
  <tbody>
    <tr>
      <td class="left">
        <span tal:replace="nothing">
          ______________ parent screen navigation ______________
        </span>
        <metal:block use-macro="view/macro_parent_screen_navigation/macros/parent" />

        <span tal:replace="nothing">
          _____________________ sidebar subtable _____________________
        </span>
        <span tal:replace="structure python: view.service_sidebar.render(model, 'tab_edit_import', breadcrumb_vein)" />
      </td>

    <td class="main">
      <tal:block replace="nothing">
        _____________________ main subtable _____________________
      </tal:block>

<form action="." enctype="multipart/form-data" method="POST">
  <table class="listing">
    <thead>
      <tr tal:replace="nothing">
        ______________ vein + title row ______________
      </tr>
      <tr>
        <td class="top"
          colspan="3">
          <h2 tal:attributes="title string:id: ${model/id}">
            <img tal:replace="structure python:view.render_icon(model)" />
            <span i18n:translate="import_in">import in</span> <span tal:replace="structure string:&amp;#xab;${model/get_title_html}&amp;#xbb;">id</span>
          </h2>
        </td>
      </tr>
      <tr class="top-controls">
        <td colspan="3">
            <a class="navigation"
              style="float: right;"
              href="tab_status_export"
              title="over to the export screen: alt-e"
              accesskey="e"
	      i18n:attributes="title"
              i18n:translate="export">Export...
            </a>
          <h3 i18n:translate="import_silva_xml">
	    import Silva XML (.slv)
	  </h3>
        </td>
      </tr>
    </thead>

    <tbody>
      <tr>
        <th width="15%" i18n:translate="element">
	  Element
        </th>
        <th i18n:translate="content">
	  Content
	</th>
        <th width="40%" i18n:translate="note">
	  Note
        </th>
      </tr>

      <tr class="odd" valign="top">
        <td class="align-right">
          <span i18n:translate="file_to_upload">file to upload</span><span class="warning">*</span>
        </td>
        <td align="left">
          <input type="file"
            name="importfile"
            size="40"
            title="browse for a file on your disk"
	    i18n:attributes="title"
          />
        </td>
        <td i18n:translate="choose_xml_file_to_import">
	  Choose an XML file to import (must be valid Silva XML)
        </td>
      </tr>

    <tr class="controls">
      <td class="align-right"
        colspan="3">
        <input class="cancel"
          style="float: left;"
          type="button"
          value="cancel"
          title="access key: alt-c"
          accesskey="c"
          onClick="history.back()"
	  i18n:attributes="value title"
        />
        <input class="button"
          type="submit"
          value="import"
          name="tab_edit_import_xml:method"
          title="access key: alt-i"
          accesskey="i"
          i18n:attributes="value title"  
        />
      </td>
     </tr>
    </tbody>
   </table>
  </form>

<tal:block condition="docma_running">
<div class="feedback"
 tal:define="
   global queue view/service_docma/get_queue;
   global finished_jobs python: view.service_docma.get_finished_jobs_for_userid(str(userid));
   global processingident view/service_docma/get_processing_ident;"
 tal:condition="python: processingident != 0">
 <span i18n:translate="current_job">urrent&nbsp;job</span>: <span tal:replace="processingident" /><br />
 <span i18n:translate="owner">Owner</span>: <span tal:replace="python: view.service_docma.get_ident_owner(processingident)" /><br />
 <span i18n:translate="description">Description</span>: <span tal:replace="python: view.service_docma.get_ident_description(processingident)" />
</div>

<form action="." enctype="multipart/form-data" method="POST">
  <table class="listing sublisting">
    <thead>
      <tr tal:replace="nothing">
        ______________ vein + title row ______________
      </tr>
      <tr>
        <td class="top"
          colspan="5">
          <h2>
            <img class="icon"
              border="0"
              width="16"
              height="16"
              alt="docma icon" 
              tal:attributes="src string:${root_url}/globals/docma.gif"
              i18n:attributes="alt"
            />
            <span i18n:translate="docma_facilities">docma facilities</span>
          </h2>
        </td>
      </tr>
    </thead>

    <tbody>
      <tr tal:replace="nothing">
        ______________ upload word file ______________
      </tr>
      <tr class="top-controls">
        <td colspan="3">
          <h3 i18n:translate="upload_word_document">
	    upload MSWord document (.doc)
          </h3>
        </td>
      </tr>

      <tr>
        <th width="15%" i18n:translate="element">
	  Element
        </th>
        <th i18n:translate="content">
	  Content
        </th>
        <th width="40%" i18n:translate="note">
	  Note
        </th>
      </tr>

      <tr class="odd" valign="top">
        <td class="align-right">
            <span i18n:translate="file_to_upload">file to upload</span><span class="warning">*</span>
        </td>
        <td align="left">
            <input type="file" size="40" name="importfile" />
        </td>
        <td align="right" i18n:translate="choose_word_file_to_upload">
	  Choose a Word file to upload. It'll be converted and appear in the list of processed items below. It can be imported anywhere in Silva.
        </td>
      </tr>

      <tr class="even" valign="top">
        <td class="align-right">
	  <span i18n:translate="email_address">email address</span><span class="warning">*</span>
        </td>
        <td align="left">
          <input style="width: 100%;"
            type="text"
            name="email"
            tal:attributes="
              value python:here.service_members.get_member(user.getUserName()).email() or ''"
          />
        </td>
        <td i18n:translate="email_will_be_sent">
	  An e-mail will be sent to you when the item is processed.
        </td>
      </tr>

      <tr class="odd" valign="top">
        <td class="align-right" i18n:translate="description">
	  description
        </td>
        <td>
          <textarea name="description"
            style="width: 100%;"
          ></textarea>
        </td>
        <td i18n:translate="description_shown_in_queue">
	  This description will be shown in the queue and the list of processed items.
        </td>
      </tr>

      <tr class="inter-controls">
        <td class="align-right"
          colspan="3">
          <input class="button" 
	    type="submit" 
	    value="upload" 
	    name="tab_edit_import_docma:method" 
	    title="upload a Word document from your local drive: alt-u" 
	    accesskey="u"
	    i18n:attributes="value title"
	  />
        </td>
      </tr>
    </tbody>
  </table>
</form>

</tal:block>


<span tal:replace="nothing">
  _____________________ processing table  _____________________
</span>
<form action="." enctype="multipart/form-data" method="POST"
  tal:condition="docma_running">
  <table class="listing">
    <thead>
      <tr tal:replace="nothing">
        ______________ vein + title row ______________
      </tr>
      <tr class="top-controls">
        <td colspan="5">
          <a class="button"
            style="float: right;"
            href="#"
            title="reload to update the queue lists: alt-r"
            accesskey="r"
            onClick="document.location = 'tab_edit_import?focus=queue'; return false;"
	    i18n:attributes="title"
	    i18n:translate="refresh_queue_lists"
	  >
	    <u>R</u>efresh queue lists
          </a>
          <h3 i18n:translate="queue_of_items">
	    queue of items to process
          </h3>
        </td>
      </tr>
    </thead>

    <tbody>
      <tal:block condition="nothing"> ________ Docma Queue ________ </tal:block>
        <tr tal:condition="python: len(queue) != 0">
          <th align="left" width="8%" i18n:translate="job_id">Job id</th>
          <th align="left" width="15%" i18n:translate="">job owner</th>
          <th align="left" i18n:translate="description">description</th>
          <th align="left" width="15%" i18n:translate="status">status</th>
          <th align="left" width="10%" i18n:translate="estimated_time">estimated time</th>
        </tr>

        <tr tal:repeat="job queue" tal:define="class python:test(lastclass == 'even', 'odd', 'even'); lastclass class" tal:attributes="class lastclass">
          <td align="left" tal:content="job">JobId</td>
          <td align="left" tal:content="python: view.service_docma.get_ident_owner(job)">Owner</td>
          <td align="left" tal:content="python: view.service_docma.get_ident_description(job)">Description</td>
          <td align="left" tal:content="python: view.service_docma.get_status(job)">Status</td>
          <td align="left" tal:content="python: '%s seconds' % view.service_docma.get_estimated_time_for_ident(job)">Estimated time</td>
        </tr>

        <tr class="odd" tal:condition="python: len(queue) == 0">
          <td align="left" colspan="5" i18n:translate="no_jobs_in_queue">There are no jobs in the queue</td>
        </tr>
      </tbody>

      <tfoot>
        <tr class="divider">
          <td colspan="5">
         </td>
        </tr>
      </tfoot>
    </table>
  </form>

  <tal:block condition="nothing"> _______ Finished Queue _______ </tal:block>

  <form name="finishedJobQueue" action="." method="POST"
   tal:condition="docma_running">
    <table class="listing">
      <tbody>
        <tr class="top-controls">
          <td colspan="5">
            <h3 i18n:translate="list_proccessed_items">
              list of processed items
            </h3>
          </td>
        </tr>

        <tr tal:condition="python: len(finished_jobs) != 0">
          <th class="align-right" colspan="2" width="8%" i18n:translate="job_number">Job #</th>
          <th width="15%" i18n:translate="type">Type</th>
          <th i18n:translate="description">Description</th>
          <th class="align-right" width="10%" i18n:translate="download">Download</th>
        </tr>

        <tr tal:repeat="job finished_jobs"
          tal:define="
            class python:test(lastclass == 'even', 'odd', 'even');
            lastclass class"
          tal:attributes="class class">
          <td width="1%"><input type="checkbox" name="storageids:list" tal:attributes="value python: '%s|%s' % (job.id, job.format)"/></td>
          <td tal:content="python: job.id">JobId</td>
          <td tal:condition="python: job.format == 'silva'">Silva XML</td>
          <td tal:condition="python: job.format == 'word'">Word&nbsp;document</td>
          <td tal:content="python: job.description">Description</td>
          <td class="align-right"><a href="#" tal:attributes="href python:'tab_edit_import_download?storageid=%s|%s' % (job.id, job.format)">Download</a></td>
        </tr>

        <tr class="odd"
           tal:condition="python: len(finished_jobs) == 0">
          <td colspan="5" i18n:translate="no_processed_jobs">There are no processed jobs</td>
        </tr>
      </tbody>

      <tfoot>
        <tr class="controls">
          <td colspan="3">
            <tal:condition condition="python: len(finished_jobs) != 0">
              <script type="text/javascript">
                <!--
                  if (document.forms[0])
                  {
                    document.write('<input class="button" type="submit" value="select all" value="submit" name="selectButton" value="select all" title="select all items: alt-a" accesskey="a" onClick="toggleSelect(); return false" i18n:attributes="value title">');
                  }
                //-->
              </script>
            </tal:condition>
          </td>
          <td class="align-right"
            colspan="2">
            <tal:condition condition="python: len(finished_jobs) != 0">
              <tal:block condition="silva_permissions/ChangeSilvaContent">
                <input class="warning" 
		  type="submit" 
		  name="tab_edit_import_delete:method" 
		  value="remove" 
		  title="there's no undo: alt-x" 
		  accesskey="x" 
		  onClick="return confirm('Really remove?')"
                  i18n:attributes="value title onClick"
                />
                <input class="button" 
		  type="submit" 
		  name="tab_edit_import_import_and_delete:method" 
		  value="import and remove" 
		  title="import to the current location and remove from the list: alt-m" 
		  accesskey="m"
		  i18n:attributes="value title"
		/>
                <input class="button" 
		  type="submit" 
		  name="tab_edit_import_w2s:method" 
		  value="Import" 
		  title="import to the current location: alt-p" 
		  accesskey="p"
		  i18n:attributes="value title"
		/>
              </tal:block>
            </tal:condition>
          </td>
        </tr>
      </tfoot>
    </table>
  </form>

   </td>
  </tr>
 </tbody>
</table>

<br />






<script type="text/javascript">
    <!--
    isSelected = false;

    function toggleSelect() {
      if (isSelected == false) {
        for (i = 0; i < document.finishedJobQueue.length; i++)
          document.finishedJobQueue.elements[i].checked = true ;
        isSelected = true;
        document.finishedJobQueue.selectButton.value = "Deselect all";
        return isSelected;
      }
      else {
        for (i = 0; i < document.finishedJobQueue.length; i++)
          document.finishedJobQueue.elements[i].checked = false ;
        isSelected = false;
        document.finishedJobQueue.selectButton.value = "Select all";
        return isSelected;
      }
    }
    //-->
</script>

</metal:block>
</metal:block>
</html>
