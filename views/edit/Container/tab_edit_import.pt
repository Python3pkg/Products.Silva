<init tal:omit-tag=""
  tal:define="global view here;
              global active_tab string:tab_edit;
              global breadcrumb_vein string:Import;
              global lastclass string:focus-cycle;
              global silva_permissions here/get_silva_permissions;
              global docma_running python: hasattr(view, 'service_docma') and view.service_docma.try_connection_and_pw();
              " />

<!-- ____________________________ start index_html ____________________________ -->
<html metal:use-macro="here/macro_index/macros/master">

<div tal:omit-tag="" metal:fill-slot="main">
<!-- ____________________________ start index_html/slot main ___________________________ -->

<tal:block condition="view/REQUEST/focus | nothing">
<script language="JavaScript" tal:content="string:document.location = 'tab_edit_import#${view/REQUEST/focus}';" />
</tal:block>

<div class="margins">
<h3><a href="tab_edit" title="Up to top of Edit tab">Contents
  <img tal:attributes="src string:${silva_root}/globals/up_gray.gif" width="16" height="11" border="0" alt="Up to top of Edit tab" /></a></h3>
<h2 class="worksheet">Import options for <span class="folder-title" tal:content="structure string:&laquo;${model/get_title_html}&raquo;">title here</span></h2>

<div class="worksheet borders top bottom left right">

<table width="100%" cellspacing="0" cellpadding="5" border="0">
  <tr>
    <td>

      <form action="." enctype="multipart/form-data" method="POST">
        <table width="100%" cellspacing="0" cellpadding="3" border="0">

          <tr>
            <td colspan="4">
              <h3>Import Silva XML (.slv)
	      </h3>
            </td>
          </tr>

          <tr>
            <th align="left" width="15%">
              Element
            </th>
            <th align="right" width="1%">
              &nbsp;
            </th>
            <th align="left">
              Content
            </th>
            <th align="left" width="40%">
              Note
            </th>
          </tr>

          <tr class="focus-cycle" valign="top">
            <td align="left">
                File to upload:
            </td>
            <td align="right">
            <span class="warning">
              *
            </span>
            </td>
            <td align="left">
                <input type="file" size="40" name="importfile" />
            </td>
            <td>
                Choose an XML file to import (must be valid Silva XML)
            </td>
          </tr>

          <tr class="controls">
            <td>
                <button class="cancel" type="submit" name="edit_cancel" onClick="history.back()" title="Access key: alt-c" accesskey="c"> <u>C</u>ancel </button>
            </td>
            <td colspan="3" align="right">
                <button type="submit" name="tab_edit_import_xml:method" value="tab_edit_import_xml:method" title="Access key: alt-i" accesskey="i"> <u>I</u>mport </button>
            </td>
          </tr>
        </table>

      </form>

    </td>
  </tr>

</table>

<br />
<br />

<table width="100%" cellspacing="0" cellpadding="5" border="0" tal:condition="docma_running">
  <tr>
    <td>

      <form action="." enctype="multipart/form-data" method="POST">
        <table width="100%" cellspacing="0" cellpadding="3" border="0">

          <tr>
            <td colspan="4">
              <h3>Upload Word document (.doc)
                <img src="pixel.gif" width="1px" height="14px"
                     tal:attributes="src string:${silva_root}/globals/pixel.gif" />
              </h3>
            </td>
          </tr>

          <tr>
            <th align="left" width="15%">
              Element
            </th>
            <th align="right" width="1%">
              &nbsp;
            </th>
            <th align="left">
              Content
            </th>
            <th align="left" width="40%">
              Note
            </th>
          </tr>

          <tr class="focus-cycle" valign="top">
            <td align="left">
                File to upload:
            </td>
            <td align="right">
            <span class="warning">
              *
            </span>
            </td>
            <td align="left">
                <input type="file" size="40" name="importfile" />
            </td>
            <td align="right">
                Choose a Word file to upload. Note that this file will be processed and then placed on the list of finished items, so you can import it anywhere in Silva.
            </td>
          </tr>

          <tr class="focus-cycle" valign="top">
            <td align="left">
                E-mail address:
            </td>
            <td align="right">
            <span class="warning">
              *
            </span>
            </td>
            <td align="left">
                <input type="text" name="email" style="width: 100%" />
            </td>
            <td align="right">
                An e-mail will be sent to you when the item is processed.
            </td>
          </tr>

          <tr class="focus-cycle" valign="top">
            <td align="left">
                Description:
            </td>
            <td align="right">
            <span class="warning">
              &nbsp;
            </span>
            </td>
            <td align="left">
                <textarea name="description"></textarea>
            </td>
            <td align="right">
                This description will be shown in the queue and the list of processed items.
            </td>
          </tr>

          <tr class="controls">
            <td colspan="4" align="right">
                <button type="submit" name="tab_edit_import_docma:method" value="tab_edit_import_docma:method" title="Upload a Word document from your local drive - alt u" accesskey="u"> <u>U</u>pload </button>
            </td>
          </tr>
        </table>

      </form>

    </td>
  </tr>

</table>

</div>


<div class="worksheet borders top bottom left right" tal:condition="docma_running">

<init tal:define="global userid view/REQUEST/AUTHENTICATED_USER;
                  global queue view/service_docma/get_queue;
                  global finished_jobs python: view.service_docma.get_finished_jobs_for_userid(str(userid));
                  global processingident view/service_docma/get_processing_ident;" />

<table width="100%" cellspacing="0" cellpadding="5" border="0">
  <tr>
    <td>

      <tal:block tal:condition="python: processingident != 0">
        <table width="100%" cellspacing="0" cellpadding="0" class="feedback">
          <tr>
            <td>Current&nbsp;job: <span tal:replace="processingident" /></td>
          </tr>
          <tr>
            <td>Owner: <span tal:replace="python: view.service_docma.get_ident_owner(processingident)" /></td>
          </tr>
          <tr>
            <td>Description: <span tal:replace="python: view.service_docma.get_ident_description(processingident)" /></td>
          </tr>
        </table>
      </tal:block>

      <form action="." enctype="multipart/form-data" method="POST">

        <table width="100%" cellpadding="3" cellspacing="0">

        <tal:block condition="nothing"> ________ Docma Queue ________ </tal:block>

          <tr>
            <td colspan="5">
              <h3><a name="queue">Queue of items to process</a>
              </h3>
            </td>
          </tr>

          <tr class="topcontrols">
            <td align="right" colspan="5">
              <a class="buttonlink" href="#" onClick="document.location = 'tab_edit_import?focus=queue'; return false;" title="Reload to update the queue lists - alt r" accesskey="r">&nbsp;<u>R</u>efresh queue lists&nbsp;</a>
            </td>
          </tr>

          <tr>
            <th align="left" width="8%">Job&nbsp;id</th>
            <th align="left" width="15%">Job&nbsp;owner</th>
            <th align="left">Description</th>
            <th align="left" width="15%">Status</th>
            <th align="left" width="10%">Estimated&nbsp;time</th>
          </tr>

          <tr tal:repeat="job queue" tal:define="class python:test(lastclass == 'focus', 'focus-cycle', 'focus'); lastclass class" tal:attributes="class class">
            <td align="left" tal:content="job">JobId</td>
            <td align="left" tal:content="python: view.service_docma.get_ident_owner(job)">Owner</td>
            <td align="left" tal:content="python: view.service_docma.get_ident_description(job)">Description</td>
            <td align="left" tal:content="python: view.service_docma.get_status(job)">Status</td>
            <td align="left" tal:content="python: '%s seconds' % view.service_docma.get_estimated_time_for_ident(job)">Estimated time</td>
          </tr>

          <tr class="focus" tal:condition="python: len(queue) == 0">
            <td align="left" colspan="5">There are no jobs in the queue</td>
          </tr>

          <tr>
            <td class="divider" colspan="5"><img tal:attributes="src string:${silva_root}/globals/pixel.gif" width="1" height="3" /></td>
          </tr>

        </table>

      </form>

      <br /><br />

      <form name="finishedJobQueue" action="." method="POST">

        <table width="100%" cellpadding="3" cellspacing="0">

        <tal:block condition="nothing"> ________ Finished Queue ________ </tal:block>

          <tr>
            <td colspan="5">
              <h3>List of processed items
              </h3>
            </td>
          </tr>

          <tr>
            <th align="left" colspan="2" width="8%">Job&nbsp;id</th>
            <th align="left" width="10%">Type</th>
            <th align="left">Description</th>
          </tr>

          <tr tal:repeat="job finished_jobs" tal:define="class python:test(lastclass == 'focus', 'focus-cycle', 'focus'); lastclass class" tal:attributes="class class">
            <td align="left" width="1%"><input type="checkbox" name="storageids:list" tal:attributes="value python: '%s|%s' % (job[0], job[2])"/></td>
            <td align="left" tal:content="python: job[0]">JobId</td>
            <td align="left" tal:condition="python: job[2] == 'silva'">Silva XML</td>
            <td align="left" tal:condition="python: job[2] == 'word'">Word Document</td>
            <td align="left" tal:content="python: job[1]">Description</td>
          </tr>

          <tr class="focus" tal:condition="python: len(finished_jobs) == 0">
            <td align="left" colspan="4">There are no processed jobs</td>
          </tr>

          <tr class="controls">
            <td colspan="3" align="left">
            <script type="text/javascript">
              <!--
                if (document.forms[0])
                {
                  document.write('<input class="button" type="submit" value="Select all..." value="submit" name="selectButton" value="Select all" title="Select all items in this folder" onClick="toggleSelect(); return false">');
                }
              //-->
            </script>
            </td>
            <td align="right">
            <tal:block condition="silva_permissions/ChangeSilvaContent">
                &nbsp;&nbsp;<input class="warningbutton" type="submit" name="tab_edit_import_delete:method" value=" Remove " title="There's no undo" onClick="return confirm('Really remove?')" />
                &nbsp;&nbsp;<input class="button" type="submit" name="tab_edit_import_download:method" value=" Download " title="Download this item" />
                &nbsp;&nbsp;<input class="button" type="submit" name="tab_edit_import_import_and_delete:method" value=" Import and remove " title="Import to the current location and remove from the list" />
                &nbsp;&nbsp;<input class="button" type="submit" name="tab_edit_import_w2s:method" value=" Import " title="Import to the current location" />
            </tal:block>
            </td>
          </tr>

        </table>

      </form>

    </td>
  </tr>

</table>

</div>

</div>
</div>
</html>
