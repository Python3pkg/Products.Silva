_____________________ Author requests approval _______________________________
<div metal:define-macro="request_approval" tal:omit-tag="">

<h3>Request Approval<span tal:condition="python:silva_permissions['ChangeSilvaContent'] and unapproved and published"> for new version</span></h3>

<form action="tab_status_request" method="POST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr class="border">
<th align="left">Message to editor</th>
<th align="left">Notes</th>
</tr>

<tr class="focus-cycle" valign="top">
<td align="right">
<span class="textarea">
<field tal:replace="structure python:view.tab_status_form_author.message.render(REQUEST=request)" />
</span>
</td>
<td width="30%" valign="top">
This message may be read by interested editors / authors.
</td>
</tr>

<tr class="focus-cycle" tal:condition="python:model.get_approval_request_message()">
<td colspan="2">
A previous request for approval has been rejected / withdrawn by 
<span tal:replace="python:model.get_approval_requester()" /> at 
<span tal:replace="structure python:here.service_utils.backend_datetime_to_str(model.get_approval_request_datetime())">some date</span>
<br />
<comment tal:condition="nothing"> actually the last message may not been written
   by the person withdrawing the request; if this person did an e.g. an empty reject, this is 
   the message of the requester ...
</comment>
The last message related to this is:
<div class="message" tal:content="python:model.get_approval_request_message()" />
</td>
</tr>

<tr class="focus" valign="top">
<td align="right">
Content publish time:&nbsp;
<field tal:replace="structure 
      python:view.tab_status_form_author.publish_datetime.
                render(value=model.get_unapproved_version_publication_datetime(), REQUEST=request)" 
/>
</td>
<td>
&nbsp;
</td>
</tr>

<tr class="focus-cycle" valign="top">
<td align="right">
Expiration time:&nbsp;
<field tal:replace="structure 
     python:view.tab_status_form_author.expiration_datetime.
          render(value=model.get_unapproved_version_expiration_datetime(), REQUEST=request)" 
/>
</td>
<td>
If this content should expire, set the time.&nbsp;
</td>
</tr>

<tr class="focus" valign="top">
<td align="right">
&nbsp;
</td>
<td align="right">
Turn on expiration time?&nbsp;<field
    tal:replace="structure python:view.tab_status_form_author.expires_flag.render(REQUEST=request)" />
</td>
</tr>

<tr class="controls">
<td colspan="3" align="right">
<input type="submit" value=" Request approval " class="button" title="Access key: alt-r" accesskey="r" />
</td>
</tr>
</table>
</form>
</div>

_____________________ /Author requests approval _________________________________


_____________________ Author / Editor withdraws request for  approval _________________________________
<div metal:define-macro="withdraw_request_approval" tal:omit-tag="">
<form action="tab_status_withdraw" method="POST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr>
<th align="left" colspan="2">
<span tal:omit-tag="" tal:replace="python:test(silva_permissions['ApproveSilvaContent'],'Reject',default)">Withdraw</span> request for approval
</th>
</tr>
<tr class="focus">
<td colspan="2">
 Author <span tal:replace="python:model.get_approval_requester()">author id</span>
has requested approval at 
<span tal:replace="structure python:here.service_utils.backend_datetime_to_str(model.get_approval_request_datetime())">some date</span>
<tal:if condition="python:model.get_approval_request_message()">
with the following comments:
<div class="message" tal:content="python:model.get_approval_request_message()" />
</tal:if>
</td></tr>
<tr>
<input type="hidden" name="rejection_status" tal:attributes="value python:test(silva_permissions['ApproveSilvaContent'], 'true', 'false')" />
<input type="hidden" name="tab_name" value="publish" />
<th align="left" colspan="2">
Add message on 
<span tal:replace="python:test(silva_permissions['ApproveSilvaContent'],'rejection',default)">withdraw</span>:
</th>
</tr>
<tr class="focus-cycle">
<td>
<span class="textarea">
<textarea name="message" cols="65" rows="7" wrap="soft">
</textarea></span>
</td>
<td width="30%" valign="top">
<span tal:replace="nothing"> _______ tips go here _______ </span>
The message may be viewed by interested authors.
</td>
</tr>
<tr class="controls">
<td>
&nbsp;
</td>
<td align="right" width="40%">
<input type="submit" value=" Withdraw approval " class="button"  title="Access key: alt-r" accesskey="r"
  tal:attributes="value python:test(silva_permissions['ApproveSilvaContent'],' Reject approval request ',' Withdraw approval request ')" />
</td>
</tr>
</table>
</form>
<br />
<br />
</div>

_____________________ /Author / Editor withdraws request for  approval _________________________________



_____________________ Editor approves or rejects ________________________
<div metal:define-macro="approve_new" tal:omit-tag="">

<span tal:replace="nothing"> ______________ approve section ______________ </span>

<h3>Approve<span tal:condition="python:silva_permissions['ChangeSilvaContent'] and unapproved and published"> new version</span></h3>

<form action="tab_status_approve" method="POST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr>
<th align="left">
Settings
</th>
<th align="left" width="40%">
Notes
</th>
</tr>

<tr class="focus" valign="top">
<td align="right">
Content publish time:&nbsp;
<field tal:replace="structure 
    python:view.tab_status_form_editor.publish_datetime.
       render(REQUEST=request)
" />
</td>
<td>
&nbsp;
</td>
</tr>

<tr class="focus-cycle" valign="top">
<td align="right">
Expiration time:&nbsp;
<field tal:replace="structure 
     python:view.tab_status_form_editor.expiration_datetime.
         render(REQUEST=request)
" />
</td>
<td>
If this content should expire, set the time.&nbsp;
</td>
</tr>

<tr class="focus" valign="top">
<td align="right">
&nbsp;
</td>
<td align="right">
Turn on expiration time?&nbsp;<field
    tal:replace="structure python:view.tab_status_form_editor.expires_flag.render(REQUEST=request)" />
</td>
</tr>

<tr class="focus-cycle" valign="top">
<td align="right">
&nbsp;
</td>
<td align="right">
Publish right now?&nbsp;<field
    tal:replace="structure python:view.tab_status_form_editor.publish_now_flag.render(REQUEST=request)" />
</td>
</tr>

<tr class="controls">
<td colspan="2" align="right">
<input class="button" type="submit" value="Approve content" class="button" title="Access key: alt-a" accesskey="a" />
</td> 
</tr>

<tr tal:replace="nothing">
<th align="left" colspan="2">
Message to author
</th>
</tr>

<tr class="focus" valign="top" tal:replace="nothing">
<td align="right">
<span class="textarea">
<field tal:replace="structure python:view.tab_status_form_editor.message.render()" />
</span>
</td>
<td width="30%">
This message will be sent to <a href="mailto:fritz@web.eur.nl">fritz@web.eur.nl</a>.
</td>
</tr>

<tr class="controls" tal:replace="nothing">
<td colspan="2" align="right">
<input type="submit" name="tab_status_approve_email:method" value="Approve content + send email" class="button" title="Access key: alt-s" accesskey="s" />
</td>
</tr>
</table>
</form>

<br />
<br />
</div>
_____________________ / Editor approves or rejects _________________________


_____________________ Editor can change settings _______________________
<div metal:define-macro="approved_editor" tal:omit-tag="">

<form action="tab_status_change_settings" method="POST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr>
<th align="left">Current settings</th>
<th align="left">Notes</th>
</tr>

<tr class="focus" valign="top">
<td align="right">
Publish time:&nbsp;
<field tal:replace="structure python:view.tab_status_form_change_settings.publish_datetime.render(model.get_next_version_publication_datetime())" />
</td>
<td>
&nbsp;
</td>
</tr>

<tr class="focus-cycle" valign="top">
<td align="right">
Expiration time:&nbsp;
<field tal:replace="structure python:view.tab_status_form_change_settings.expiration_datetime.render(model.get_next_version_expiration_datetime())" />
</td>
<td>
If this content should expire, set the time.&nbsp;
</td>
</tr>

<tr class="focus" valign="top">
<td align="right">
&nbsp;
</td>
<td align="right">
Turn on expiration time?&nbsp;<field
    tal:replace="structure python:view.tab_status_form_change_settings.expires_flag.render(model.get_next_version_expiration_datetime() is not None)" />
</td>
</tr>

<tr class="focus-cycle" valign="top">
<td align="left">&nbsp;
</td>
<td align="right">
Publish right now?&nbsp;<field
    tal:replace="structure python:view.tab_status_form_change_settings.publish_now_flag.render()" />
</td>
</tr>

<tr class="controls">
<td colspan="3" align="right">
<input type="submit" value=" Change settings " class="button"  title="Access key: alt-c" accesskey="c" />
</td>
</tr>
</table>
</form>

<br />
<br />

</div>
_____________________ / Editor can change settings _________________________

_____________________ revoke approval ________________________________________
<div metal:define-macro="revoke_approval" tal:omit-tag="">
<form action="tab_status_revoke" method="POST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr>
<th align="left" colspan="2">
Revoke approval
</th>
</tr>
<tr class="focus">
<td colspan="2">
If further editing is required, first revoke the approval.
</td></tr>
<tr class="controls">
<td>
&nbsp;
</td>
<td align="right" width="40%">
<input type="submit" value=" Revoke approval " class="button" title="Access key: alt-r" accesskey="r" />
</td>
</tr>
</table>
</form>
<br />
<br />
</div>
_____________________ /revoke approval __________________________________________


_____________________ manual close ___________________________________________
<div metal:define-macro="manual_close" tal:omit-tag="">
<form action="tab_status_close" method="ST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr class="controls">
<th align="left">
Manual close 
</th>
</tr>
<tr class="focus">
<td>
If necessary, the published version of this content can be manually closed (taken offline). It will also be removed from the public index.
</td>
</tr>
<tr class="controls">
<td align="right">
<input class="button" type="submit" value=" Close published version " title="Access key: alt-c" accesskey="c" />
</td>
</tr>
</table>
</form>
</div>
_____________________ /manual close _____________________________________________

