<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  >

<span tal:replace="nothing"> _______ Author requests approval _______ </span>
<div metal:define-macro="request_approval" tal:omit-tag="">

<h3>Request Approval<span tal:condition="python:may_change_content and unapproved and published"> for new version</span></h3>

<form action="tab_status_request" method="POST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr class="border">
<th align="left">Message to editor</th>
<th align="left">Notes</th>
</tr>

<tr class="focus-cycle" valign="top">
<td align="right">
<span class="textarea">
<field tal:replace="structure python:view.tab_status_form_author.message.render(REQUEST=request)" />
</span>
</td>
<td width="30%" valign="top">
This message may be read by interested editors / authors.
</td>
</tr>

<tr class="focus-cycle" tal:condition="python:model.get_approval_request_message()">
<td colspan="2">
A previous request for approval has been rejected / withdrawn by 
<span tal:replace="python:model.get_approval_requester()" /> at 
<span tal:replace="structure python:here.service_utils.backend_datetime_to_str(model.get_approval_request_datetime())">some date</span>
<br />
<comment tal:condition="nothing"> actually the last message may not been written
   by the person withdrawing the request; if this person did an e.g. an empty reject, this is 
   the message of the requester ...
</comment>
The last message related to this is:
<div class="message" tal:content="python:model.get_approval_request_message()" />
</td>
</tr>

<tr class="focus-cycle" valign="top">
<td align="right">
<label title="Access key: alt-m (some platforms)" accesskey="m">Content publish time:</label>&nbsp;
<field tal:replace="structure 
      python:view.tab_status_form_author.publish_datetime.
                render(value=model.get_unapproved_version_publication_datetime(), REQUEST=request)" 
/>
</td>
<td>
&nbsp;
</td>
</tr>

<tr class="focus" valign="top">
  <td align="right">
    <label title="Access key: alt-i (some platforms)" accesskey="i">Expiration time:</label>&nbsp;
    <field tal:replace="structure 
      python:view.tab_status_form_author.expiration_datetime.
      render(value=model.get_unapproved_version_expiration_datetime(), REQUEST=request)" 
    />
  </td>
  <td>
    If this content should expire, set the time.&nbsp;
  </td>
</tr>

<tr class="focus" valign="top">
<td align="right">
&nbsp;
</td>
<td align="right">
<!-- label for="expires_flag" title="Access key: alt-x" accesskey="x">Turn on e<u>x</u>piration time?&nbsp;</label><field
    tal:replace="structure python:view.tab_status_form_author.expires_flag.render(REQUEST=request)" / -->
</td>
</tr>

<tr class="controls">
<td colspan="3" align="right">
<input type="submit" value=" Request approval " class="button" title="Access key: alt-r" accesskey="r" />
</td>
</tr>
</table>
</form>
</div>
<span tal:replace="nothing"> _______ / Author requests approval _______ </span>


<span tal:replace="nothing"> _______ Author/Editor withdraws request for  approval _______ </span>
<div metal:define-macro="withdraw_request_approval" tal:omit-tag="">
<form action="tab_status_withdraw" method="POST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr>
<th align="left" colspan="2">
<span tal:omit-tag="" tal:replace="python:test(may_approve_content,'Reject',default)">Withdraw</span> request for approval
</th>
</tr>
<tr class="focus">
<td colspan="2">
 Author <span tal:replace="python:model.get_approval_requester()">author id</span>
has requested approval at 
<span tal:replace="structure python:here.service_utils.backend_datetime_to_str(model.get_approval_request_datetime())">some date</span>
<tal:if condition="python:model.get_approval_request_message()">
with the following comments:
<div class="message" tal:content="python:model.get_approval_request_message()" />
</tal:if>
</td></tr>
<tr>
<input type="hidden" name="rejection_status" tal:attributes="value python:test(may_approve_content, 'true', 'false')" />
<input type="hidden" name="tab_name" value="publish" />
<th align="left" colspan="2">
Add message on 
<span tal:replace="python:test(may_approve_content,'rejection',default)">withdraw</span>:
</th>
</tr>
<tr class="focus-cycle">
<td>
<span class="textarea">
<textarea name="message" cols="65" rows="7" wrap="soft">
</textarea></span>
</td>
<td width="30%" valign="top">
<span tal:replace="nothing"> _______ tips go here _______ </span>
The message may be viewed by interested authors.
</td>
</tr>
<tr class="controls">
<td>
&nbsp;
</td>
<td align="right" width="40%">
<input type="submit" value=" Withdraw approval " class="button"  title="Access key: alt-r" accesskey="r"
  tal:attributes="value python:test(may_approve_content,' Reject approval request ',' Withdraw approval request ')" />
</td>
</tr>
</table>
</form>
<br />
<br />
</div>
<span tal:replace="nothing"> _______ / Author/Editor withdraws request for  approval _______ </span>


<span tal:replace="nothing"> _______ Editor approves or rejects _______ </span>
<div metal:define-macro="approve_new" tal:omit-tag="">

<h3>Approve<span tal:condition="python:may_change_content and unapproved and published"> new version</span></h3>

<form action="tab_status_approve" method="POST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr>
<th align="left">
Settings
</th>
<th align="left" width="40%">
Notes
</th>
</tr>

<tr class="focus" valign="top">
<td align="right">
<label title="Access key: alt-i (some platforms)" accesskey="i">Expiration time:</label>&nbsp;
<field tal:replace="structure 
     python:view.tab_status_form_editor.expiration_datetime.
         render(REQUEST=request)
" />
</td>
<td>
If this content should expire, set the time.&nbsp;
</td>
</tr>

<tr class="focus-cycle" valign="top">
<td align="right">
<label title="Access key: alt-m (some platforms)" accesskey="m">Content publish time:</label>&nbsp;
<field tal:replace="structure 
    python:view.tab_status_form_editor.publish_datetime.render(REQUEST=request)
" />
</td>
<td>
&nbsp;
</td>
</tr>

<tr class="focus" valign="top">
<td align="right">
&nbsp;
</td>
<td align="right">
<label for="expires_flag" title="Access key: alt-x" accesskey="x">Turn on e<u>x</u>piration time?&nbsp;</label><field
    tal:replace="structure python:view.tab_status_form_editor.expires_flag.render(REQUEST=request)" />
</td>
</tr>

<tr class="focus-cycle" valign="top">
<td align="right">
&nbsp;
</td>
<td align="right">
<label for="publish_now_flag" title="Access key: alt-u" accesskey="u">P<u>u</u>blish right now?&nbsp;</label><field
    tal:replace="structure python:view.tab_status_form_editor.publish_now_flag.render(REQUEST=request)" />
</td>
</tr>

<tr class="controls">
<td colspan="2" align="right">
<input class="button" type="submit" value="Approve content" title="Access key: alt-a" accesskey="a" />
</td> 
</tr>

</table>
</form>

<br />
<br />
</div>
<span tal:replace="nothing"> _______ / Editor approves or rejects _______ </span>


<span tal:replace="nothing"> _______ Editor can change settings _______ </span>
<div metal:define-macro="approved_editor" tal:omit-tag="">

<form action="tab_status_change_settings" method="POST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr>
<th align="left">Current timings</th>
<th align="left">Notes</th>
</tr>

<tr class="focus-cycle" valign="top">
<td align="right">
<label title="Access key: alt-m (some platforms)" accesskey="m">Publish time:</label>&nbsp;
<field tal:replace="structure python:view.tab_status_form_change_settings.publish_datetime.render(model.get_next_version_publication_datetime())" />
</td>
<td>
&nbsp;
</td>
</tr>

<tr class="focus" valign="top">
  <td align="right">
    <label title="Access key: alt-i (some platforms)" accesskey="i">Expiration time:</label>&nbsp;
    <field tal:replace="structure python:view.tab_status_form_change_settings.expiration_datetime.render(model.get_next_version_expiration_datetime())" />
  </td>
  <td>
    If this content should expire, set the time.&nbsp;
  </td>
</tr>

<td align="right">
<tr class="focus" valign="top">
<td align="right">
&nbsp;
</td>
<td align="right">
<!-- label for="expires_flag" title="Access key: alt-x" accesskey="x">Turn on e<u>x</u>piration time?&nbsp;</label>
<field tal:replace="structure python:view.tab_status_form_change_settings.expires_flag.render(model.get_next_version_expiration_datetime() is not None)" / -->
</td>
</tr>

<tr class="focus-cycle" valign="top">
<td align="left">&nbsp;
</td>
<td align="right">
<label for="publish_now_flag" title="Access key: alt-u" accesskey="u">P<u>u</u>blish right now?&nbsp;</label><field
    tal:replace="structure python:view.tab_status_form_change_settings.publish_now_flag.render()" />
</td>
</tr>

<tr class="controls">
<td colspan="3" align="right">
<input type="submit" value=" Change timings " class="button"  title="Access key: alt-c" accesskey="c" />
</td>
</tr>
</table>
</form>
<br />
<br />

</div>
<span tal:replace="nothing"> _______ / Editor can change settings _______ </span>

<span tal:replace="nothing"> _______ Revoke approval _______ </span>
<div metal:define-macro="revoke_approval" tal:omit-tag="">
<form action="tab_status_revoke" method="POST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr>
<th align="left" colspan="2">
Revoke approval
</th>
</tr>
<tr class="focus">
<td colspan="2">
If further editing is required, first revoke the approval.
</td></tr>
<tr class="controls">
<td>
&nbsp;
</td>
<td align="right" width="40%">
<input type="submit" value=" Revoke approval " class="button" title="Access key: alt-r" accesskey="r" />
</td>
</tr>
</table>
</form>
<br />
<br />
</div>
<span tal:replace="nothing"> _______ / Revoke approval _______ </span>

<span tal:replace="nothing"> _______ Revert to previous _______ </span>
<div metal:define-macro="revert_to_previous" tal:omit-tag="">
<form action="tab_status_revert_to_previous" method="POST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr class="controls">
<th align="left">
Revert to previous version
</th>
</tr>
<tr class="focus">
<td>
The current editable version can be replaced with the current or previous published version (to return to the original state). This can not be undone afterwards and will discard all changes made to the current version.
</td>
</tr>
<tr class="controls">
<td align="right">
<input class="button" type="submit" value=" Revert to previous " title="Access key: alt-c" accesskey="c" />
</td>
</tr>
</table>
</form>
</div>
<span tal:replace="nothing"> _______ / Revert to previous _______ </span>

<span tal:replace="nothing"> _______ Manual close _______ </span>
<div metal:define-macro="manual_close" tal:omit-tag="">
<form action="tab_status_close" method="POST">
<table width="96%" cellspacing="0" cellpadding="3" border="0"
  tal:attributes="width container/table_width; cellspacing container/table_cellspacing;
                  cellpadding container/table_cellpadding; border container/table_border">
<tr class="controls">
<th align="left">
Manual close 
</th>
</tr>
<tr class="focus">
<td>
If necessary, the published version of this content can be manually closed (taken offline). It will also be removed from the public index.
</td>
</tr>
<tr class="controls">
<td align="right">
<input class="button" type="submit" value=" Close published version " title="Access key: alt-c" accesskey="c" />
</td>
</tr>
</table>
</form>
</div>
<span tal:replace="nothing"> _______ / Manual close _______ </span>

</html>
