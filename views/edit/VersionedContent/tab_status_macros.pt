<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  >

<span tal:replace="nothing"> _______ messages _______ </span>
<div tal:omit-tag=""
  tal:condition="python:model.get_approval_request_message()"
  metal:define-macro="messages">
<tr class="top-controls">
<td colspan="2">
<h3>
Messages
</h3>
</td>
</tr>

<tr class="even">
<td class="feedback"
  colspan="2">
<span tal:replace="python:model.get_approval_requester()">author id</span>
has requested approval on 
<span tal:replace="structure python:here.service_utils.backend_datetime_to_str(model.get_approval_request_datetime())">some date</span>
<tal:if condition="python:model.get_approval_request_message()">
with the following comments:
</tal:if>
</td>
</tr>

<tr class="controls"
  tal:condition="python:model.get_approval_request_message()">
<td class="message"
  colspan="2">
<div class="message"
  tal:content="python:model.get_approval_request_message() or 'whatever'">
message text
</div>
</td>
</tr>
</div>


<span tal:replace="nothing"> _______ Author requests approval _______ </span>
<div metal:define-macro="request_approval" tal:omit-tag="">
<form action="tab_status_request" method="POST">
<tr tal:condition="python:model.get_approval_request_message()">
<td class="feedback"
 colspan="2">
A previous request for approval has been rejected / withdrawn by 
<span tal:replace="python:model.get_approval_requester()" /> on 
<span tal:replace="structure python:here.service_utils.backend_datetime_to_str(model.get_approval_request_datetime())">some date</span>.
<comment tal:condition="nothing"> actually the last message may not been written
   by the person withdrawing the request; if this person did an e.g. an empty reject,
   this is the message of the requester ...
</comment>
The last message regarding this issue is:
</td>
</tr>

<tr class="even"
  tal:define="message python:model.get_approval_request_message()"
  tal:condition="message">
<td class="message"
  colspan="2">
<div class="message"
  tal:content="message">
message text
</div>
</td>
</tr>

<tr class="top-controls">
<td colspan="2">
<h3>Request approval<span tal:condition="python:may_change_content and unapproved and published"> for new version</span></h3>
</td>
</tr>

<tr>
<th>
Message to editor
</th>
<th style="width:40%">
Notes
</th>
</tr>

<tr class="odd">
<td class="align-right">
<span class="textarea">
<field tal:replace="structure python:view.tab_status_form_author.message.render(REQUEST=request)" />
</span>
</td>
<td>
This message will remain visible in the status screen for other authors and editors.
</td>
</tr>

<tr class="even">
<td class="align-right"
 style="vertical-align:bottom;">
<label title="access key: alt-m" accesskey="m">content publish ti<u>m</u>e:</label>
<field tal:replace="structure python:view.tab_status_form_author.publish_datetime.render(value=model.get_unapproved_version_publication_datetime(), REQUEST=request)" />
</td>
<td style="vertical-align:middle;">
day/month/year 23:59
</td>
</tr>

<tr class="odd">
  <td class="align-right">
    <label title="access key: alt-i (some platforms)" accesskey="i">expiratio<u>n</u> time:</label>&nbsp;
    <field tal:replace="structure python:view.tab_status_form_change_settings.expiration_datetime.render(model.get_next_version_expiration_datetime())" />
  </td>
  <td style="vertical-align:middle;">
    If this content should expire, set the time.&nbsp;
  </td>
</tr>

<tr class="odd"       tal:replace="nothing">
<td class="align-right">
&nbsp;
</td>
<td class="align-right">
<!-- label for="expires_flag" title="access key: alt-x" accesskey="x">Turn on e<u>x</u>piration time?&nbsp;</label><field
    tal:replace="structure python:view.tab_status_form_author.expires_flag.render(REQUEST=request)" / -->
</td>
</tr>

<tr class="controls">
<td colspan="2" class="align-right">
<input type="submit" value=" Request approval " class="button" title="access key: alt-r" accesskey="r" />
</td>
</tr>
</form>
</div>
<span tal:replace="nothing"> _______ / Author requests approval _______ </span>


<span tal:replace="nothing"> _______ Editor can change settings _______ </span>
<div metal:define-macro="approved_editor" tal:omit-tag="">
<form action="tab_status_change_settings" method="POST">
<tr class="top-controls">
<td colspan="2">
<h3>
Change settings
</h3>
</td>
</tr>

<tr>
<th class="align-right">
Current timings
</th>
<th>
Notes
</th>
</tr>

<tr class="odd">
<td class="align-right">
<label title="access key: alt-m (some platforms)" accesskey="m">publish ti<u>m</u>e:</label>&nbsp;
<field tal:replace="structure python:view.tab_status_form_change_settings.publish_datetime.render(model.get_next_version_publication_datetime())" />
</td>
<td>
&nbsp;
</td>
</tr>

<tr class="even">
<td class="align-right">
<label title="access key: alt-i (some platforms)" accesskey="i">expiratio<u>n</u> time:</label>&nbsp;
<field tal:replace="structure python:view.tab_status_form_change_settings.expiration_datetime.render(model.get_next_version_expiration_datetime())" />
</td>
<td style="vertical-align:middle;">
If this content should expire, set the time.&nbsp;
</td>
</tr>

<tr>
<th class="align-right"
  colspan="2">
<span class="widebody"><label for="publish_now_flag" title="access key: alt-u" accesskey="u">P<u>u</u>blish right now?</label></span>
<field tal:replace="structure python:view.tab_status_form_change_settings.publish_now_flag.render()" />
</th>
</tr>

<tr class="inter-controls">
<td class="align-right"
  colspan="2">
<input type="submit" value=" Change timings " class="button"  title="access key: alt-c" accesskey="c" />
</td>
</tr>
</form>
</div>
<span tal:replace="nothing"> _______ / Editor can change settings _______ </span>



<span tal:replace="nothing"> ______________ sub tables ______________ </span>


<span tal:replace="nothing"> _______ Editor approves _______ </span>
<div tal:omit-tag=""
  metal:define-macro="approve_new">
<form action="tab_status_approve" method="POST">
<table class="listing sublisting">
<tr class="top-controls">
<td colspan="2">
<h3>Approve request for approval<span tal:condition="python:may_change_content and unapproved and published"> of new version</span></h3>
</td>
</tr>

<tr>
<th class="align-right">
Settings
</th>
<th style="width:40%">
Notes
</th>
</tr>

<tr class="even">
<td class="align-right">
<label title="access key: alt-m"
  accesskey="m">content publish ti<u>m</u>e:</label>&nbsp;
<field tal:replace="structure python:view.tab_status_form_editor.publish_datetime.render(REQUEST=request)" />
</td>
<td>
&nbsp;
</td>
</tr>

<tr class="odd">
<td class="align-right">
<label title="access key: alt-i" accesskey="i">expiratio<u>n</u> time:</label>&nbsp;
<field tal:replace="structure python:view.tab_status_form_editor.expiration_datetime.render(REQUEST=request)" />
</td>
<td style="vertical-align:middle;">
Empty indicates no expiration.
</td>
</tr>

<span tal:replace="nothing"> ******* XXX Fixme: set expiration if filled in (and delete this :) ******* </span>
<tr class="even" tal:replace="nothing">
<td class="align-right">
&nbsp;
</td>
<td class="align-right">
<label for="expires_flag" title="access key: alt-x" accesskey="x">Turn on e<u>x</u>piration time?&nbsp;</label><field
    tal:replace="structure python:view.tab_status_form_editor.expires_flag.render(REQUEST=request)" />
</td>
</tr>

<tr>
<th class="align-right"
  colspan="2">
<span class="widebody"><label for="publish_now_flag" title="access key: alt-u" accesskey="u">P<u>u</u>blish right now?</label></span>
<field tal:replace="structure python:view.tab_status_form_editor.publish_now_flag.render(REQUEST=request)" />
</th>
</tr>

<tr class="inter-controls">
<td class="align-right"
  colspan="2">
<input class="button"
  type="submit"
  value="Approve content"
  title="access key: alt-a"
  accesskey="a"
/>
</td> 
</tr>
</table>
</form>
</div>
<span tal:replace="nothing"> _______ / Editor approves _______ </span>


<span tal:replace="nothing"> _______ Author/Editor withdraws/rejects request for  approval _______ </span>
<div tal:omit-tag=""
  metal:define-macro="withdraw_request_approval">
<form action="tab_status_withdraw" method="POST">
<table class="listing">
<tr class="top-controls">
<td colspan="2">
<h3>
<span tal:omit-tag=""
  tal:replace="python: test(may_approve_content, 'Reject', 'Withdraw')">action</span>
request
</h3>
</td>
</tr>

<tr>
<input type="hidden" name="rejection_status" tal:attributes="value python:test(may_approve_content, 'true', 'false')" />
<input type="hidden" name="tab_name" value="publish" />
<th>
Add message on 
<span tal:replace="python:test(may_approve_content,'rejection',default)">withdrawal</span>
</th>
<th style="width:40%">
Notes
</th>
</tr>

<tr class="odd">
<td>
<span class="textarea">
<textarea
  style="width:100%"
  name="message"
  cols="65"
  rows="7"
  wrap="soft"></textarea>
</span>
</td>
<td width="40%">
The message may be viewed by interested authors.
</td>
</tr>

<tr class="controls">
<td>
&nbsp;
</td>
<td class="align-right"
  width="40%">
<input type="submit" value=" Withdraw approval " class="button"  title="access key: alt-r" accesskey="r"
  tal:attributes="value python:test(may_approve_content,' Reject approval request ',' Withdraw approval request ')" />
</td>
</tr>
</table>
</form>
</div>
<span tal:replace="nothing"> _______ / Author/Editor withdraws/rejects request for  approval _______ </span>


<span tal:replace="nothing"> _______ Revoke approval _______ </span>
<div tal:omit-tag=""
  metal:define-macro="revoke_approval">
<form action="tab_status_revoke" method="POST">
<table class="listing sublisting">
<thead>
<tr class="top-controls">
<td>
<h3>
Revoke approval
</h3>
</td>
</tr>
</thead>

<tbody>
<tr class="even">
<td>
If further editing is required, first revoke the approval.
</td>
</tr>
</tbody>

<tfoot>
<tr class="controls">
<td class="align-right">
<input type="submit" value=" Revoke approval " class="button" title="access key: alt-r" accesskey="r" />
</td>
</tr>
</tfoot>
</table>
</form>
</div>
<span tal:replace="nothing"> _______ / Revoke approval _______ </span>


<span tal:replace="nothing"> _______ Revert to previous _______ </span>
<div tal:omit-tag=""
  metal:define-macro="revert_to_previous">
<form action="tab_status_revert_to_previous" method="POST">
<table class="listing">
<tr class="top-controls">
<td>
<h3>
  Revert to previous version
</h3>
</td>
</tr>
<tr class="even">
<td>
The current editable version can be replaced with the previous (published) version. This can not be undone afterwards and will discard all changes made to the current version.
</td>
</tr>
<tr class="inter-controls">
<td class="align-right">
<input class="button"
  type="submit"
  value="Revert to previous"
  title="access key: alt-r"
  accesskey="r"
/>
</td>
</tr>
</table>
</form>
</div>
<span tal:replace="nothing"> _______ / Revert to previous _______ </span>


<span tal:replace="nothing"> _______ Manual close _______ </span>
<div tal:omit-tag=""
  metal:define-macro="manual_close">
<form action="tab_status_close" method="POST">
<table class="listing">
<thead>
<tr class="top-controls">
<td>
<h3>Manual close</h3> 
</td>
</tr>
</thead>

<tbody>
<tr class="even">
<td>
If necessary, the published version of this content can be manually closed (taken offline). It will also be removed from the public index.
</td>
</tr>
</tbody>

<tfoot>
<tr class="controls">
<td class="align-right">
<input class="button" type="submit" value=" Close published version " title="access key: alt-c" accesskey="c" />
</td>
</tr>
</tfoot>
</table>
</form>
</div>
<span tal:replace="nothing"> _______ / Manual close _______ </span>


</html>
