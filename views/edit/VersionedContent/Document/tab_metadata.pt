<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  tal:define="
    global breadcrumb_vein string:Metadata;
  ">
<metal:block use-macro="here/macro_index/macros/master">
<metal:block fill-slot="main">

<tal:define define="global fields python:view.tab_metadata_form.get_fields()" />

<table class="columns columns2">
  <tbody>
    <tr>
      <td class="left">
        <span tal:replace="nothing">
          _____________________ sidebar subtable _____________________
        </span>
          <span tal:replace="structure python: view.service_sidebar.render(model, 'tab_metadata', breadcrumb_vein)" />
      </td>
      <td class="main">
        <tal:block replace="nothing">
          _____________________ main subtable _____________________
        </tal:block>

<form method="POST" name="form" action="tab_metadata_submit">
<table class="listing">
<thead>
  <tr>
    <td class="top location" colspan="3">
    <h2>
      <img tal:replace="structure python:view.render_icon(model)" />
      metadata for <span tal:content="structure string:&#xab;${model/get_title_or_id_html}&#xbb;">title</span>
    </h2>
    </td>
  </tr>
</thead>

<tbody>
  <tr>
    <th class="align-right"
      width="12%">
      Element
    </th>
    <th>
      Content
    </th>
    <th width="30%">
      Note
    </th>
  </tr>

  <tal:repeat repeat="field fields">
  <tal:define define="oddrow repeat/field/odd">
  <tr
    tal:attributes="class python:oddrow and 'odd' or 'even'">
    <td class="align-right">
      <span tal:replace="structure python: field.title().lower()">Title</span><span class="warning" tal:condition="python:field.is_required()">*</span>
    </td>
    <td>
      <input tal:replace="structure python:field.render(value=test(field.id == 'document_title', model.get_title_editable(), model.getProperty(field.id)) )" />
    </td>
    <td>
      <span tal:replace="python:field.get_value('description')">
      comments here (field description)
      </span>
      <span tal:condition="python:field.id == 'contact_name' or field.id == 'contact_email'" tal:omit-tag="">(<i tal:content="python:getattr(model, field.id, 'None')"></i>)</span>
    </td>
  </tr>
  </tal:define>
  </tal:repeat>
</tbody>

<tfoot>
  <tr class="controls">
    <td class="align-right"
      colspan="3">
      <input class="button" 
        type="submit"
        name="form_submitted"
        value="Save metadata"
        title="access key: alt-s"
        accesskey="s"
      />
    </td>
  </tr>
</tfoot>
</table>

<span tal:replace="nothing"> ______________ metadata from system ______________ </span>

<table class="listing">
  <thead>
    <tr tal:replace="nothing">
      ______________ top controls row ______________
    </tr>
    <tr class="top-controls">
      <td colspan="3">
        <h3>
          automatically stored metadata
        </h3>
      </td>
    </tr>
  </thead>

  <tbody>
    <tr>
      <th class="align-right">
        Element
      </th>
      <th>
        Content
      </th>
      <th>
        Note
      </th>
    </tr>

    <tr class="unselected">
      <td class="align-right">
        creation date
      </td>
      <td tal:content="python:view.service_utils.backend_datetime_to_str(model.get_creation_datetime())">
        creation datetime
      </td>
      <td>
        &nbsp;
      </td>
    </tr>

    <tr class="unselected">
      <td class="align-right">
        modification date
      </td>
      <td tal:content="python:view.service_utils.backend_datetime_to_str(model.get_modification_datetime())">
        11 oct 2001
      </td>
      <td>
        &nbsp;
      </td>
    </tr>

    <tr class="unselected">
      <td class="align-right">
        last author
      </td>
      <td tal:define="author_info model/sec_get_last_author_info"
        tal:condition="author_info">
        <a tal:attributes="href author_info/email"><span tal:replace="author_info/fullname" /></a>
      </td>
      <td tal:condition="not:model/sec_get_last_author_info">&nbsp;</td>
      <td>
        &nbsp;
      </td>
    </tr>

    <tr class="unselected">
      <td class="align-right">
        editors
      </td>
      <td>
      <!-- XXX Fixme: need get_nearest_editors() method -->
        <span tal:replace="python:', '.join([e.fullname() for e in here.get_nearest_chiefeditors()])" />
      </td>
      <td>
        &nbsp;
      </td>
    </tr>

    <tr class="unselected">
      <td class="align-right">
        chief editors
      </td>
      <td>
        <span tal:replace="python:', '.join([ch.fullname() for ch in here.get_nearest_chiefeditors()])" />
      </td>
      <td>
        &nbsp;
      </td>
    </tr>

    <tr class="unselected">
      <td class="align-right">
        managers
      </td>
      <td>
        <span tal:replace="python:', '.join([m.fullname() for m in here.get_nearest_managers()])" /> <br />
      </td>
      <td>
        Only in emergencies.
      </td>
    </tr>

    <tr class="unselected">
      <td class="align-right">
        location
      </td>
      <td>
        <a tal:attributes="href model/absolute_url" tal:content="model/absolute_url"></a>
      </td>
      <td>
        &nbsp;
      </td>
    </tr>

    <tr tal:replace="nothing"> _______ XXX fixme: show Publisher after metadata refactoring _______ </tr>
    <tr class="unselected" tal:replace="nothing">
      <td class="align-right">
        publisher
      </td>
      <td>
        Publisher name
      </td>
      <td>
        &nbsp;
      </td>
    </tr>
  </tbody>

  <tfoot>
    <tr class="controls">
      <td colspan="3">
      </td>
    </tr>
  </tfoot>
</table>

      </td>
    </tr>
  </tbody>
</table>

</metal:block>
</metal:block>
</html>
