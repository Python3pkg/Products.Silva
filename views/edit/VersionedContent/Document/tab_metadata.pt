<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  tal:define="
    global breadcrumb_vein string:Metadata;
  ">
<metal:block use-macro="here/macro_index/macros/master">
<metal:block fill-slot="main">

<tal:block tal:omit-tag=""
  tal:define="global fields python:view.tab_metadata_form.get_fields()" />

<form class="focus-box" method="POST" name="form" action="tab_metadata_submit">
<table class="listing">
<thead>
  <tr>
    <td class="top location" colspan="3">
    <h2>
      <img tal:replace="structure python:view.render_icon(model)" />
      Metadata for <span class="document-title" tal:content="structure string:&amp;#xab;${model/get_title_or_id_html}&amp;#xbb;">title here</span>
    </h2>
    </td>
  </tr>
</thead>

<tbody>
  <tr>
    <th class="right"
      width="12%">
      Element
    </th>
    <th>
      Content
    </th>
    <th width="30%">
      Note
    </th>
  </tr>

  <tal:repeat repeat="field fields">
  <tal:define define="oddrow repeat/field/odd">
  <tr valign="top"
    tal:attributes="class python:oddrow and 'odd' or 'even'">
    <td class="right">
      <span tal:replace="structure python: field.title().lower()">Title</span><span class="warning" tal:condition="python:field.is_required()">*</span>
    </td>
    <td>
      <input tal:replace="structure python:field.render(value=test(field.id == 'document_title', model.get_title_editable(), model.getProperty(field.id)) )" />
    </td>
    <td>
      <span tal:replace="python:field.get_value('description')">
      comments here (field description)
      </span>
      <span tal:condition="python:field.id == 'contact_name' or field.id == 'contact_email'" tal:omit-tag="">(<i tal:content="python:getattr(model, field.id, 'None')"></i>)</span>
    </td>
  </tr>
  </tal:define>
  </tal:repeat>
</tbody>

<tfoot>
  <tr class="controls">
    <td class="right"
      colspan="3">
      <input class="button" 
        type="submit"
        name="form_submitted"
        value="Save metadata"
        title="Access key: alt-s"
        accesskey="s"
      />
    </td>
  </tr>
</tfoot>
</table>

<br />

<span tal:replace="nothing"> ______________ metadata from system ______________ </span>
<h3>
  Automatically stored metadata
</h3>

<table>
<tr valign="top">
  <td align="right">
    Creation date:
  </td>
  <td tal:content="python:view.service_utils.backend_datetime_to_str(model.get_creation_datetime())">
    Creation datetime
  </td>
  <td>
    &nbsp;
  </td>
</tr>

<tr valign="top">
  <td align="right">
    Modification date:
  </td>
  <td tal:content="python:view.service_utils.backend_datetime_to_str(model.get_modification_datetime())">
    11 oct 2001
  </td>
  <td>
    &nbsp;
  </td>
</tr>

<tr valign="top">
  <td align="right">
    Last author:
  </td>
  <td tal:define="author_info model/sec_get_last_author_info"
    tal:condition="author_info">
    <a tal:attributes="href author_info/email"><span tal:replace="author_info/fullname" /></a>
  </td>
  <td tal:condition="not:model/sec_get_last_author_info">&nbsp;</td>
</tr>

<tr valign="top">
  <td align="right">
    Chief Editor(s):
  </td>
  <td>
    <span tal:replace="python:', '.join([ch.fullname() for ch in here.get_nearest_chiefeditors()])" />
  </td>
  <td>
    &nbsp;
  </td>
</tr>

<tr valign="top">
  <td align="right">
    Manager(s):
  </td>
  <td>
    <span tal:replace="python:', '.join([m.fullname() for m in here.get_nearest_managers()])" /> <br />
  </td>
  <td>
    Only in emergencies.
  </td>
</tr>

<tr valign="top">
  <td align="right">
    Location:
  </td>
  <td colspan="2">
    <a tal:attributes="href model/absolute_url" tal:content="model/absolute_url"></a>
  </td>
</tr>

<tr tal:replace="nothing"> _______ XXX fixme: show Publisher after metadata refactoring _______ </tr>
<tr valign="top" tal:replace="nothing">
  <td align="right">
    Publisher:
  </td>
  <td>
    Publisher name
  </td>
  <td>
    &nbsp;
  </td>
</tr>
</table>
</form>

</metal:block>
</metal:block>
</html>
