<!-- ___________________________ start index_html ___________________________ -->
<tal:block define="global breadcrumb_vein string:Status;
                   global view here;
                   global docma_running python: hasattr(view, 'service_docma') and view.service_docma.try_connection_and_pw();
                   global lastclass string:focus-cycle;
                   global silva_permissions view/get_silva_permissions;
                   " />
<html metal:use-macro="here/macro_index/macros/master">

<div class="margins" metal:fill-slot="main">
<!-- ___________________________ start index_html/slot main ___________________________ -->

<h2><img src="%s" width="16" height="16" alt="%s"
      tal:replace="structure python:view.render_icon(model.meta_type)" />&nbsp;
  Status of <span class="document-title" tal:content="structure string:&#xab;${model/get_title_or_id_html}&#xbb;">title here</span>
</h2>

<tal:block define="
  global unapproved   python:model.get_unapproved_version() is not None;
  global request_pending python:unapproved and model.is_version_approval_requested();
  global approved     python:model.get_approved_version() is not None;
  global published    python:model.get_public_version() is not None;
  global closed       python:model.get_public_version_status() == 'closed';
  global next         python:model.get_next_version() is not None;
  " />

<span tal:replace="nothing"> _______ status: content is approved, not published _______ </span>
<p tal:condition="python:silva_permissions['ChangeSilvaContent'] and approved">
<span class="subhead">Content is approved, not published</span><br />
<span tal:condition="not:silva_permissions/ApproveSilvaContent"
  tal:omit-tag="">Publication settings can be changed.<br /></span>
</p>

<span tal:replace="nothing"> _______ status: content is published _______ </span>
<p tal:condition="python:silva_permissions['ChangeSilvaContent'] and not next and published">
<span class="subhead">Content is published</span><br />
This content is published (online for the public).<br />
If you wish you can make an editable copy by going to the <a href="tab_edit"><span class="index-link">Edit tab</span></a>.
<br />
</p>

<span tal:replace="nothing"> _______ status: warning of new version of published content _______ </span>
<p tal:condition="python:silva_permissions['ChangeSilvaContent'] and unapproved and published">
<span class="subhead">Published version exists</span><br />
Note: <span class="warning">an older version of this content is online.</span><br />
Publishing this version will replace the public version.
<br />
</p>

<span tal:replace="nothing"> _______ status: content is closed _______ </span>
<p tal:condition="python:silva_permissions['ChangeSilvaContent'] and not next and closed">
<span class="subhead">Content is closed</span><br />
This content was once published but is now closed.<br />
If you wish you can make an editable copy by going to the <a href="tab_edit"><span class="index-link">Edit tab</span></a>.
<br />
</p>


<span tal:replace="nothing"> _______ Author requests approval _______ </span>
<check tal:condition="python:not silva_permissions['ApproveSilvaContent'] and unapproved and not request_pending"
  tal:omit-tag="">
<div metal:use-macro="view/tab_status_macros/macros/request_approval">
request approval section here
</div>
</check>


<span tal:replace="nothing"> _______ Editor considers approval _______ </span>
<check tal:condition="python:silva_permissions['ApproveSilvaContent'] and unapproved"
  tal:omit-tag="">
<div metal:use-macro="view/tab_status_macros/macros/approve_new">
approval section here
</div>
</check>

<span tal:replace="nothing"> _______ Author/Editor withdraws/rejecs request forapproval _______ </span>
<check tal:condition="python:silva_permissions['ChangeSilvaContent'] and unapproved and request_pending"
  tal:omit-tag="">
<div metal:use-macro="view/tab_status_macros/macros/withdraw_request_approval">
request approval section here
</div>
</check>


<span tal:replace="nothing"> _______ approved, Editor can change settings _______ </span>
<check tal:condition="python:silva_permissions['ApproveSilvaContent'] and approved"
  tal:omit-tag="">
<div metal:use-macro="view/tab_status_macros/macros/approved_editor">
change settings section here
</div>
</check>


<span tal:replace="nothing"> _______ revoke approval _______ </span>
<check tal:condition="python:silva_permissions['ChangeSilvaContent'] and approved"
  tal:omit-tag="">
<div metal:use-macro="view/tab_status_macros/macros/revoke_approval">
revoke approval section here
</div>
</check>


<span tal:replace="nothing"> _______ manual close _______ </span>
<check tal:condition="python:silva_permissions['ApproveSilvaContent'] and published"
  tal:omit-tag="">
<div metal:use-macro="view/tab_status_macros/macros/manual_close">
_______ manual close section here _______
</div>
</check>

<br />

<form action="." method="POST">
  <table width="96%" cellspacing="0" cellpadding="3" border="0">
    <tr>
      <td colspan="3">
        <h3>Export document</h3>
      </td>
    </tr>

    <tr>
      <th align="left">
        Notes
      </th>
    </tr>

    <tr class="focus-cycle" valign="top">
      <td>
         Export this document via the export screen as Silva XML, 
         or - if the <a href="http://www.infrae.com/products/docma">DocmaServer</a>
         is installed - convert it to a Word document.
      </td>
    </tr>

    <tr class="controls">
      <td align="right">
        <input class="button" type="submit" name="download_xml:method" value=" Export..." title="Access key: alt-e" accesskey="e" />
      </td>
    </tr>
  </table>

</form>

<br /><br />


<form action="." method="POST"  tal:replace="nothing">


  <table width="96%" cellspacing="0" cellpadding="3" border="0">

    <tr>
      <td colspan="3">
        <h3>Export to Silva XML (.slv)</h3>
      </td>
    </tr>

    <tr>
      <th align="right">
        Options
      </th>
      <th align="left">
        &nbsp;
      </th>
      <th align="right" colspan="2">
        Notes
      </th>
    </tr>

    <tr class="focus-cycle" valign="top" tal:condition="python: next">
      <td align="right">
        Export newest version?
      </td>
      <td>
        <input type="checkbox" name="export_last_version" />
      </td>
      <td align="right">
         If not checked the published version is exported
      </td>
    </tr>

    <tr class="focus-cycle" valign="top" tal:condition="python: not next">
      <td colspan="3" align="left">
        There is no next version, so published version will be exported
      </td>
    </tr>

    <tr class="controls">
      <td>
          <input class="cancelbutton" type="button" name="edit_cancel" value=" Cancel " onClick="history.back()" title="Access key: alt-c" accesskey="c" />
      </td>
      <td colspan="2" align="right">
          <input class="button" type="submit" name="download_xml:method" value=" Export " title="Access key: alt-e" accesskey="e" />
      </td>
    </tr>
  </table>

</form>

<div tal:replace="nothing"
  tal:condition="docma_running">

<init tal:define="global userid view/REQUEST/AUTHENTICATED_USER;
                  global queue view/service_docma/get_queue;
                  global finished_jobs python: view.service_docma.get_finished_jobs_for_userid(str(userid));
                  global processingident view/service_docma/get_processing_ident;" />

<form action="." method="POST">
  <table width="96%" cellspacing="0" cellpadding="3" border="0">

    <tr>
      <td colspan="3">
        <h3><img tal:attributes="src string:${silva_root}/globals/docma.gif" width="16" height="16" border="0" alt="Docma icon" />&nbsp;
          Export to Docma (.doc)</h3>
      </td>
    </tr>

    <tr>
      <th align="right">
        Options
      </th>
      <th align="right" colspan="2">
        Notes
      </th>
    </tr>

    <tr class="focus-cycle" valign="top">
      <td align="right">
        Export newest version?
      </td>
      <td>
        <input type="checkbox" name="export_last_version" />
      </td>
      <td align="right">
         If not checked the published version is exported
      </td>
    </tr>

    <tr class="focus">
      <td align="right" width="20%">Enter your e-mail address: <span class="warning">*</span></td>
      <td align="left" width="1%"><input type="text" name="email" size="30" /></td>
      <td align="right">An e-mail will be sent once the job is finished</td>
    </tr>

    <tr class="focus-cycle">
      <td align="right" width="20%">Choose a front page template:</td>
      <td align="left" width="1%">
        <select name="template">
          <option value="">none</option>
          <tal:block repeat="template view/service_docma/get_templates">
              <option tal:attributes="value template" tal:content="template"></option>
          </tal:block>
        </select>
      </td>
      <td align="right">&nbsp;</td>
    </tr>

    <tr class="focus">
      <td align="right" width="20%">Enter a description of the job:</td>
      <td align="left" width="1%"><textarea rows="3" cols="30" name="description"></textarea></td>
      <td align="right">&nbsp;</td>
    </tr>

    <tr class="controls">
      <td colspan="3" align="right">
      <tal:block condition="silva_permissions/ChangeSilvaContent">
          &nbsp;&nbsp;<input class="button" type="submit" name="tab_status_silva2word:method" value="Export to Docma" title="Export the current container to Word: alt-d" accesskey="d" />
      </tal:block>
      </td>
    </tr>

  </table>

</form>

<tal:block tal:condition="python: processingident != 0">
  <table width="100%" cellspacing="0" cellpadding="0" class="feedback">
    <tr>
      <td>Current job: <span tal:replace="processingident" /></td>
    </tr>
    <tr>
      <td>Owner: <span tal:replace="python: view.service_docma.get_ident_owner(processingident)" /></td>
    </tr>
    <tr>
      <td>Description: <span tal:replace="python: view.service_docma.get_ident_description(processingident)" /></td>
    </tr>
  </table>
</tal:block>

<br />

<form action="." enctype="multipart/form-data" method="POST">

  <table width="100%" cellpadding="3" cellspacing="0">

  <tal:block condition="nothing"> ________ Docma Queue ________ </tal:block>

    <tr>
      <td colspan="5">
        <h3>Queue of items to process</h3>
      </td>
    </tr>

    <tr>
      <th align="left" width="8%">Job&nbsp;id</th>
      <th align="left" width="15%">Job&nbsp;owner</th>
      <th align="left">Description</th>
      <th align="left" width="15%">Status</th>
      <th align="left" width="10%">Estimated&nbsp;time</th>
    </tr>

    <tr tal:repeat="job queue" tal:define="class python:test(lastclass == 'focus', 'focus-cycle', 'focus'); lastclass class" tal:attributes="class class">
      <td align="left" tal:content="job">JobId</td>
      <td align="left" tal:content="python: view.service_docma.get_ident_owner(job)">Owner</td>
      <td align="left" tal:content="python: view.service_docma.get_ident_description(job)">Description</td>
      <td align="left" tal:content="python: view.service_docma.get_status(job)">Status</td>
      <td align="left" tal:content="python: '%s seconds' % view.service_docma.get_estimated_time_for_ident(job)">Estimated time</td>
    </tr>

    <tr class="focus" tal:condition="python: len(queue) == 0">
      <td align="left" colspan="5">There are no jobs in the queue</td>
    </tr>

    <tr>
      <td class="divider" colspan="5"><img tal:attributes="src string:${silva_root}/globals/pixel.gif" width="1" height="3" /></td>
    </tr>

  </table>

</form>

</div>

<!-- ___________________________ end index_html/slot main ___________________________ -->
</div>


</html>
