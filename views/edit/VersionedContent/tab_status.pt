<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  tal:define="
    global vein string:status;
    " 
  i18n:domain="silva">
<metal:block use-macro="here/macro_index/macros/master">
<metal:block fill-slot="main"
  tal:define="
    view here;
    unapproved python:model.get_unapproved_version() is not None;
    request_pending python:unapproved and model.is_version_approval_requested();
    approved python:model.get_approved_version() is not None;
    published python:model.get_public_version() is not None;
    closed python:model.get_public_version_status() == 'closed';
    next python:model.get_next_version() is not None;
    mangle modules/Products/Silva/mangle;
">

<table class="columns columns3">
  <tbody>
    <tr>
      <td class="left">
        <tal:block replace="nothing">
          _____________________ sidebar subtable _____________________
        </tal:block>
        <metal:block use-macro="view/macro_vein_navigation/macros/vein" />
      </td>
      <td class="main">
        <tal:block replace="nothing">
          _____________________ main subtable _____________________
        </tal:block>

<table class="listing">
<thead>
  <tr tal:replace="nothing"> ______________ vein + title row ______________ </tr>
  <tr>
    <td class="top" colspan="3">
    <h2 i18n:translate="access_status">
      <img tal:replace="structure python:view.render_icon(model)" />
      status of &#xab;<tal:block content="title" i18n:name="title"/>&#xbb;
    </h2>
    </td>
  </tr>

  <span tal:replace="nothing"> ______________ feedback from system ______________ </span>

  <span tal:replace="nothing"> _______ status: content is approved, not published _______ </span>
  <tr tal:condition="python:may_change_content and approved">
    <td class="feedback" colspan="3">
      <span class="subhead" style="color:ForestGreen;">Content is approved, not published</span><br />
      <span tal:condition="may_approve_content"
        tal:omit-tag="">Publication settings can be changed.</span>
        <metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
    </td>
  </tr>

  <span tal:replace="nothing"> _______ status: content is published _______ </span>
  <tr tal:condition="python:may_change_content and not next and published">
    <td class="feedback" colspan="3">
      <span class="subhead" i18n:translate="published_content">Content is published</span><br />
      <tal:block i18n:translate="published_content_description">
      This content is published (online for the public).<br />
      If you wish you can make an editable copy by going to the <a href="tab_edit">editor</a>.
      </tal:block>
      <metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
    </td>
  </tr>

  <span tal:replace="nothing"> _______ status: warning of new version of published content _______ </span>
  <tr tal:condition="python:may_change_content and unapproved and published">
    <td class="feedback" colspan="3">
      <span class="subhead" i18n:translate="existing_pub_version">Published version exists</span><br />
      <span class="warning" tal:condition="may_approve_content"
        i18n:translate="existing_pub_version_description">Note: an older version of this content is online.<br />
      Publishing this version will replace the public version.</span>
      <metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
    </td>
  </tr>

  <span tal:replace="nothing"> _______ status: content is closed _______ </span>
  <tr tal:condition="python:may_change_content and not next and closed">
    <td class="feedback" colspan="3">
      <span class="subhead" i18n:translate="closed_content">Content is closed</span><br />
      <tal:block i18n:translate="closed_content_description">  
        This content was once published but is now closed.<br /> If you
        wish you can make an editable copy in the <a
          href="tab_edit">editor</a>.
      </tal:block>
     <metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
    </td>
  </tr>
</thead>


<tbody>
<span tal:replace="nothing"> _______ messages _______ </span>
<div metal:use-macro="view/tab_status_macros/macros/messages">
messages
</div>

<span tal:replace="nothing"> _______ Author requests approval _______ </span>
<check tal:condition="python:not may_approve_content and unapproved and not request_pending"
  tal:omit-tag="">
<div metal:use-macro="view/tab_status_macros/macros/request_approval">
request approval section here
</div>
</check>

<span tal:replace="nothing"> _______ approved, Editor can change settings _______ </span>
<check tal:condition="python:may_approve_content and approved"
  tal:omit-tag="">
<div metal:use-macro="view/tab_status_macros/macros/approved_editor">
change settings section here
</div>
</check>
</tbody>
</table>


<span tal:replace="nothing"> ______________ sub tables ______________ </span>

<span tal:replace="nothing"> _______ Editor considers approval _______ </span>
<check tal:condition="python:may_approve_content and (unapproved or closed) and not approved"
  tal:omit-tag="">
<metal:block use-macro="view/tab_status_macros/macros/approve_new">
approval section here
</metal:block>
</check>

<span tal:replace="nothing"> _______ Author/Editor withdraws/rejects request for approval _______ </span>
<check tal:condition="python:may_change_content and unapproved and request_pending"
  tal:omit-tag="">
<div metal:use-macro="view/tab_status_macros/macros/withdraw_request_approval">
request approval section here
</div>
</check>

<span tal:replace="nothing"> _______ revoke approval _______ </span>
<check tal:condition="python:may_change_content and approved"
  tal:omit-tag="">
<div metal:use-macro="view/tab_status_macros/macros/revoke_approval">
revoke approval section here
</div>
</check>


<span tal:replace="nothing"> _______ manual close _______ </span>
<check tal:condition="python:may_approve_content and published"
  tal:omit-tag="">
<div metal:use-macro="view/tab_status_macros/macros/manual_close">
_______ manual close section here _______
</div>
</check>


<span tal:replace="nothing"> _____________________ export focus box _____________________ </span>
 <form action="." enctype="multipart/form-data" method="POST">

<tal:replace replace="nothing">
<span tal:replace="nothing"> _______ status: content is approved, not published _______ </span>
<div class="feedback" tal:condition="python:may_change_content and approved">
<span class="subhead">Content is approved, not published</span><br />
<span tal:condition="not:may_approve_content"
  tal:omit-tag="">Publication settings can be changed.<br /></span>
<metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
</div>

<span tal:replace="nothing"> _______ status: content is published _______ </span>
<div class="feedback" tal:condition="python:may_change_content and not next and published">
  <span class="subhead" 
    i18n:translate="published_content">Content is published
  </span>
  <br />
  <tal:block i18n:translate="published_content_description">
  This content is published (online for the public).<br /> If you wish you
  can make an editable copy by going to the <a href="tab_edit">editor</a>.
  </tal:block>
<metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
</div>

<span tal:replace="nothing"> _______ status: warning of new version of published content _______ </span>
<div class="feedback" tal:condition="python:may_change_content and unapproved and published">
  <span class="subhead" i18n:translate="existing_pub_version">Published version exists</span><br />
  <tal:block i18n:translate="existing_pub_version_description">
    Note: <span class="warning">an older version of this content is
    online.</span><br /> Publishing this version will replace the public
    version.
  </tal:block>
<metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
</div>

<span tal:replace="nothing"> _______ status: content is closed _______ </span>
<div class="feedback" tal:condition="python:may_change_content and not next and closed">
<span class="subhead" i18n:translate="closed_content">Content is closed</span><br />
<tal:block i18n:translate="closed_content_description">
  This content was once published but is now closed.<br /> If you wish you
  can make an editable copy by going to the <a href="tab_edit"><span
      class="index-link">Edit tab</span></a>.
</tal:block>
<metal:block use-macro="here/tab_status_macros/macros/datetime_info" />
</div>
</tal:replace>

      <!-- version management -->
      <tal:block define="versions here/get_sorted_model_versions;
                          version_status_list python: [v.version_status() for v in versions];
                          "
      >
        <input type="hidden" 
                name="refs:list"
                tal:attributes="value python: request['model'].create_ref(request['model'])" />
        <table class="listing" id="sortable" tal:condition="may_change_content">
          <thead>
            <tr>
              <td class="top" colspan="6">
                 <h2 tal:attributes="title string:id: ${model/id}">
                   <img tal:replace="structure python:view.render_icon(model)" />
                   <tal:block i18n:translate="manage_document_versions">
                   manage versions of &#xab;
                   <tal:block content="string:${model/get_title_editable}"
                    i18n:name="export_id">id</tal:block>&#xbb;
                   </tal:block>
                 </h2>
              </td>
            </tr>
            <tr class="top-controls">
              <td colspan="6" class="align-right">
                <h3 style="float:left;" i18n:translate="">
                  publishing actions
                </h3>
                <input class="transport"
                        type="submit"
                        tal:attributes="name python: ('%s/edit/tab_status_export:method' % 
                                          '/'.join(request['model'].get_container().getPhysicalPath()))"
                        value="export..."
                        title="access key: alt-e"
                        accesskey="e"
                        i18n:attributes="value title"
                />
              </td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th>&#xa0;</th>
              <th width="25%">modification time</th>
              <th width="25%">publication time</th>
              <th width="25%">expiration time</th>
              <th>version status</th>
            </tr>
            <tr  tal:repeat="version versions">
              <tal:block define="metadata python: here.get_metadata(version);
                                  creationtime python: mangle.DateTime(
                                      metadata['silva-extra']['creationtime']['value']).toStr();
                                  modificationtime python: mangle.DateTime(
                                      metadata['silva-extra']['modificationtime']['value']).toStr();
                                  publicationtime python: mangle.DateTime(
                                      version.publication_datetime()).toStr();
                                  expirationtime python: mangle.DateTime(
                                      version.expiration_datetime()).toStr();
              ">
                <td style="white-space: nowrap">
                  <input type="checkbox" 
                          name="versions" 
                          tal:attributes="value version/id; id string:version_${version/id}" />
                  <label tal:attributes="for string:version_${version/id}"
                          tal:content="version/id">
                    id
                  </label>
                </td>
                <td style="white-space: nowrap">
                  <a tal:content="modificationtime" 
                      tal:attributes="href python:'%s/edit/tab_view' % version.absolute_url()">
                    modificationtime
                  </a>
                </td>
                <td style="white-space: nowrap" tal:content="publicationtime">
                  publicationtime
                </td>
                <td style="white-space: nowrap" tal:content="expirationtime">
                  expirationtime
                </td>
                <td tal:define="version_status version/version_status;
                                color python: ((version_status == 'unapproved' and 'red') or 
                                                (version_status == 'approved' and 'green') or 
                                                (version_status == 'public' and 'blue') or 
                                                'grey');
                
                    "
                    tal:attributes="style string:color: ${color}"
                    tal:content="version_status"
                >
                  version_status
                </td>
              </tal:block>
            </tr>
          </tbody>
          <tfoot tal:define="approveables python: 'unapproved' in version_status_list;
                              closeables python: 'public' in version_status_list;
                              revokeables python: 'last_closed' in version_status_list;
                              rejectables python: 'unapproved' in version_status_list;
                              expireables closeables;
                              new_versionables python: len(version_status_list);
                              redisplay_timing_form request/redisplay_timing_form | 
                                                    options/redisplay_timing_form | 
                                                    python: 1;
                              "
          >
            <tr tal:condition="versions">
              <th class="listing-left"
                colspan="2">
                <tal:define define="select_id string:versions">
                  <metal:block use-macro="view/macro_select_all/macros/select_all" />
                </tal:define>
              </th>
              <th colspan="3">
                &#xa0;
              </th>
            </tr>
            <tr class="controls">
              <td class="align-right" colspan="5">
                <input class="warning"
                  type="submit"
                  name="tab_status_delete_versions:method"
                  value="delete"
                  title="access key: alt-r"
                  accesskey="r"
                  onclick="if (!confirm('Are you sure?')) return false"
                  i18n:attributes="value title"
                />
                <input class="button"
                  type="submit"
                  name="tab_status_revert_to_old:method"
                  value="copy as editable"
                  title="access key: alt-r"
                  accesskey="r"
                  i18n:attributes="value title"
                />
              </td>
            </tr>
          </tfoot>
        </table>
      </tal:block>

 </form>
      </td>
      <tal:block replace="nothing">
        _____________________ right column _____________________ 
      </tal:block>
      <td class="right">        
        &nbsp;
      </td>
    </tr>
  </tbody>
</table>

</metal:block>
</metal:block>
</html>
