<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  tal:define="global breadcrumb_vein string:Contents;"
  i18n:domain="silva">

<metal:block use-macro="here/macro_no_tabs/macros/master">
<metal:block fill-slot="main"
  tal:define="
    objects python:model.get_tree();
    silva_permissions here/get_silva_permissions;
    filter request/filter | request/SESSION/filter | string:Asset;
    asset_context request/asset_context | request/SESSION/asset_context | string:/;
    dummy python: request.SESSION.set('filter', filter);
    dummy python: request.SESSION.set('asset_context', asset_context);
">

<table class="columns columns2">
  <tbody>
    <tr>
      <tal:block replace="nothing">
        _____________________ sidebar _____________________
      </tal:block>
        <td class="left"
          style="padding:0;"
          tal:define="query_string string:?filter=${filter}">
          <metal:use-macro use-macro="view/macro_vein_navigation/macros/vein">
            <metal:fill-slot fill-slot="sidebar">
              <tal:block replace="structure python: view.service_sidebar.render(model, 'asset_lookup?filter=%s' % filter, breadcrumb_vein)" />
            </metal:fill-slot>
          </metal:use-macro>
        </td>

        <tal:block replace="nothing">
          _____________________ main subtable _____________________
        </tal:block>
        <td class="main"
          style="padding:0;">

        <table class="listing"
          style="margin:0;"
          id="sortable"
          tal:define="
            global assets python:test((filter == 'Asset'), model.get_assets(), model.get_assets_of_type('Silva %s'%filter));
            empty python:len(assets) == 0">
          <thead>
            <tal:block replace="nothing">
              ______________ vein + title row ______________
            </tal:block>
            <tr>
              <td class="top"
                colspan="5">
                <h2 tal:attributes="title string:id: ${model/id}">
                  <img tal:replace="structure python:view.render_icon(model)" />
                  &#xab;<span tal:replace="structure string:${title}">title</span>&#xbb;
                </h2>
              </td>
            </tr>

            <tal:block replace="nothing">
              ______________ top controls row ______________
            </tal:block>
            <tr class="top-controls">
              <td class="align-right"
                colspan="5">
                <form action="." name="silvaObjects" method="POST">
                  <h3 style="float:left;">
                    <tal:block content="string:${filter}s" />
                  </h3>
                  <tal:block condition="python:silva_permissions['ChangeSilvaContent'] and filter != 'Asset'">
                    <input class="navigation"
                      type="submit"
                      name="add_object:method" 
                      title="add a new item: alt-n"
                      accesskey="n" 
                      tal:attributes="value string: New ${filter} "
                      />
                    <input type="hidden"
                      id="meta_type"
                      name="meta_type"
                      tal:attributes="value string:Silva ${filter}"
                    />
                    <input type="hidden"
                      name="mode_asset:int"
                      value="1"
                    />
                  </tal:block>
                </form>
              </td>
            </tr>
          </thead>

<script language="JavaScript">
<!--
function setReference() {
  doc = document.all ? document.all : document;
  l = doc.mumble_form.mumble.length;
  if (l) {
    for (i=0; i<l; i++) {
      if (doc.mumble_form.mumble[i].checked) {
        reference = doc.mumble_form.mumble[i];
        break;
      }
    }
  } else {
    // Just one radio button available.
    // So element itself and not a NodeList returned *sigh*.
    reference = doc.mumble_form.mumble;
  }
  // Split from value attribute, since NS4 does not know of a id attribute
  retrieved = reference.value;
  splitpos = retrieved.indexOf('||');
  id = retrieved.substring(0, splitpos)
  value = retrieved.substring(splitpos + 2, retrieved.length);
  // Send back id and reference to calling window
  opener.insertAssetReference(id, value, self);
}
//-->
</script>

          <form name="mumble_form"
            id="mumble_form">
            <tbody>
              <tal:block replace="nothing">
                ______________ listing header ______________
              </tal:block>
              <tr tal:condition="not: empty">
              <th class="listing-right">
                &nbsp;
              </th>
              <th i18n:translate="select">
                select
              </th>
              <th i18n:translate="view">
                view
              </th>
              <th i18n:translate="modified">
                modified
              </th>
              <th i18n:translate="author">
                author
              </th>
              </tr>

              <tal:repeat repeat="asset assets">
              <tal:define define="
                iterate repeat/asset/odd;
                identifier python:'%s||%s' % (asset.id, mangle.Path.fromObject(asset_context, asset));
              ">
              <tr tal:attributes="class python:iterate and 'even' or 'odd'">
                <tal:block tal:replace="nothing"> _______ radio button cell _______ </tal:block>
                <td>
                  <input
                    type="radio"
                    name="mumble"
                    tal:attributes="
                      value identifier;
                      id identifier;
                      " />
                </td>
                <tal:block tal:replace="nothing"> _______ icon + label cell _______ </tal:block>
                <td nowrap="1">
                  <label style="text-transform:none;"
                    title="select this asset"
                    tal:attributes="for identifier"><img tal:replace="structure python:view.render_icon(asset)" />
                    <tal:block tal:replace="asset/id">id</tal:block>
                  </label>
                </td>
                <tal:block tal:replace="nothing"> _______ title cell _______ </tal:block>
                <td>
                  <a class="blacklink" title="View this asset"
                    tal:attributes="href string:${asset/absolute_url}">
                    <span tal:replace="asset/get_title_or_id">title</span>
                  </a>
                </td>
                <tal:block tal:replace="nothing"> _______ modification date cell _______ </tal:block>
                <td>
                  <span tal:condition="python:asset.get_modification_datetime() != None"
                    tal:replace="structure python:view.service_utils.backend_short_datetime_to_str(asset.get_modification_datetime())">21 oct 2001 18:18</span>
                  <span tal:condition="python:asset.get_modification_datetime() == None" tal:omit-tag="">&nbsp;</span>
                </td>
                <tal:block tal:replace="nothing"> _______ author cell _______ </tal:block>
                <td tal:content="python:asset.sec_get_last_author_info().fullname()">
                  author name
                </td>
              </tr>
              </tal:define>
              </tal:repeat>
              <tr class="even"
                tal:condition="empty">
                <tal:block tal:replace="nothing"> _______ if no assets _______ </tal:block>
                <td>
                  No <span tal:replace="python:filter.lower()">assets</span> in this folder
                </td>
              </tr>
            </tbody>
          </form>

          <tfoot>
            <tal:block replace="nothing">
              ______________ controls ______________
            </tal:block>
            <tr class="controls">
             <td class="align-right"
               colspan="5">
               <input class="cancel"
                 style="float:left;"
                 type="button"
                 name="cancel"
                 value="Cancel"
                 title="cancel operation - alt-c"
                 accesskey="c"
                 onclick="window.close();return false;"
                />
               <input class="button"
                 type="button"
                 name="place"
                 value="Place reference"
                 title="insert a reference to this asset - alt-p"
                 accesskey="p" 
                 onclick="setReference();return false;" 
                 tal:condition="not: empty"
                />
             </td>
            </tr>
          </tfoot>
        </table>

      </td>
    </tr>
  </tbody>
</table>

</metal:block>
</metal:block>
</html>
