<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  tal:define="global vein string:contents;"
  i18n:domain="silva">

<metal:block use-macro="here/macro_no_tabs/macros/master">
<metal:block fill-slot="main"
  tal:define="
    objects python:model.get_tree();
    silva_permissions here/get_silva_permissions;
    filter request/filter | request/SESSION/filter | string:asset;
    isMetaType python:filter in model.get_silva_addables_allowed();
    asset_context request/asset_context | request/SESSION/asset_context | string:/;
    folder_context request/folder_context | request/SESSION/folder_context | string:/;
    dummy python: request.SESSION.set('filter', filter);
    dummy python: request.SESSION.set('asset_context', asset_context);
    dummy python: request.SESSION.set('folder_context', folder_context);
    mangle python:modules['Products'].Silva.mangle;
">

<table class="columns columns2">
  <tbody>
    <tr>
      <tal:block replace="nothing">
        _____________________ sidebar _____________________
      </tal:block>
        <td class="left"
          style="width:25%; padding:0;"
          tal:define="query_string string:?filter=${filter}">
          <metal:use-macro use-macro="view/macro_vein_navigation/macros/vein">
            <metal:fill-slot fill-slot="sidebar">
              <tal:block replace="structure python: view.service_sidebar.render(model, 'asset_lookup?filter=%s' % filter, vein)" />
            </metal:fill-slot>
          </metal:use-macro>
        </td>

        <tal:block replace="nothing">
          _____________________ main subtable _____________________
        </tal:block>
        <td class="main"
          style="width:75%; padding:0;">

        <table class="listing"
          style="margin:0;"
          id="sortable"
          tal:define="
            global assets python:here.asset_lookup_get_objects(filter);
            empty python:len(assets) == 0;
            base_type python: filter == 'Silva Image' and 'image' or filter.lower();
            ">
              <thead>
            <tal:block replace="nothing">
              ______________ vein + title row ______________
            </tal:block>
            <tr>
              <td class="top"
                colspan="5">
                <h2 tal:attributes="title string:id: ${model/id}">
                  <img tal:replace="structure python:view.render_icon(model)" />
                  &#171;<span tal:replace="structure string:${title}">title</span>&#187;
                </h2>
              </td>
            </tr>

            <tal:block replace="nothing"> 
              ______________ top controls row ______________
            </tal:block>
            <tr class="top-controls">
              <td class="align-right"
                colspan="5">
                <form action="." name="silvaObjects" method="POST">
                  <h3 style="float:left;">
                    <tal:block content="string:${base_type}s" />
                  </h3>
                  <tal:block condition="python:silva_permissions['ChangeSilvaContent'] and isMetaType">
                    <!--XXX i18n problem ahead-->
                    <input class="transport"
                      type="submit"
                      name="add_object:method" 
                      title="add a new item: alt-n"
                      accesskey="n" 
                      tal:attributes="value string: new ${base_type}..."
                      i18n:attributes="title"
                      />
                    <input type="hidden"
                      id="meta_type"
                      name="meta_type"
                      tal:attributes="value filter"
                    />
                    <input type="hidden"
                      name="mode_asset:int"
                      value="1"
                    />
                  </tal:block>
                </form>
              </td>
            </tr>
          </thead>

<script type="text/javascript">
//<![CDATA[

function setReference() {
  doc = document.all ? document.all : document;
  l = doc.mumble_form.mumble.length;
  if (l) {
    for (i=0; i<l; i++) {
      if (doc.mumble_form.mumble[i].checked) {
        reference = doc.mumble_form.mumble[i];
        break;
      }
    }
  } else {
    // Just one radio button available.
    // So element itself and not a NodeList returned *sigh*.
    reference = doc.mumble_form.mumble;
  }
  // Split from value attribute, since NS4 does not know of a id attribute
  retrieved = reference.value;
  splitpos = retrieved.indexOf('||');
  id = retrieved.substring(0, splitpos)
  value = retrieved.substring(splitpos + 2, retrieved.length);
  // Send back id and reference to calling window
  opener.insertAssetReference(id, value, self);
}

//]]>
</script>

          <form name="mumble_form"
            id="mumble_form">
            <tbody>
              <tal:block replace="nothing">
                ______________ listing header ______________
              </tal:block>
              <tr tal:condition="not: empty">
              <th class="listing-right">
                &nbsp;
              </th>
              <th i18n:translate="">
                select
              </th>
              <th i18n:translate="">
                view
              </th>
              <th i18n:translate="">
                modified
              </th>
              <th i18n:translate="">
                author
              </th>
              </tr>

              <tal:repeat repeat="asset assets">
              <tal:define define="
                iterate repeat/asset/odd;
                identifier python:'%s||%s' % (asset.id, mangle.Path.fromObject(folder_context, asset));
                status_style python:asset.get_object_status()[1];
              ">
              <tr tal:attributes="class python:iterate and 'even' or 'odd'">
                <tal:block tal:replace="nothing"> _______ radio button cell _______ </tal:block>
                <td>
                  <input
                    type="radio"
                    name="mumble"
                    tal:attributes="
                      value identifier;
                      id identifier;
                      checked python: repeat['asset'].index == 0 and 'checked' or '';
                      " />
                </td>
                <tal:block tal:replace="nothing"> _______ icon + label cell _______ </tal:block>
                <td nowrap="1">
                  <label style="text-transform:none;"
                    tal:attributes="
                      for identifier;
                      title string:choose this ${asset/meta_type};"
                    ><img tal:replace="structure python:view.render_icon(asset)" />
                    <tal:block tal:replace="python: mangle.String.centeredTruncate(asset.id, 30)">id</tal:block>
                  </label>
                </td>
                <tal:block tal:replace="nothing"> _______ title cell _______ </tal:block>
                <td>
                  <a class="blacklink"
                    title="view this asset"
                    tal:content="python: mangle.String.centeredTruncate(asset.get_title_editable(), 30) or default"
                    tal:attributes="
                      href string:${asset/absolute_url};
                      class status_style;"
                    i18n:attributes="title">
                    <em i18n:translate="">view</em>
                  </a>
                </td>
                <tal:block tal:replace="nothing"> _______ modification date cell _______ </tal:block>
                <td tal:define="mtime asset/get_modification_datetime">
                  <span tal:condition="python:mtime != None"
                    tal:replace="structure python:mangle.DateTime(mtime).toShortStr()">21 oct 2001 18:18</span>
                  <span tal:condition="python:mtime == None" tal:omit-tag="">&nbsp;</span>
                </td>
                <tal:block tal:replace="nothing"> _______ author cell _______ </tal:block>
                <td tal:content="python:asset.sec_get_last_author_info().fullname()">
                  author name
                </td>
              </tr>
              </tal:define>
              </tal:repeat>
              <tr class="even"
                tal:condition="empty">
                <tal:block tal:replace="nothing"> _______ if no assets _______ </tal:block>
                <td>
                  <em i18n:translate="">No <span
                  tal:replace="python:filter.lower()" i18n:name="asset">asset</span> in
                  this folder.</em>
                </td>
              </tr>
            </tbody>
          </form>

          <tfoot>
            <tal:block replace="nothing">
              ______________ controls ______________
            </tal:block>
            <tr class="controls">
             <td class="align-right"
               colspan="5">
               <input class="cancel"
                 style="float:left;"
                 type="button"
                 name="cancel"
                 value="cancel"
                 title="cancel operation: alt-c"
                 accesskey="c"
                 i18n:attributes="title;value"
                 onclick="window.close();return false;"
                />
               <input class="transport"
                 type="button"
                 name="place"
                 value="place reference..."
                 title="insert a reference to this asset: alt-p"
                 accesskey="p"
                 i18n:attributes="title;value"
                 onclick="setReference();return false;" 
                 tal:condition="not: empty"
                />
             </td>
            </tr>
          </tfoot>
        </table>

      </td>
    </tr>
  </tbody>
</table>

</metal:block>
</metal:block>
</html>
