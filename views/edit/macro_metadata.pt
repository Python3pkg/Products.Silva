<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="silva">

<!-- Edit table -->
<metal:block define-macro="edit_table">
  <tal:block define="
    content version;
    ct python: mangle.String.centeredTruncate;
    truncatable python:['location'];
    "
    >
    <form method="POST"
      action="."
      name="form"
      tal:condition="content"
      tal:define="
        binding python: view.get_metadata(content) or nothing;
        is_container request/model/implements_container | nothing;
        form_errors options/form_errors | nothing;
        ">
      <table class="listing"
        tal:condition="binding">
        <thead>
          <tr tal:replace="nothing">
            ______________ vein + title row ______________
          </tr>
          <tr>
            <td class="top"
              colspan="4">
              <h2>
                <img tal:replace="structure python:view.render_icon(model)" />
                <tal:block i18n:translate="">
                metadata
                <tal:block condition="not: model/implements_container" i18n:name="for_title">
                  <span i18n:translate="">
                  for &#xab;<tal:block content="string:${title}"
                  i18n:name="metadata_title">
                  title</tal:block>&#xbb;</span>
                  </tal:block>
                </tal:block>
              </h2>
            </td>
          </tr>
        </thead>
        <tbody>
          <tal:block repeat="set_name binding/setNames">
            <tal:block define="set_errors form_errors/?set_name | nothing">
              <tr tal:condition="not:repeat/set_name/start">
                <td class="divider"
                  colspan="4"
                  tal:attributes="style python:model.implements_container() and 'background:#c4d6e7' or 'background:#c5d4ca'">
                </td>
              </tr> 
              <tr tal:replace="nothing">
                ______________ top controls row ______________
              </tr>
              <tr class="top-controls">
                <td colspan="4">
                  <h3>
                    <span i18n:translate="">metadata set</span> &#xab;<tal:block replace="binding/?set_name/setTitle | set_name" />&#xbb;
                  </h3>
                </td>
              </tr>
              <tr>
                <th class="align-right"
                  width="12%"
                  i18n:translate="">
                  element
                </th>
                <th i18n:translate="">
                  content
                </th>
                <th i18n:translate="">
                  acquired content
                </th>
                <th width="25%"
                  i18n:translate="">
                  note
                </th>
              </tr>
              <tal:block repeat="element_name binding/?set_name/elementNames">
                <tr 
                  tal:define="
                    element binding/?set_name/?element_name;
                    element_error form_errors/?set_name/?element_name | nothing;
                    iterate repeat/element_name/odd;"
                  tal:attributes="
                    class python:element_error and 'alert' or iterate and 'odd' or 'even';">
                  <tal:block replace="nothing">
                    ___ element name column ___
                  </tal:block>
                  <td class="align-right">
                    <tal:block content="element/title">
                    Element name
                    </tal:block>
                    <span class="warning"
                      tal:condition="element/isRequired">
                      *
                    </span>
                  </td>
                  <tal:block replace="nothing">
                    ___ element widget column ___
                  </tal:block>
                  <td tal:define="                        
                    data python: element['render'] or element['view'];
                    data python: element_name in truncatable and ct(data, 50) or data;
                    "
                    tal:condition="
                      python: element['isEditable'] or not element['isAcquired']"
                    tal:content="
                      structure data">
                    element edit widget
                  </td>
                  <tal:block replace="nothing">
                    ___ element acquired value column ___
                  </tal:block>
                  <td>
                    <tal:block 
                      define="
                        data element/view;
                        data python: element_name in truncatable and ct(data, 50) or data;"
                      condition="element/isAcquired"
                      replace="structure data" />
                    <sup tal:condition="element/isAcquireable" i18n:translate="">
                      &#134;
                    </sup>
                    <tal:block condition="not: element/isAcquired">
                      &nbsp;
                    </tal:block>
                  </td>
                  <tal:block replace="nothing">
                    ___ element desc. column ___
                  </tal:block>
                  <td>
                    <tal:block content="structure element/description">
                      Element description
                    </tal:block>
                    <span class="error"
                      tal:condition="element_error"
                      tal:content="element_error">
                    </span>
                  </td>
                </tr>
              </tal:block>
            </tal:block>
            <tr tal:condition="python: set_name != 'silva-content'">
              <th class="align-right">
              </th>
              <th i18n:translate="">
                date format: day / month / year &nbsp;23:59 
              </th>
              <th i18n:translate="">
                &#134; acquireable
              </th>
              <th>
              </th>
            </tr>
            <tr class="controls">
              <td class="align-right"
                colspan="4">
                <input class="button" 
                  type="submit"
                  name="save_metadata:method"
                  value="save"
                  title="access key: alt-s"
                  accesskey="s"
                  i18n:attributes="value;title"
                />
              </td>
            </tr>
          </tal:block>
           
          <tal:block define="renderers python: request.model.service_renderer_registry.getFormRenderersList(request.model.meta_type)"
              condition="python:len(renderers) &gt; 2">
              <tr>
                <td class="divider"
                  colspan="4"
                  tal:attributes="style python:model.implements_container() and 'background:#c4d6e7' or 'background:#c5d4ca'">
                </td>
              </tr> 
            <tr tal:replace="nothing">
              ______________ top controls row ______________
            </tr>
            <tr class="top-controls">
              <td colspan="4">
                <h3>
                  <span i18n:translate="">content renderer</span>
                </h3>
              </td>
            </tr>
            <tr>
              <tal:block replace="nothing">
                ___ element name column ___
              </tal:block>
              <td class="align-right">
                <tal:block i18n:translate="">
                  renderer
                </tal:block>
              </td>
              <tal:block replace="nothing">
                ___ element widget column ___
              </tal:block>
              <td>
                <select name="renderer_name_select">
                  <tal:block define="selected_renderer_name python:request.model.get_editable().get_renderer_name()" repeat="renderer_name renderers">
                    <option
                      tal:content="renderer_name" 
                      tal:attributes="
                        value python:renderer_name;
                        selected python: test(selected_renderer_name == renderer_name, 'selected', None);">
                    </option>
                  </tal:block>
                </select>
              </td>
              <tal:block replace="nothing">
                ___ element acquired value column ___
              </tal:block>
              <td>
                  &nbsp;
              </td>
              <tal:block replace="nothing">
                ___ element desc. column ___
              </tal:block>
              <td>
                <tal:block i18n:translate="">
                  Select a renderer that will be used to render this 
                  object.
                </tal:block>
              </td>
            </tr>
            <tr class="controls">
              <td class="align-right"
                colspan="4">
                <input class="button" 
                  type="submit"
                  name="save_metadata:method"
                  value="save"
                  title="access key: alt-s"
                  accesskey="s"
                  i18n:attributes="value;title"
                />
              </td>
            </tr>
          </tal:block>  
        </tbody>
      </table>
    </form>
  </tal:block>
</metal:block>


<!-- Read only table -->
<metal:block define-macro="view_table">
  <tal:block define="
    content version;
    ct python: mangle.String.centeredTruncate;
    truncatable python:['location'];
    "
    >
    <tal:block 
      condition="content"
      define="
        binding python: view.get_metadata(content) or nothing;
        is_container request/model/implements_container | nothing;
        form_errors options/form_errors | nothing;
        ">
      <table class="listing"
        tal:condition="binding">
        <thead>
          <tr tal:replace="nothing">
            ______________ vein + title row ______________
          </tr>
          <tr>
            <td class="top"
              colspan="2">
              <h2 metal:define-slot="table_title" i18n:translate="">
                <img tal:replace="structure python:view.render_icon(model)" />
                metadata
                <span tal:condition="not: model/implements_container" i18n:name="for_title"><span i18:translate="">
                  for &#xab;<span tal:replace="string:${title}" i18n:name="title">title</span>&#xbb;</span>
                </span>
              </h2>
            </td>
          </tr>
        </thead>
        <tbody>
          <tal:block repeat="set_name binding/setNames">
            <tr tal:replace="nothing">
              ______________ top controls row ______________
            </tr>
            <tr class="top-controls">
              <td colspan="2">
                <h3>
                  <span i18n:translate="">metadata set</span> &#xab;<tal:block replace="binding/?set_name/setTitle | set_name" />&#xbb;
                </h3>
              </td>
            </tr>
            <tr>
              <th class="align-right"
                width="12%" i18n:translate="">
                element
              </th>
              <th i18n:translate="">
                content
              </th>
            </tr>
            <tal:block repeat="element_name binding/?set_name/elementNames">
              <tr 
                tal:define="
                  element binding/?set_name/?element_name;                  
                  iterate repeat/element_name/odd;
                  show_bottom_border repeat/element_name/end;"
                tal:attributes="
                  class python: iterate and 'odd' or 'even';
                  style python: show_bottom_border and 'border-bottom: 1px solid #77858c' or nothing;">
                <tal:block replace="nothing">
                  ___ element name column ___
                </tal:block>
                <td class="align-right"
                  tal:content="element/title">
                  Element name
                </td>
                <tal:block replace="nothing">
                  ___ element widget column ___
                </tal:block>
                <td 
                  tal:define="
                    data python: element['view'];
                    "
                  tal:content="
                    structure data">
                  Element content view
                </td>
              </tr>
            </tal:block>
          </tal:block>
          <tal:block>
            <tal:block define="renderer_name content/get_renderer_name" 
                    condition="python: request.model.service_renderer_registry.doesRendererExistForMetaType(request.model.meta_type, renderer_name)">
              <tr tal:replace="nothing">
                ______________ top controls row ______________
              </tr>
              <tr class="top-controls">
                <td colspan="4">
                  <h3>
                    <span i18n:translate="">content renderer</span>
                  </h3>
                </td>
              </tr>
              <tr>
                <tal:block replace="nothing">
                  ___ element name column ___
                </tal:block>
                <td class="align-right">
                  <tal:block i18n:translate="">
                    renderer
                  </tal:block>
                </td>
                <tal:block replace="nothing">
                  ___ element widget column ___
                </tal:block>
                <td tal:content="renderer_name">
                  
                </td>
              </tr>
            </tal:block>
          </tal:block>
        </tbody>
        <tfoot>
          <tr class="controls">
            <td class="align-right"
              colspan="2">
              <span tal:replace="nothing"> _______ make changes after revoking approval _______ </span>
              <tal:block condition="python: hasattr(model, 'get_approved_version') and model.get_approved_version() and display_flag == 1">
                <form action="properties_revoke_approval"
                  method="POST">
                  <input 
                    class="button" 
                    type="submit" 
                    value="revoke approval" 
                    title="first 'un-approve' this item in order to edit: alt-r" 
                    accesskey="r"
                    i18n:attributes="value;title"
                  />
                </form>
              </tal:block>
              <span tal:replace="nothing"> _______ make changes in a new version _______ </span>
              <tal:block condition="python: not hasattr(model, 'get_next_version') or not model.get_next_version()">
                <form action="properties_make_copy"
                  method="POST">
                  <input class="button"
                    type="submit"
                    value="new version"
                    title="create a new version of this content: alt-n"
                    accesskey="n"
                    i18n:attributes="value;title"
                  />
                </form>
              </tal:block>
            </td>
          </tr>
        </tfoot>
      </table>
    </tal:block>
  </tal:block>
</metal:block>
</html>
