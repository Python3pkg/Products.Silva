<tal:block define="
  global active_tab string:tab_access;
  global breadcrumb_vein string:Groups;
  " />
<!-- ________________________ GROUPS ADMIN _____________________________ -->
<metal:block use-macro="here/macro_index/macros/master">
<div class="margins" metal:fill-slot="main">
<h3><a href="tab_access" title="Up to top of Access tab">Access
  <img tal:attributes="src string:${silva_root}/globals/up_gray.gif" width="16" height="11" border="0" alt="Up to top of Access tab" /></a></h3>
<h2 class="worksheet">
  Groups administration
</h2>
<div class="worksheet borders top bottom left right"  
    tal:condition="python:view.has_access()">
<form action="." method="POST">
<!-- _______________________ USERS TO GROUPS ___________________________ -->
<table width="100%" cellspacing="0" cellpadding="5" border="0">
<tr>
<td align="left" colspan="3">
  <h3>Add Users to Groups</h3>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" width="30%">
<table width="100%" cellspacing="0" cellpadding="3" border="0">
<tr class="topcontrols">
  <th align="left" colspan="2">
    <img src="pixel.gif" width="1px" height="18px"
      tal:attributes="src string:${silva_root}/globals/pixel.gif" />        
    <input type="submit" class="button" name="lookup:method" value="Users lookup..." 
      title="Go to: Lookup and select users to add to groups..." />
    <input type="hidden" name="referer" value="tab_access_groups"/>
  </th>
</tr>
<tal:block define="selected_users python:here.lookup_get_selection().values()">
<tal:block 
  condition="selected_users"    
  repeat="selected_user selected_users">
<tr class="focus"
  tal:define="oddrow repeat/selected_user/odd"
  tal:attributes="class python:test(oddrow, 'focus', 'focus-cycle')">
  <td colspan="2" align="left">
    <input type="checkbox" name="users:list" value="" 
      tal:attributes="value string:${selected_user/uid}"/>&nbsp;
      <span class="subhead" tal:content="selected_user/cn" />&nbsp;
      <tal:block condition="selected_user/userclass | nothing">
        (<span tal:content="selected_user/userclass" />)
      </tal:block>
      <br />
  </td>
</tr>
</tal:block>
<tr class="focus"
  tal:condition="not:selected_users">
  <td colspan="2">
    <i>No users selected</i>&nbsp;
  </td>
</tr>
</tal:block>
<tr class="controls">
<td colspan="2" align="right">
  <img src="pixel.gif" width="1px" height="18px"
    tal:attributes="src string:${silva_root}/globals/pixel.gif" />  
</td>
</tr>
</table>
</td>

<td width="20%" align="center">
  <input type="submit" class="button" name="add_users_to_groups:method" value="Add >>"
     title="Add selected user(s) to selected group(s)." />&nbsp;
     <img src="pixel.gif" width="1px" height="18px"
       tal:attributes="src string:${silva_root}/globals/pixel.gif" />    
</td>

<td align="left" width="50%">
<table width="100%" cellspacing="0" cellpadding="3" border="0">
<tr class="topcontrols">
  <th align="right" colspan="3">
    <img src="pixel.gif" width="1px" height="18px"
      tal:attributes="src string:${silva_root}/globals/pixel.gif" />
    <input type="text" name="group" value="" size="20"
      title="Define a new group." />&nbsp;
    <input type="submit" class="button" name="add_locally_managed_group:method" value="Add new group"
      title="Define and add a new group." />
  </th>
</tr>
<tal:block define="groups view/list_locally_managed_groups">
<tal:block repeat="group groups">
<tr class="focus"
    tal:define="
      global oddrow repeat/group/odd;
      global members python:view.list_users_in_locally_managed_group(group)"
    tal:attributes="class python:test(oddrow, 'focus', 'focus-cycle')">
    <td align="left" width="50%">
      <input type="checkbox" name="groups:list" value="group"
        tal:attributes="value group" />
      <b tal:content="group" />
    </td>
    <td align="right" width="50%">
      <i tal:condition="members">has member(s):</i>
      <i tal:condition="not:members">no&nbsp;members</i>
    </td>
    <td align="right">
      &nbsp;
    </td>
</tr>
<tal:block repeat="user members">
<tr class="focus"
  tal:attributes="class python:test(oddrow, 'focus', 'focus-cycle')">
  <td>&nbsp;</td>
  <td align="right">
    <b tal:content="user" />
  </td>
  <td align="right">
      <input type="checkbox" class="warningbox" name="users_groups:list" value="group"
        tal:attributes="value python:'%s||%s' % (user, group);" />      
  </td>
</tr>
</tal:block>
</tal:block>
<tr class="controls-cycle">  
  <td colspan="3" align="right">
    <i tal:condition="not:groups">No groups to manage defined</i>&nbsp;
    <input type="submit" class="warningbutton" name="remove_users_from_groups:method" value="Remove users"
      title="Remove selected user(s) from their group(s)."
      tal:condition="groups" />
  </td>
</tr>
<tr class="controls">
  <td align="left">    
    <input type="submit" class="warningbutton" name="remove_locally_managed_groups:method" value="Delete" 
      title="Delete selected group definition(s)."
      onClick="return confirm('Really delete group(s)?')"/>
  </td>
  <td align="right" colspan="2">
    &nbsp;
  </td>
</tr>
</tal:block>
</table>
</td>
</tr>
</table>
</form>
<!-- _____________________ END USERS TO GROUPS _________________________ -->

<!-- ___________________ GROUP TO VIRTUAL GROUPS _______________________ -->
<br />
<div class="rule">&nbsp;</div>

<form action="." method="POST">
<table width="100%" cellspacing="0" cellpadding="5" border="0">
<tr>
  <td align="left" colspan="2">
    <h3>Add Groups to VirtualGroups</h3>
  </td>
  <td align="left" width="50%">
    &nbsp;
  </td>
</tr>
<tr valign="top">
<td align="right" width="30%">
  <select name="group" title="Select a group to add.">
    <option value="None">Select...</option>
    <option value="group" 
      tal:repeat="group view/service_groups/listNormalGroups" 
      tal:attributes="value group" 
      tal:content="group">Group</option>
  </select>&nbsp;
  </td>
  <td width="20%" align="center">
    <input type="submit" class="button" name="add_groups_to_virtual_groups:method" value="Add >>"
      title="Add selected group to selected virtual group(s)." />            
  </td>
<td align="left" width="50%">
<table width="100%" cellspacing="0" cellpadding="3" border="0">
<tr class="topcontrols">
  <th align="right" colspan="3">
    <img src="pixel.gif" width="1px" height="18px"
      tal:attributes="src string:${silva_root}/globals/pixel.gif" />
    <input type="text" name="virtual_group" value="" size="20"
      title="Define a new virtual group." />&nbsp;
    <input type="submit" class="button" name="add_locally_managed_virtual_group:method" value="Add new group"
      title="Define and add a new virtual group." />
  </th>
</tr>
<tal:block define="virtual_groups view/list_locally_managed_virtual_groups">
<tal:block repeat="virtual_group virtual_groups">
<tr class="focus"
  tal:define="
    global oddrow repeat/virtual_group/odd;
    global members python:view.list_groups_in_locally_managed_virtual_group(virtual_group);"
  tal:attributes="class python:test(oddrow, 'focus', 'focus-cycle')">
  <td align="left" width="50%">
    <input type="checkbox" name="virtual_groups:list" value="virtual_group"
      tal:attributes="value virtual_group" />
    <b tal:content="virtual_group" />
  </td>
  <td align="right" width="50%">
    <i tal:condition="members">has member(s):</i>
    <i tal:condition="not:members">no&nbsp;members</i>
  </td>
  <td align="right">
    &nbsp;
  </td>
</tr>
<tal:block repeat="group members">
<tr class="focus"
  tal:attributes="class python:test(oddrow, 'focus', 'focus-cycle')">
  <td>&nbsp;</td>
  <td align="right">
    <b tal:content="group" />
  </td>
  <td align="right">
    <input type="checkbox" class="warningbox" name="groups_virtualgroups:list" value="group"
      tal:attributes="value python:'%s||%s' % (group, virtual_group);" />
  </td>
</tr>
</tal:block>
</tal:block>
<tr class="focus">  
  <td colspan="3" align="right">
    <i tal:condition="not:virtual_groups">No virtual groups to manage defined</i>&nbsp;
    <input type="submit" class="warningbutton" name="remove_groups_from_virtual_groups:method" value="Remove groups"
      title="Remove selected group(s) from their virtual group(s)."
      tal:condition="virtual_groups" />
  </td>
</tr>
<tr class="controls">
  <td align="left">
    <input type="submit" class="warningbutton" name="remove_locally_managed_virtual_groups:method" value="Delete" 
      title="Delete selected virtual group definition(s)"
      onClick="return confirm('Really delete virtual group(s)?')"/>
  </td>
  <td align="right" colspan="2">
    &nbsp;
  </td>
</tr>
</tal:block>
</table>
</td>
</tr>
</table>
<!-- __________________ END GROUP TO VIRTUAL GROUPS ____________________ -->
</form>
</div>
</div>
</metal:block>
<!-- ______________________ END GROUPS ADMIN ___________________________ -->
