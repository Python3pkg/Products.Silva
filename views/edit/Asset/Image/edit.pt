<html tal:omit-tag=""
  tal:define="
    view here;
    model request/model;    
    mangle modules/Products/Silva/mangle;
    root_url model/get_root_url;
    title model/get_title_editable;
    vein string:edit;
    "
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="silva">
<metal:use-macro use-macro="view/macro_asset_edit/macros/editor">

 <metal:fill-slot fill-slot="info">
  <script type="text/javascript"
          tal:attributes="src view/cropping.js/absolute_url">
  </script>
  <div class="info">
    <h3 i18n:translate="">
      <img tal:replace="structure icon" /> image info
    </h3>
    <tal:block tal:condition="model/canScale">
      <p tal:condition="not: model/hires_image">
        <span class="subhead" i18n:translate="">format</span><br />
        <span tal:replace="python: model.web_format.lower()" /> image
        <br />
        <span class="subhead" i18n:translate="">dimensions</span><br />
        <span tal:define="
          img_width python: model.getDimensions()[0];
          img_height python: model.getDimensions()[1];
          "
          tal:on-error="string: unknown"
          tal:replace="string:${img_width}x${img_height} pixels"
        />
      </p>

      <p tal:condition="model/hires_image">
      <span class="subhead" i18n:translate="">format</span><br />
      <span tal:replace="python: model.web_format.lower()">format</span>
      <span i18n:translate="">image</span>
      </p>
      <p tal:define="
        image_width python: model.getDimensions()[0];
        image_height python: model.getDimensions()[1];
        scale_width python: model.getCanonicalWebScale()[0];
        scale_height python: model.getCanonicalWebScale()[1];
        ">
        <span class="subhead" i18n:translate="">dimensions</span><br />
        <span tal:on-error="string: unknown"
          tal:replace="string:${image_width}x${image_height} pixels"
        />
        <tal:condition condition="python:
          image_width != scale_width or
          image_height != scale_height"
          i18n:translate=""><br />
          scaled to
          <span
            tal:on-error="string: unknown"
            tal:replace="string:${scale_width}x${scale_height}"
            i18n:name="WxH"
          />
          pixels
        </tal:condition>
      </p>
      <p>
      <span class="subhead" i18n:translate="">original</span><br />
        <a href="" class="underline"
          title="see the original image"
          accesskey="v"
          tal:attributes="href python:model.url(hires=1)"
          i18n:attributes="title"
          i18n:translate="">
          <tal:condition condition="model/thumbnail_image">
            <img tal:replace="structure python:model.tag(thumbnail=1)" /><br />
          </tal:condition>
          view unscaled image
        </a>
      </p>
      <p tal:condition="model/hires_image" 
        tal:define="orientation model/getOrientation; klass model/getOrientationClass">
        <span class="subhead" i18n:translate="">orientation</span><br />
        <span tal:content="orientation"
          tal:attributes="class string:${klass} orientation"
          >Square</span>
      </p>
    </tal:block>
    <p tal:condition="not: model/canScale">
      <tal:block i18n:translate="">Note: Silva can provide image scaling and conversion with the help of PIL</tal:block>
      (<a href="http://www.pythonware.com/products/pil/">Python Imaging Library</a>).
      <tal:block i18n:translate="">PIL doesn't seem to be installed.</tal:block>
    </p>
    <p tal:define="
        size model/get_file_size;
        scaled_size model/get_scaled_file_size;
      ">
      <span class="subhead"><strong i18n:translate="">file size</strong><br /></span>
      <span tal:attributes="title string: ${size} Bytes"
        tal:content="python:mangle.Bytes(size)" />
      <tal:block tal:condition="model/canScale">
         <br />
         <tal:condition condition="python: size != scaled_size">
          <span 
            tal:attributes="title string: ${scaled_size}"
            tal:content="python:mangle.Bytes(scaled_size)" /> 
            <span i18n:translate="">scaled</span>
          </tal:condition>
      </tal:block>
    </p>
    <tal:block tal:condition="python:user.has_role(['Manager'], model)">
      <p tal:define="path model/getFileSystemPath"
        tal:condition="path">
        <span class="subhead"><strong i18n:translate="">file system path</strong><br /></span>
        <span tal:replace="structure python:  ' / '.join(path.split('/'))" />
      </p>
      </tal:block>
  </div>
</metal:fill-slot>

<metal:fill-slot fill-slot="additional_tools">
  <form method="POST"
    name="form"
    action="."
    enctype="multipart/form-data"
    tal:condition="model/canScale">
    <table class="listing">
      <thead>
        <tal:block replace="nothing">
          ______________ top controls row ______________
        </tal:block>
        <tr class="top-controls">
          <td colspan="3">
            <h3 i18n:translate="">
              format and scaling
            </h3>
          </td>
        </tr>
      </thead>
      <tbody tal:define="fields view/scale_form/get_fields">
        <tr>
          <th class="align-right"
            width="12%"
            i18n:translate="">
            element
          </th>
          <th i18n:translate="">
            content
          </th>
          <th width="40%" i18n:translate="">
            note
          </th>
        </tr>
        <tal:repeat repeat="field fields">
          <tal:define define="iterate repeat/field/odd">
            <tr tal:attributes="class python:iterate and 'odd' or 'even'">
              <td class="field-title">
                <span tal:content="python:field['title']" >
                  title</span><span class="warning"
                  tal:condition="python:field.is_required()">*</span>
              </td>
              <td>
                <input tal:replace="structure python:field.render_from_request(request)" />
              </td>
              <td>
                <span tal:replace="structure python:field.get_value('description')">
                  comments here (field description)
                </span>
              </td>
            </tr>
          </tal:define>
        </tal:repeat>
      </tbody>
      <tfoot>
        <tr class="controls">
          <td></td>
          <td>
            <input class="transport"
              type="button"
              value="set crop coordinates..."
              title="specify the center of the area to crop by clicking in the image: alt-o"
              accesskey="o"
              tal:define="asset_context python:request.model"
              tal:attributes="onclick python:'openlookupWindow(\'%s/edit/lookup_cropcoordinates?asset_context=%s\');; ' % (asset_context.absolute_url(), '/'.join(asset_context.getPhysicalPath()))"
              i18n:attributes="title;value"
              />
          </td>
          <td class="align-right">
            <input class="button"
              type="submit"
              name="scale_submit:method"
              value="change"
              title="access key: alt-c"
              accesskey="c"
              i18n:attributes="title;value"
            />
          </td>
        </tr>
      </tfoot>
    </table>
  </form>

  <metal:block use-macro="view/macro_asset_edit/macros/uploader" />
</metal:fill-slot>

</metal:use-macro>

</html>
