<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html metal:define-macro="master"
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="silva"
  tal:define="
    view    here;
    model   request/model;
    trigger model/security_trigger;
    mangle  modules/Products/Silva/mangle;

    type    model/meta_type;
    url     model/absolute_url;
    title   python: model.get_title_editable() or model.id;

    root_url model/get_root_url;
    global   publication model/get_publication;
    global   containing_publication publication/../get_publication | publication;
    
    content_type      view/set_content_type;
    set_cache_headers view/set_cache_headers;

    silva_permissions   view/get_silva_permissions;
    may_approve_content silva_permissions/ApproveSilvaContent | nothing;
    may_change_content  silva_permissions/ChangeSilvaContent | nothing;    

    message_type options/message_type | request/message_type | nothing;
    message      options/message | request/message | nothing;

    dummy  python: here.recordError(type, message);
    dummy  python: here.REQUEST.set('edit_mode', 1);
    dummy  python: getattr(request, 'editor', None) and request.SESSION.set('editor', request.editor) or None;
    editor python: request.SESSION.get('editor', None) or view.service_members.get_member(view.REQUEST.AUTHENTICATED_USER.getUserName()).editor();

">

<head>
<title tal:content="title">
  Title
</title>
<link href="globals/favicon.ico"
  rel="shortcut icon"
  tal:attributes="href string:$root_url/globals/favicon.ico"
/>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<metal:block define-slot="meta" />
<style media="all"
  type="text/css"
  xml:space="preserve"
  tal:content="structure python: view.css_imports(['silva.css'])"
>
@imports
</style>
<link href="globals/silvaContentStyle.css"
  rel="stylesheet"
  type="text/css"
  tal:condition="python: not model.implements_container()"
  tal:attributes="href string:$root_url/globals/silvaContentStyle.css"
/>
<tal:block replace="nothing"> _______ use frontend.css in preview _______ </tal:block>
<metal:block define-slot="frontend" />
<tal:block replace="nothing"> _______ hook for local style tag _______ </tal:block>
<metal:block define-slot="style" />
<tal:block replace="nothing"> _______ hook for metatype stylesheet _______ </tal:block>
<metal:block define-slot="metatype_css" />
<tal:block replace="nothing"> _______ hook for application specific stylesheet _______ </tal:block>
<metal:block define-slot="extension_css" />
<tal:block replace="nothing"> _______ hook for refresh function _______ </tal:block>
<metal:block define-slot="refresher" />
<tal:block replace="nothing"> _______ XXX turned off, doesn't work _______ </tal:block>
<script type="text/javascript" tal:replace="nothing"
  xml:space="preserve"
  tal:attributes="src string:$root_url/globals/plone_javascripts.js">
</script>
<script language="JavaScript" type="text/javascript">
// can be attached to formfields so that pressing enter makes the form use
// a specific action, useful in forms with more than 1 submit button
function handle_default_action(element, event, action)
{
    code = event.which ? event.which : event.keyCode;
    if (code == 10 || code == 13)
    {
        element.form.action = action;
        element.form.submit();
    }
}
</script>
<tal:block tal:replace="nothing"> _______ script slot _______ </tal:block>
<metal:block define-slot="script" />
<tal:block tal:replace="nothing"> _______ moz site navigation_______ </tal:block>
<link rel="top" title="Up to Silva top" 
  tal:condition="python:type != 'Silva Root'"
  tal:attributes="href string:$root_url/edit" i18n:attributes="title" />
<link rel="up" href="../../edit" title="Up one level" 
  tal:condition="python:type != 'Silva Root'" i18n:attributes="title" />
<link rel="help" href="globals/accesskeys" title="Help with access keys" i18n:attributes="title" />
<link rel="copyright" href="globals/copyright" title="Silva copyright info" i18n:attributes="title"/>
</head>

<body tal:attributes="onload python: test(vein == 'editor' and editor == 'kupu', 
                                          'startKupu()', 
                                          'if (window.focus_editor) window.focus_editor()')">
<!-- __________________________ Start matrix tabs _________________________ -->
<metal:block use-macro="here/macro_tabs/macros/tabs">
  top navigation plugs in here....
</metal:block>
<!-- ___________________________ End matrix tabs __________________________ -->
<!-- ___________________________ Start workspace __________________________ -->
<div class="workspace">
  <metal:block define-slot="middleground" />

<span tal:replace="nothing">
<!-- ______________ start feedback ______________ -->
</span>
<tal:block condition="message">
  <div class="feedback"
    tal:attributes="
      class python:message_type == 'error' and 'fixed-alert' or 'fixed-feedback'">
    <span tal:replace="structure message">
      message
    </span>
    &nbsp;
    <tal:block tal:condition="python:message_type == 'feedback'">
      &nbsp;(<tal:block tal:replace="structure python:mangle.Now().toShortStr()" />)
    </tal:block>
  </div>
</tal:block>
<tal:block condition="not: message">
  <div class="fixed-clear" 
    tal:define="
      in_development_mode model/sec_in_development_mode;
      editing_a_silva_document python: (type == 'Silva Document' and template.id == 'tab_edit')"
    tal:omit-tag="python: editor == 'kupu' and editing_a_silva_document">
    <tal:block condition="python: in_development_mode">
      <tal:block condition="python: not editing_a_silva_document">
        <a class="reveal"
          href="/manage_main"
          title="jump to zope root: alt-z"
          accesskey="z"
          i18n:attributes="title;accesskey zroot_accesskey"
          i18n:translate="">
          zroot...
        </a>
        &nbsp;&nbsp;&nbsp;
        <a class="reveal"
          title="jump to silva root in zodb: alt-'"
          tal:attributes="href string:$root_url/manage_main"
          accesskey="'"
          i18n:attributes="title;accesskey sroot_accesskey"
          i18n:translate="">
          sroot...
        </a>
        &nbsp;&nbsp;&nbsp;
        <a class="reveal"
          title="jump to silva services: alt-`"
          tal:attributes="href string:$root_url/manage_services"
          accesskey="`"
          i18n:attributes="title;accesskey sservices_accesskey"
          i18n:translate="">
          sservices...
        </a>
      </tal:block>
    </tal:block>
    <tal:block condition="
      python: not (in_development_mode or editing_a_silva_document)">
      &nbsp;
    </tal:block>
  </div>
</tal:block>
<span tal:replace="nothing">
<!-- ______________ end feedback ______________ -->
</span>

<!-- _____________________ Start main _____________________ -->
<div metal:define-slot="main">
  Here the local content (a.k.a. "model") is inserted (this text will be replaced).
</div>
<!-- _____________________ End main _____________________ -->

<!-- ____________________________ Start footer ____________________________ -->
<span tal:replace="nothing">
<!-- _______ white space + jump to top _______ -->
</span>
<div style="float:left; width:16px">
  <a href="#top"
    title="jump to top: alt-t" 
    i18n:attributes="title;">
    <img alt="jump to top: alt-t"
      border="0"
      height="16"
      width="16"
      tal:attributes="src string:$root_url/globals/up_to_top_gray.gif"
      i18n:attributes="alt"
    />
  </a>
</div>
<div style="float:right; text-align:right; width:16px">
  <a href="#top"
    accesskey="t"
    title="jump to top: alt-t"
    i18n:attributes="title;accesskey jump_to_top_accesskey">
    <img alt="jump to top: alt-t"
      border="0"
      height="16"
      width="16"
      tal:attributes="src string:$root_url/globals/up_to_top_gray.gif"
      i18n:attributes="alt"
    />
  </a>
</div>

<span tal:replace="nothing">
<!-- ______________ page info ______________ -->
</span>
<div class="footer"
  tal:define="
    name  python: view.get_metadata_element('silva-extra', 'contactname');
    email python: view.get_metadata_element('silva-extra', 'contactemail');
    ">
    <div style="float: left;"> 
      <tal:block i18n:translate="">contact:</tal:block>
    <a shape="rect"
      tal:attributes="href string:mailto:$email">
      <tal:block tal:condition="name" tal:content="name">
      </tal:block>
      <tal:block tal:condition="python:not name">
        <tal:block tal:condition="email" tal:content="email">
        </tal:block>
        <tal:block tal:condition="python:not email" i18n:translate="">
          no name
        </tal:block>
      </tal:block>
    </a>
  </div>
  <div style="float: right;">
    <a shape="rect"
      title="Leave Silva and view the public page: alt-:"
      accesskey=":"
      tal:attributes="href url"
      i18n:attributes="title;accesskey view_public_version_accesskey"
      i18n:translate="">
      view public version
    </a>
  </div>
  &nbsp;
</div>

<span tal:replace="nothing">
<!-- ______________ user tools ______________ -->
</span>
<div class="personalbar"
  tal:define="userid request/AUTHENTICATED_USER/getUserName">
  <div style="float: left;">
    <a href=""
      title="Change your settings: alt-~"
      accesskey="~"
      tal:attributes="
        onclick string:userWindow = window.open('service_resources/Silva/edit_member', 'userWindow', 'width=450, height=250, resizable=no');;
        userWindow.focus();;
        return false;;"
      i18n:attributes="title;accesskey user_settings_accesskey">
      <img border="0"
        height="9"
        width="9"
        tal:attributes="src string:$root_url/globals/user.png"
      />
      <span i18n:translate="">user settings</span>
    </a>
  </div>
  <div style="float: right;">
    <a href="logout"
      accesskey="q"
      title="Logout of Silva: alt-q"
      i18n:translate=""
      i18n:attributes="title;accesskey logout_accesskey">
      logout
      <tal:block tal:condition="here/get_user_role"
        i18n:name="role"
        tal:content="structure string:${here/get_user_role}" />
      <tal:block i18n:name="userid" tal:content="userid" />
    </a>
  </div>
  <a name="bottom">
    &nbsp;
  </a>
  <a href=""
    title="Request an additional role in this location: alt-,"
    accesskey=","
    tal:condition="view/service_members/allow_authentication_requests"
    tal:attributes="href string:public/request_roles?last_url=$url/edit/${template/id}"
    i18n:attributes="title;accesskey request_access_accesskey"
    i18n:translate="">
    request access
  </a>
</div>
<span tal:replace="nothing">
  <!-- ____________________________ footer ends _____________________________ -->
</span>

<span tal:replace="nothing">
<!-- ____________________________ workspace ends ____________________________ -->
</span>
</div>
 
<!-- served by <tal:block replace="string:(page served by ${request/HTTP_HOST})" /> -->

</body>
</html>
