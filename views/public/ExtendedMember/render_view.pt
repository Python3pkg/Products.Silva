<tal:block define="global view here;
                    global request view/REQUEST;
                    global model request/model;
                    global fields view/memberform/get_fields;
                    global silva_permissions here/get_silva_permissions;
                    dummy model/security_trigger;
                    global message_type request/SESSION/message_type | nothing;
                    global message request/SESSION/message | nothing;
                    dummy view/clear_message;
                    " />

<tal:block condition="message">
<div class="feedback" tal:condition="python:message_type == 'feedback'">
  <span tal:replace="structure string:Status: ${message}">message</span>&nbsp;&nbsp;<span tal:replace="string:(${here/service_utils/backend_now_to_str})">datetime</span>
</div>
<div class="feedback" tal:condition="python:message_type == 'error'">
  <span class="error" tal:content="structure message">message</span>
</div>
</tal:block>

<h2>Memberdata of <span tal:replace="model/id" /></h2>

<tal:block condition="silva_permissions/ChangeSilvaContent">

<form action="." method="post">
<table>
  <tr>
    <th colspan="2" align="left">Field name:</th>
    <th align="left">Field value:</th>
  </tr>

  <tr tal:repeat="field fields">
    <td tal:content="structure python: test(field.is_required(), '*', '&nbsp;')">
    </td>
    <td tal:content="field/title">
    </td>
    <td>
      <span tal:replace="structure python: field.render(getattr(model, field.id)())" />
    </td>
  </tr>

  <tr>
    <td>
      &nbsp;
    </td>
    <td>
      Approved member:
    </td>
    <td>
      <span tal:replace="python: test(model.is_approved(), 'Yes', 'No')" />
      <input type="submit" name="public/approve_visitor:method" tal:condition="python: ((silva_permissions['ChangeSilvaAccess'] and model.id != request.AUTHENTICATED_USER.getId()) or silva_permissions['ChangeSilvaViewRegistry']) and not model.is_approved()" value="Approve now"/>
    </td>
  </tr>

</table>
<input type="submit" name="public/save_memberdata:method" value="Edit" />
</form>

</tal:block>
