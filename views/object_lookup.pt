<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html tal:omit-tag=""
  lang="en"
  xml:lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:notal="http://www.infrae.com/silva/notal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  tal:define="global vein string:contents;"
  i18n:domain="silva">

<metal:block use-macro="here/macro_no_tabs/macros/master">
<metal:block fill-slot="script">
  <script type="text/javascript" tal:attributes="src here/reference.js/absolute_url">
  </script>
</metal:block>
<metal:block fill-slot="main"
  tal:define="
    objects python:model.get_tree();
    silva_permissions here/get_silva_permissions;
    filter python: request.get('filter');
    filter python: test(filter is None, request.SESSION.get('lookup:filter'),
                          filter);
    startpath python: ((request.get('filter') is not None) and 
                        '/'.join(model.getPhysicalPath()) or
                        request.SESSION.get('lookup:startpath'));
    show_add python: request.get('show_add', 
                        request.SESSION.get('lookup:show_add', '0'));
    dummy python: request.SESSION.set('lookup:filter', filter);
    dummy python: request.SESSION.set('lookup:show_add', show_add);
    dummy python: request.SESSION.set('lookup:startpath', startpath);
    pathadapter python: modules['Products'].Silva.adapters.path.getPathAdapter(request);
    
">

<table class="columns columns2">
  <tbody>
    <tr>
      <tal:block replace="nothing">
        _____________________ sidebar _____________________
      </tal:block>
        <td class="left" style="width:25%; padding:0;">
          <metal:use-macro use-macro="view/macro_vein_navigation/macros/vein">
            <metal:fill-slot fill-slot="sidebar">
              <tal:block replace="structure python: view.service_sidebar.render(model, 'object_lookup', vein)" />
            </metal:fill-slot>
          </metal:use-macro>
        </td>

        <tal:block replace="nothing">
          _____________________ main subtable _____________________
        </tal:block>
        <td class="main"
          style="width:75%; padding:0;">

        <table class="listing"
          style="margin:0;"
          id="sortable"
          tal:define="
            ret python:here.object_lookup_get_objects(filter, int(show_add));
            default_document python: ret[0];
            publishables python: ret[1];
            assets python: ret[2];
            addable_types python: ret[3];
            global first_checked python:False;
            ">
          <thead>
            <tal:block replace="nothing">
              ______________ vein + title row ______________
            </tal:block>
            <tr>
              <td class="top"
                colspan="6">
                <h2 tal:attributes="title string:id: ${model/id}">
                  <img tal:replace="structure python:view.render_icon(model)" />
                  &#xab;<span tal:replace="structure string:${title}">title</span>&#xbb;
                </h2>
              </td>
            </tr>

            <tal:block replace="nothing">
              ______________ top controls row ______________
            </tal:block>
            <tr class="top-controls">
              <td colspan="6">
                <div style="float: left;"
                    tal:condition="python: may_change_content and addable_types">
                  <input class="transport"
                    name="add_object:method"
                    type="submit"
                    value="new..."
                    title="add a new item - alt-n"
                    accesskey="n"
                    tal:attributes="onclick string:location.href='${url}/edit/add_object?meta_type='+this.form.meta_type.options[this.form.meta_type.selectedIndex].value" 
                    i18n:attributes="value;title"
                  />
                  <label for="meta_type" 
                    title="access key: alt-s" 
                    accesskey="s"
                    i18n:attributes="title"
                  >
                  </label>
                  <select class="transport"
                            name="meta_type"
                            id="meta_type"
                            title="select a new item: alt-s"
                            tal:attributes="onChange string:location.href='${url}/edit/add_object?meta_type='+this.options[this.selectedIndex].value+'&lookup_mode:int=1'"
                            i18n:attributes="title"
                      >
                    <option value="None" i18n:translate="">
                      select:
                    </option>
                    <tal:block tal:repeat="addable model/get_silva_addables">
                      <option tal:condition="python:here.service_view_registry.has_view('add', addable['name']) and addable['name'] in addable_types"
                        tal:content="python: addable['name'] == 'Silva AutoTOC' and 'Silva Automatic Table of Contents' or addable['name']"
                        tal:attributes="value addable/name" />
                    </tal:block>
                  </select>
                  <input type="hidden"
                    name="lookup_mode:int"
                    value="1"
                  />
                </div>
              </td>
            </tr>
          </thead>
          
          <form name="objectform" id="objectform" action="." method="POST"
                onsubmit="return false">
            <tbody>
              <tal:block replace="nothing">
                ______________ listing header ______________
              </tal:block>
              <tr tal:condition="python:(default_document or publishables or assets)">
                <th class="listing-right">
                  #&nbsp;
                </th>
                <th i18n:translate="">
                  select
                </th>
                <th i18n:translate="">
                  view
                </th>
                <th i18n:translate="">
                  modified
                </th>
                <th i18n:translate="">
                  author
                </th>
              </tr>

              <tal:block replace="nothing">
                ______________ if no publishables in this folder ______________
              </tal:block>
              <tr class="odd"
                tal:condition="python: not(default_document or publishables or assets)">
                <td colspan="5" i18n:translate="">
                  There is no content here.
                </td>
              </tr>

              <tal:block replace="nothing">
                ______________ default + publishables ______________
              </tal:block>
              <tal:block
                repeat="item python: default_document and [default_document] + publishables or publishables">
                <tal:block define="
                  is_default python: item is default_document;
                  item_url item/absolute_url;
                  id item/id;
                  title item/get_title_editable;
                  path python: pathadapter.pathToUrlPath(
                                  mangle.Path.fromObject(startpath, item));
                  status_style python:item.get_object_status()[1];
                  oddrow repeat/item/odd;
                  checked not: first_checked;
                  global first_checked python: True;
                  ">
                  <tr tal:attributes="class python:oddrow and 'odd' or 'even'">
                    <tal:block replace="nothing">
                      _______ checkbox + position cell _______
                    </tal:block>
                    <td class="listing-left">
                      <input type="radio"
                        name="object"
                        tal:attributes="
                          value path;
                          id id;
                          lookup:id id;
                          lookup:title title;
                          checked checked;
                          "
                      />
                      <label 
                        tal:condition="default_document"
                        tal:content="repeat/item/index"
                        tal:attributes="for id">
                        # with default doc, starts at 0
                      </label>
                      <label 
                        tal:condition="not: default_document"
                        tal:content="repeat/item/number"
                        tal:attributes="for id">
                        # without default doc, starts at 1
                      </label>
                    </td>
                    <tal:block replace="nothing">
                      _______ id cell _______
                    </tal:block>
                    <td>
                      <label style="text-transform:none;"
                        tal:attributes="
                          for id;
                          title string:choose this ${item/meta_type};
                          ">
                        <img tal:replace="structure python:view.render_icon(item)" />
                        <tal:block tal:replace="python: mangle.String.centeredTruncate(item.id, 30)">
                          id
                        </tal:block>
                      </label>
                      <img alt="content approved or published"
                        border="0"
                        height="10"
                        width="10"
                        title="content is approved or published"
                        tal:define="
                          is_published item/is_version_published | nothing;
                          is_approved item/is_version_approved | nothing"
                        tal:condition="python:is_published or is_approved"
                        tal:attributes="src string:${root_url}/globals/checkmark.gif" 
                        i18n:attributes="alt"
                      />
                    </td>
                    <tal:block replace="nothing">
                      _______ title cell _______
                    </tal:block>
                    <td>
                      <a class="blacklink"
                        title="view"
                        tal:attributes="
                          href item_url;
                          class status_style;"
                        tal:define="title python: mangle.String.centeredTruncate(item.get_title_editable(), 30)
                                                    or default"
                        tal:content="title"
                        i18n:attributes="title">
                        <i i18n:translate="">no title</i>
                      </a>
                    </td>
                    <tal:block replace="nothing">
                      _______ modified date/metadata downlink cell _______
                    </tal:block>
                    <td tal:define="modification_time item/get_modification_datetime | nothing">
                      <span class="blacklink" title="metadata"
                        tal:condition="modification_time"
                        tal:attributes="href string:${item_url}/edit/tab_metadata"
                        tal:content="structure python:mangle.DateTime(modification_time).toShortStr()"
                        i18n:attributes="title"
                        >
                        date
                      </span>
                      <span class="closed" title="settings"
                        tal:condition="not:modification_time"
                        tal:attributes="href string:${item_url}/edit/tab_metadata"
                        i18n:attributes="title"
                        >
                        <i i18n:translate="">n/a</i>
                      </span>
                    </td>
                    <tal:block replace="nothing">
                      _______ author/status downlink cell _______
                    </tal:block>
                    <td tal:define="last_author python:(item.sec_get_last_author_info().fullname() or default)">
                      <span class="blacklink" title="status"
                        tal:condition="python:not item.implements_container() and item.implements_versioned_content()"
                        tal:attributes="href string:${item_url}/edit/tab_status"
                        tal:content="structure last_author"
                        i18n:attributes="title"
                        >
                        authorname
                      </span>
                      <span class="closed" title="publish"
                        tal:condition="python:item.implements_container()"
                        tal:attributes="href string:${item_url}/edit/tab_status"
                        i18n:attributes="title"
                        >
                        <i i18n:translate="">n/a</i>
                      </span>
                      <span 
                        tal:condition="python:item.implements_content() and not item.implements_versioned_content()"
                        tal:replace="last_author">
                        authorname
                      </span>
                    </td>
                  </tr>
                </tal:block>
              </tal:block>

              <tal:block replace="nothing">
                ______________ assets ______________
              </tal:block>
              <tal:block 
                condition="python:len(assets)"
                repeat="asset assets">

                <tal:block define="
                  asset_url asset/absolute_url;
                  oddrow repeat/asset/odd;
                  id asset/id;
                  title asset/get_title;
                  path python: pathadapter.pathToUrlPath(mangle.Path.fromObject(startpath, asset));
                  checked not: first_checked;
                  global first_checked python: True;
                  ">
                  <tr 
                    tal:define="show_top_border repeat/asset/start;"
                    tal:attributes="class python:oddrow and 'odd' or 'even';
                                    style python:show_top_border and 'border-top: 1px solid #77858c' or nothing">
                    <tal:block replace="nothing">
                      _______ checkbox + position cell _______
                    </tal:block>
                    <td class="listing-left">
                      <input type="radio"
                        name="object"
                        tal:attributes="
                          id id;
                          lookup:id id;
                          lookup:title title;
                          value path;
                          checked checked;
                          "
                      />
                      <label 
                        tal:condition="default_document"
                        tal:attributes="for id"
                        i18n:translate="">
                        &#8211;
                      </label>
                    </td>
                    <tal:block replace="nothing">
                      _______ icon + id cell _______
                    </tal:block>
                    <td>
                      <label style="text-transform:none;"
                        tal:attributes="
                          for id;
                          title string:choose this ${asset/meta_type};
                          ">
                        <img tal:replace="structure python:view.render_icon(asset)" />
                        <tal:block tal:replace="python: mangle.String.centeredTruncate(asset.id, 30)">
                          id
                        </tal:block>
                      </label>
                    </td>
                    <tal:block replace="nothing">
                      _______ title cell _______
                    </tal:block>
                    <td>
                      <a class="blacklink"
                        title="preview"
                        tal:content="python: mangle.String.centeredTruncate(asset.get_title_editable(), 30) 
                                            or default"
                        tal:attributes="
                          href asset_url;
                          class python: asset.get_title() == '' and 'closed' or 'blacklink'"
                        i18n:attributes="title"
                        >
                        <i i18n:translate="">view</i>
                      </a>
                    </td>
                    <tal:block replace="nothing">
                      _______ modified date cell _______
                    </tal:block>
                    <td tal:define="modification_time asset/get_modification_datetime | nothing">
                      <tal:block
                        condition="modification_time"
                        content="structure python:mangle.DateTime(modification_time).toShortStr()">
                      </tal:block>
                      <tal:block condition="not:modification_time">
                        <i i18n:translate="">
                          unknown
                        </i>
                      </tal:block>
                    </td>
                    <tal:block replace="nothing">
                      _______ author cell _______
                    </tal:block>
                    <td tal:content="structure last_author"
                      tal:define="last_author python:(asset.sec_get_last_author_info().fullname() or default)">
                      unknown
                    </td>
                  </tr>

                </tal:block>
              </tal:block>
            </tbody>
          </form>


          <tfoot>
            <tal:block replace="nothing">
              ______________ controls ______________
            </tal:block>
            <tr class="controls">
             <td class="align-right"
               colspan="5">
               <input class="cancel"
                 style="float:left;"
                 type="button"
                 name="cancel"
                 value="cancel"
                 title="cancel operation: alt-c"
                 accesskey="c"
                 i18n:attributes="title;value"
                 onclick="window.close();return false;"
                />
               <input class="transport"
                 type="button"
                 name="place"
                 value="place reference..."
                 title="insert a reference to this asset: alt-p"
                 accesskey="p"
                 onclick="window.reference.setReference(
                              document.getElementById('objectform'), 
                              'object'); return false;" 
                 tal:condition="python: publishables or assets or default"
                 i18n:attributes="title;value"
                />
             </td>
            </tr>
          </tfoot>



        </table>

      </td>
    </tr>
  </tbody>
</table>

</metal:block>
</metal:block>
</html>
