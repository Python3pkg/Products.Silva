<init tal:omit-tag=""
      tal:define="global node request/node;
                  global toc_depth python:int(test(node.hasAttribute('toc_depth'),node.getAttribute('toc_depth'),-1))" />

<p class="toc" tal:define="node request/node">
  <toc tal:omit-tag=""
    tal:repeat="obj python:node.get_content().get_container().get_tree(int(toc_depth))">
  <loop tal:omit-tag=""
    tal:define="indent python:obj[0]; 
      item python:obj[1];
      title python:obj[1].get_title_html()"
    tal:condition="python:toc_depth == -1 or indent < toc_depth and (not hasattr(obj[1], 'hide_from_tocs') or not obj[1].hide_from_tocs)">
  <a href="edit" class="toc-link"
    tal:attributes="
      href string:${item/absolute_url}/edit/tab_preview;
      style python:'margin-left:'+str(indent * 24);"
    tal:content="structure title">title</a><br />
  </loop>
  </toc>
</p>
